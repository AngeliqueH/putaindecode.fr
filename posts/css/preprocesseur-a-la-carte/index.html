<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width, init-scale=1.0, minimal-ui"><title>Faire son pr√©processeur CSS √† la carte</title><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@putaindecode"/><meta name="twitter:title" content="Faire son pr√©processeur CSS √† la carte"/><meta name="twitter:creator" content="@MoOx"/><meta name="twitter:image" content="http://www.gravatar.com/avatar/2f6c2dcd4ba8fc44f1e7f0b2ed3d587d.png?s=200"/><meta property="og:title" content="Faire son pr√©processeur CSS √† la carte"/><meta property="og:type" content="article"/><meta property="og:image" content="http://www.gravatar.com/avatar/2f6c2dcd4ba8fc44f1e7f0b2ed3d587d.png?s=200"/><meta property="og:site_name" content="Putain de code !"/><link rel="stylesheet" href="../../../stylesheets/index.css"></head><body><div class="putainde-Header"><div class="Grid"><div class="Grid-cell u-size5of12"><a href="../../.." class="putainde-SiteTitle"><img alt="Putain de code !" src="../../../images/p!-logo.svg" class="putainde-Logo"><span>Putain de code !</span></a></div><div class="Grid-cell u-size7of12"><nav class="putainde-Nav"><a href="../.." data-tip="" class="putainde-Nav-item  "><i class="putainde-Icon putainde-Icon--bookmark"></i> Articles</a><a href="../../../c-est-quoi-putaindecode" data-tip="" class="putainde-Nav-item  "><i class="putainde-Icon putainde-Icon--text-file"></i> Readme</a><a href="../../comment-contribuer" data-tip="" class="putainde-Nav-item  "><i class="putainde-Icon putainde-Icon--pencil"></i> Participer</a><a href="https://github.com/putaindecode/" data-tip="GitHub" class="putainde-Nav-item  putainde-Nav-item--icon AttrTip AttrTip--bottom"><i class="putainde-Icon putainde-Icon--github"></i></a><a href="https://twitter.com/putaindecode/" data-tip="Twitter" class="putainde-Nav-item  putainde-Nav-item--icon AttrTip AttrTip--bottom"><i class="putainde-Icon putainde-Icon--twitter"></i></a></nav></div></div></div><div class="putainde-Main"><article class="Grid putainde-Post"><div class="Grid-cell u-size8of12 Grid putainde-Post-contents"><div class="putainde-Title"><h1 class="putainde-Title-text">Faire son pr√©processeur CSS √† la carte</h1></div><header class="putainde-Post-header"><div class="putainde-Post-metas">√âcrit par¬†<a href="https://github.com/MoOx">MoOx</a>,<span class="putainde-Date"> le 20 mai 2014</span>. <span data-tip="Temps de lecture approximatif, sur une base de {{wpm}} mots par minute" data-readingTime-wpm="250" class="putainde-Post-readingTime putainde-Post-readingTime--hidden AttrTip AttrTip--top">Temps de lecture : environ  <span class="putainde-Post-readingTime-value"></span> minutes</span></div><ul class="putainde-Tags putainde-Post-tags"><li class="putainde-Tag">css</li><li class="putainde-Tag">preprocesseur</li><li class="putainde-Tag">postprocesseur</li></ul></header><div class="putainde-Post-md"><p>Apr√®s vous avoir fait un petit <a href="/posts/css/le-point-sur-les-preprocesseurs/">√©tat de l‚Äôart des pr√©processeurs CSS historiques</a>
et vous avoir parl√© <a href="/posts/css/le-point-sur-les-preprocesseurs/">des postprocesseurs</a>,
je me dois de vous montrer le chemin qui me semble le plus pertinent aujourd‚Äôhui,
en 2014, maintenant que <a href="http://www.w3.org/standards/techs/css#cr">les sp√©cifications CSS sont d√©coup√©es en modules</a>
qui peuvent du coup avancer (plus rapidement) chacune de leur c√¥t√©.</p>
<p>Bon apr√®s faut avouer que chez {p!} on fait genre on est des hipsters hackers,
du coup quand on voit que <a href="http://blog.kaelig.fr/post/85546040569/net-awards-sass-game-changer-of-the-year">Sass est le game changer of the year</a>
 et que tout le monde l‚Äôadopte, on se doit de rester hipster.
Du coup on est oblig√©s de passer √† autre chose.</p>
<h2 id="pre-ou-postprocesseurs-"><a class="putainde-Title-anchor" href="#pre-ou-postprocesseurs-">#</a>Pr√© ou postprocesseurs ?</h2><p>Je vais ici utiliser le mot pr√©processeur, alors que certains trouveront postprocesseurs plus pertinent,
car pour moi le pr√©processing reste simplement une √©tape avant le <em>processing</em>
de nos feuilles de styles par les navigateurs.</p>
<p>Cela dit il faut bien distinguer les √©tapes :</p>
<ol>
<li>Preprocessing d‚Äôun langage sp√©cifique (Sass, Stylus*) ou superset du langage CSS (Scss, Less);</li>
<li>Preprocessing d‚Äôun fichier respectant la syntaxe CSS;</li>
<li>Processing par le navigateur</li>
</ol>
<p>Revenons rapidement sur ces 3 points :</p>
<h3 id="preprocessing-via-langage-dedie"><a class="putainde-Title-anchor" href="#preprocessing-via-langage-dedie">#</a>Preprocessing via langage d√©di√©</h3><p>Ici je parle d‚Äôun langage, car superset ou pas, on a des √©l√©ments nouveaux,
incompr√©hensibles par le navigateur (ex: <code>@if</code>, <code>@foreach</code>‚Ä¶).</p>
<p>Note: Je case Stylus dans le langage sp√©cifique car il n‚Äôest pas vraiment compatible,
ne tol√©rant pas l‚Äôindentation :</p>
<pre><code class="lang-css"><span class="hljs-class">.Block</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">prop</span>:<span class="hljs-value"> value </span></span></span>}

  <span class="hljs-class">.Block-element</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">prop</span>:<span class="hljs-value"> value </span></span></span>}

<span class="hljs-comment">/* üí• BOOM ! CA PAS MARCHER EN STYLUS */</span>
</code></pre>
<h3 id="preprocessing-futureproof-fallback"><a class="putainde-Title-anchor" href="#preprocessing-futureproof-fallback">#</a>Pr√©processing futureproof/fallback</h3><p>Ici on conserve la syntaxe CSS, le parsing est donc simple est connu.
Mais attention on peut avoir un r√©sultat non compr√©hensible par certains navigateurs
(ex: unit√© REM sur IE 8, variables CSS‚Ä¶).</p>
<p>√Ä la diff√©rence de la solution du dessus, on reste ici avec un langage √† la syntaxe simple
et connue, avec des sp√©cifications (en brouillon ou pas).</p>
<p>D√®s que c‚Äôest possible on va rendre le CSS encore plus compatible en ajoutant
des fallbacks (roues de secours) √† tout va.
Ainsi par exemple pour assurer une utilisation de l‚Äôunit√© REM, on peut (en roue de secours)
doubler nos valeurs en <code>px</code>.
Autre exemple avec les variables CSS natives : on peut (pour une utilisation simpliste)
faire un pr√©rendu et mettre des roues de secours l√† o√π c‚Äôest possible.</p>
<h3 id="processing-par-le-navigateur"><a class="putainde-Title-anchor" href="#processing-par-le-navigateur">#</a>Processing par le navigateur</h3><p>Ici on a blind√© notre feuille de fallback, on est (en th√©orie) sens√© avoir un support ‚Äúau mieux‚Äù.</p>
<h2 id="creer-un-preprocesseur-css"><a class="putainde-Title-anchor" href="#creer-un-preprocesseur-css">#</a>Cr√©er un pr√©processeur CSS</h2><p>Allons √† l‚Äôessentiel : pour cr√©er votre pr√©processeur on va utiliser une biblioth√®que.
√Ä ce jour nous avons le choix entre <a href="https://github.com/reworkcss/rework">Rework</a>
 ou <a href="https://github.com/ai/postcss">PostCSS</a> qui permettent d‚Äôinspecter et de manipuler nos CSS.
Tout deux sont des biblioth√®ques √©critent en JavaScript (NodeJs).</p>
<p>Pour la petite histoire, Autoprefixer est √† l‚Äôorigine de PostCSS. En effet les
premi√®res versions utilisaient Rework, mais √† cause de limitation dues √† l‚ÄôAPI de Rework,
l‚Äôauteur d‚ÄôAutoprefixer √† d√©cider de cr√©er son propre moteur, qui a une API presque
plus sympa il faut le dire (il faudra voir comment √©volue Rework).</p>
<p>D‚Äôun autre c√¥t√© Rework √©tant plus ancien, il poss√®de un √©cosyst√®me plus fourni et r√©pondra
donc mieux √† nos besoins.</p>
<p>Cela √©tant dit, avec l‚Äôapproche futureproof nous pourrons switcher de Rework √† PostCSS
 sans probl√®me et surtout sans toucher √† nos feuilles de styles.
Il suffira de trouver un plugin √©quivalent (ex: rework-vars et postcss-vars font la m√™me chose).</p>
<p>Pour des raisons d‚Äô√©cosyst√®me, je partirai sur Rework histoire de ne pas r√©inventer la roue.</p>
<h2 id="creer-un-preprocesseur-css-avec-rework"><a class="putainde-Title-anchor" href="#creer-un-preprocesseur-css-avec-rework">#</a>Cr√©er un pr√©processeur CSS avec Rework</h2><p>Rework prend une cha√Æne CSS en entr√©e, produit un AST (arbre de syntaxe abtrait)
de notre CSS et nous fournis une API pour le manipuler.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> rework = <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework"</span>)
<span class="hljs-keyword">var</span> unPlugin = <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework-BIDULE"</span>)
<span class="hljs-comment">// usage simple</span>
<span class="hljs-keyword">var</span> css = rework(<span class="hljs-string">"html { font-size: 2rem}"</span>).<span class="hljs-keyword">use</span>(unPlugin).toString()
</code></pre>
<h3 id="plugin-rework"><a class="putainde-Title-anchor" href="#plugin-rework">#</a>Plugin Rework</h3><p>Un plugin Rework n‚Äôest rien d‚Äôautre qu‚Äôune fonction JavaScript.
L‚Äôexemple suivant remplacera toutes les couleurs de texte par du noir.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> monPlugin = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">plugin</span><span class="hljs-params">(ast, reworkInstance)</span> {</span>
  ast.rules.<span class="hljs-keyword">forEach</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(rule)</span> {</span>
    <span class="hljs-comment">// dans notre cas on ne veut que travailler sur des r√®gles</span>
    <span class="hljs-keyword">if</span> (rule.type !== <span class="hljs-string">"rule"</span>) <span class="hljs-keyword">return</span>

    rule.declarations.<span class="hljs-keyword">forEach</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(declaration, index)</span> {</span>
      <span class="hljs-keyword">if</span> (declaration.property === <span class="hljs-string">"color"</span>) {
        declaration.value = <span class="hljs-string">'#000'</span>
      }
    })
  })
}
</code></pre>
<p>Il est certain que l‚Äôexemple ci-dessus ne doit pas vous exciter beaucoup. Moi non plus.
Je n‚Äôai d‚Äôailleurs pas du tout accroch√© lorsque Rework est apparu par manque de compr√©hension.
<strong>Ou plut√¥t par manque d‚Äôimagination</strong>.</p>
<p>Pour un exemple plus costaud je vous invite √† regarder le code <a href="https://github.com/reworkcss/rework-vars/blob/master/index.js">rework-vars</a>.</p>
<h2 id="l-ecosysteme-rework"><a class="putainde-Title-anchor" href="#l-ecosysteme-rework">#</a>L‚ÄôEcosyst√®me Rework</h2><p>Heureusement pour nous, nous avons un √©cosyst√®me. Donc pour un usage classique (√©crire
du CSS futureproof ou ajouter quelques petites am√©liorations) il n‚Äôy aura pas besoin
d‚Äô√©crire de plugin, juste en utiliser fera l‚Äôaffaire.</p>
<h3 id="plugins-rework-natif"><a class="putainde-Title-anchor" href="#plugins-rework-natif">#</a>Plugins Rework natif</h3><p>Rework embarque en natif quelques plugins. Il faudra tout de m√™me les activer (on voit comment juste apr√®s).</p>
<ul>
<li><a href="https://github.com/reworkcss/rework#extend">extend</a>: Permet d‚Äôh√©riter d‚Äôun s√©lecteur (<code>@extend</code> quoi).</li>
<li><a href="https://github.com/reworkcss/rework#ease">ease</a>: Ajout un paquet de fonctions d‚Äôeasing pour les animations et transitions.</li>
<li><a href="https://github.com/reworkcss/rework#at2x">at2x</a>: Gestion automatique des images <code>@2x</code>.</li>
<li><a href="https://github.com/reworkcss/rework#prefixselectorsstring">prefixSelectors</a>: Permet de pr√©fixer vos s√©lecteurs.</li>
<li><a href="https://github.com/reworkcss/rework#colors">colors</a>: Explication par l‚Äôexemple : <code>rgba(#fc0, .5)</code>.</li>
<li><a href="https://github.com/reworkcss/rework#mixinobject">mixin</a>: Faire ses propres mixins via des fonctions JavaScript.</li>
<li><a href="https://github.com/reworkcss/rework#functionobject">function</a>: Ajouter ses propres fonctions CSS.</li>
<li><a href="https://github.com/reworkcss/rework#references">references</a>: Permet de faire r√©f√©rence √† des valeurs de propri√©t√©s (ex: <code>height: @width</code>)</li>
<li><a href="https://github.com/reworkcss/rework#urlfn">url</a>: R√©√©crire les <code>url()</code>s via une fonction JavaScript.</li>
<li><a href="https://github.com/reworkcss/rework#inlinedir">inline</a>: Inliner des ressources via des datauri.</li>
</ul>
<h3 id="plugins-rework-npm"><a class="putainde-Title-anchor" href="#plugins-rework-npm">#</a>Plugins Rework NPM</h3><p>On a d√©j√† plus d‚Äôune soixantaine de <a href="https://www.npmjs.org/search?q=rework">plugins Rework disponible sur NPM</a> en plus des plugins natifs.</p>
<h4 id="ajouter-des-fallbacks"><a class="putainde-Title-anchor" href="#ajouter-des-fallbacks">#</a>Ajouter des fallbacks</h4><p>Si vous souhaitez √©crire des CSS sans pour autant vous limiter √† certaines impl√©mentations, ces plugins devraient vous plaire.</p>
<h5 id="rework-vars"><a class="putainde-Title-anchor" href="#rework-vars">#</a>rework-vars</h5><p><a href="https://github.com/reworkcss/rework-vars">rework-vars</a>
permet un usage des <a href="http://www.w3.org/TR/css-variables/">variables CSS</a>.
Ce plugin est (pour l‚Äôinstant) restreint aux d√©clarations √† la racine (<code>:root</code>).
Cela permet toutefois un usage classique de variables globales.
Et de se s√©parer de Sass ou Less si on utilise pas beaucoup plus que des variables.</p>
<h5 id="rework-calc"><a class="putainde-Title-anchor" href="#rework-calc">#</a>rework-calc</h5><p><a href="https://github.com/reworkcss/rework-calc">rework-calc</a>
ajoute les r√©sultats des op√©rations <code>calc()</code> quand c‚Äôest possible (m√™me unit√©).
Tr√®s pratique sp√©cialement coupl√© avec rework-vars pour ajouter un peu de math via vos variables.</p>
<h5 id="rework-npm"><a class="putainde-Title-anchor" href="#rework-npm">#</a>rework-npm</h5><p><a href="https://github.com/conradz/rework-npm">rework-npm</a>
nous parse <code>@import</code> comme on l‚Äôaime.
Peut taper dans votre dossier de sources ou en plus dans <code>node_modules</code>
(pratique pour utiliser <a href="https://www.npmjs.org/package/normalize.css">normalize.css</a>
<a href="/posts/frontend/npm-comme-package-manager-pour-le-front-end/">via npm</a> par exemple).
Il existe aussi <a href="https://github.com/simme/rework-importer">rework-importer</a> qui am√®ne quelques diff√©rences de syntaxe.</p>
<h5 id="-a-href-https-github-com-ctalkington-rework-rem-fallback-rework-rem-fallback-a-"><a class="putainde-Title-anchor" href="#-a-href-https-github-com-ctalkington-rework-rem-fallback-rework-rem-fallback-a-">#</a><a href="https://github.com/ctalkington/rework-rem-fallback">rework-rem-fallback</a></h5><p><a href="https://github.com/ctalkington/rework-rem-fallback">rework-rem-fallback</a>
ajout un fallback sur les unit√©s REM. Pratique si vous voulez utiliser REM mais
que vous devez supporter IE 8.</p>
<h5 id="rework-color-function"><a class="putainde-Title-anchor" href="#rework-color-function">#</a>rework-color-function</h5><p><a href="https://github.com/ianstormtaylor/rework-color-function">rework-color-function</a> permet
de manipuler les couleurs via
<a href="http://dev.w3.org/csswg/css-color/#modifying-colors">les nouvelles fonctions en cours de sp√©cifications</a>
(hue, saturation, lightness, whiteness, blackness, tint, shade, blend, blenda, contrast).</p>
<h5 id="rework-mixin-opacity"><a class="putainde-Title-anchor" href="#rework-mixin-opacity">#</a>rework-mixin-opacity</h5><p><a href="https://github.com/reworkcss/rework-mixin-opacity">rework-mixin-opacity</a> ajoute l‚Äô<code>opacity</code> pour IE 8.</p>
<h4 id="ameliorer-un-peu-vos-feuilles-de-styles"><a class="putainde-Title-anchor" href="#ameliorer-un-peu-vos-feuilles-de-styles">#</a>Am√©liorer un peu vos feuilles de styles</h4><p>Sans pour autant partir en vrille vers des <code>@if</code> ou <code>@each</code>, voici quelques plugins
qui peuvent ajouter un peu de beurre dans les √©pinards :</p>
<h5 id="rework-parent"><a class="putainde-Title-anchor" href="#rework-parent">#</a>rework-parent</h5><p><a href="https://github.com/fgnass/rework-parent">rework-parent</a> permet de r√©f√©rencer le s√©lecteur pr√©c√©dent via <code>&amp;</code>. Pratique dans pour les media-queries ou pour les √©tats (:hover etc).</p>
<h5 id="rework-breakpoints"><a class="putainde-Title-anchor" href="#rework-breakpoints">#</a>rework-breakpoints</h5><p><a href="https://github.com/reworkcss/rework-breakpoints">rework-breakpoints</a> permet de sp√©cifier des media-queries via des breakpoints pr√©d√©finis. Pratique en attendant un plugin g√©rant les <a href="http://dev.w3.org/csswg/mediaqueries4/#custom-mq"><code>@custom-media</code></a>.</p>
<h5 id="rework-hex-alpha"><a class="putainde-Title-anchor" href="#rework-hex-alpha">#</a>rework-hex-alpha</h5><p><a href="https://github.com/ianstormtaylor/rework-hex-alpha">rework-hex-alpha</a> permet de sp√©cifier des couleurs avec alpha sous la forme #rrggbbaa.</p>
<h5 id="rework-clearfix"><a class="putainde-Title-anchor" href="#rework-clearfix">#</a>rework-clearfix</h5><p><a href="https://github.com/fgnass/rework-clearfix">rework-clearfix</a> permet d‚Äôutiliser <code>clear: fix</code> via l‚Äôinsertion automatique du <a href="http://nicolasgallagher.com/micro-clearfix-hack/">micro clearfix de @necolas</a>.</p>
<h5 id="rework-assets"><a class="putainde-Title-anchor" href="#rework-assets">#</a>rework-assets</h5><p><a href="https://github.com/conradz/rework-assets">rework-assets</a> permet de copier les assets r√©f√©renc√©s. Pratique avec rework-npm et des modules externes.</p>
<h5 id="rework-namespace-css"><a class="putainde-Title-anchor" href="#rework-namespace-css">#</a>rework-namespace-css</h5><p><a href="https://github.com/geordiemhall/rework-namespace-css">rework-namespace-css</a> permet de namespacer vos CSS par une classe sur <code>&lt;html&gt;</code>.</p>
<h5 id="rework-namespace"><a class="putainde-Title-anchor" href="#rework-namespace">#</a>rework-namespace</h5><p><a href="https://github.com/kristoferjoseph/rework-namespace">rework-namespace</a> permet de namespacer vos CSS par un pr√©fixe. Pratique avec <a href="/posts/css/petite-definition-bem/">BEM</a> lorsque vous pr√©fixez par votre <code>.org-</code>.</p>
<h5 id="rework-classmap"><a class="putainde-Title-anchor" href="#rework-classmap">#</a>rework-classmap</h5><p><a href="https://github.com/andreypopp/rework-classmap">rework-classmap</a> permet de renommer des classes via du mapping. Avec √ßa on pourrait presque avoir un code Bootstrap propre.</p>
<h5 id="rework-palette"><a class="putainde-Title-anchor" href="#rework-palette">#</a>rework-palette</h5><p><a href="https://github.com/fgnass/rework-palette">rework-palette</a> permet d‚Äôajouter une palette de couleur personnalis√© (via des noms de couleurs).</p>
<h5 id="rework-deduplicate"><a class="putainde-Title-anchor" href="#rework-deduplicate">#</a>rework-deduplicate</h5><p><a href="https://github.com/kristoferjoseph/rework-deduplicate">rework-deduplicate</a> permet de supprimer les r√®gles dupliqu√©s.</p>
<h5 id="rework-split-media"><a class="putainde-Title-anchor" href="#rework-split-media">#</a>rework-split-media</h5><p><a href="https://github.com/reworkcss/split-media">rework-split-media</a> permet de couper les contenu des media queries dans d‚Äôautres fichiers</p>
<h5 id="rework-move-media"><a class="putainde-Title-anchor" href="#rework-move-media">#</a>rework-move-media</h5><p><a href="https://github.com/reworkcss/rework-move-media">rework-move-media</a> permet de regrouper les contenu des media queries. Pas tr√®s utile car gzip fera aussi bien.</p>
<h4 id="au-dela-du-preprocessing"><a class="putainde-Title-anchor" href="#au-dela-du-preprocessing">#</a>Au del√† du pr√©processing</h4><p>En utilisant le parser Rework, on peut faire plus que des ajustements ou du remplacement. On peut balancer des erreurs.</p>
<ul>
<li><a href="https://github.com/reworkcss/rework-ie-limits">rework-ie-limits</a>: pr√©vient si vos CSS d√©passent la limite de 4095 selectors (limite pour IE &lt; 10).</li>
<li><a href="https://github.com/suitcss/rework-suit-conformance">rework-suit-conformance</a>: permet de v√©rifier que votre code suit bien les <a href="https://github.com/suitcss/suit/tree/master/doc">conventions SUIT</a> (pour peu que vous les suiviez).</li>
</ul>
<p>En partant dans d‚Äôautres directions on pourrait r√©aliser des statistiques sur
nos CSS (nombre de s√©lecteurs, de couleurs utilis√©s etc) comme le fait <a href="http://www.cssstats.com/">CSS Stats</a>.</p>
<p>Retrouvrez en plus de la recherche via npm (qui sera la plus √† jour), <a href="https://github.com/reworkcss/rework/wiki/Plugins-and-Utilities">une liste des plugins et utilitaires sur le wiki de Rework</a>.</p>
<h2 id="mise-en-place-de-rework-pour-faire-votre-preprocesseur-en-moins-de-5-min"><a class="putainde-Title-anchor" href="#mise-en-place-de-rework-pour-faire-votre-preprocesseur-en-moins-de-5-min">#</a>Mise en place de Rework pour faire votre pr√©processeur en moins de 5 min</h2><p>Maintenant que nous avons vu comment utiliser Rework et quels sont les plugins
les plus sympa, on se faire un petit fichier pour automatiser tout ce process.</p>
<p>Plut√¥t que de r√©inventer la roue comme l‚Äôa fait <a href="http://pleeease.io/">Pleeease</a> (en g√©rant un watcher et tout le tralala),
on va plut√¥t partir comme <a href="http://myth.io/">Myth.io</a> ou <a href="https://github.com/visionmedia/styl">Styl</a> (successeur spirituel de Stylus)
qui se concentrent sur le rendu et non le workflow pour g√©n√©rer ce rendu.</p>
<p>Nous allons donc faire simple et efficace avec une task <a href="/posts/js/introduction-gulp/">gulp</a>.
Ceci pourrait bien entendu √™tre aussi bien fait avec grunt ou m√™me make et <a href="https://github.com/facebook/watchman">watchman</a>.</p>
<pre><code class="lang-shell">$ mkdir monrework &amp;&amp; cd monrework

# <span class="hljs-keyword">on</span> cr√©e un <span class="hljs-keyword">package</span>.json pour sauvegarder les r√©f√©rences des paquets qu<span class="hljs-attribute">'on</span> va utiliser
$ npm init

# <span class="hljs-keyword">on</span> install gulp, autoprefixer et rework &amp; co en les sauvegardants dans la partie <span class="hljs-string">"devDependencies"</span>
$ npm i -D minimist gulp gulp-util gulp-plumber gulp-autoprefixer gulp-rework rework-npm rework-vars rework-calc rework-color-<span class="hljs-keyword">function</span> rework-<span class="hljs-keyword">rem</span>-fallback rework-parent rework-ie-limits

# <span class="hljs-keyword">on</span> cr√©√© notre fichier vide
$ mkdir src &amp;&amp; mkdir src/styles &amp;&amp; touch src/styles/index.css
</code></pre>
<p>Ensuite il nous reste √† faire notre petit <code>Gulpfile.js</code></p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> options = <span class="hljs-keyword">require</span>(<span class="hljs-string">"minimist"</span>)(process.argv.slice(<span class="hljs-number">2</span>))
<span class="hljs-keyword">var</span> gulp = <span class="hljs-keyword">require</span>(<span class="hljs-string">"gulp"</span>)
<span class="hljs-keyword">var</span> util = <span class="hljs-keyword">require</span>(<span class="hljs-string">"gulp-util"</span>)
<span class="hljs-keyword">var</span> plumber = <span class="hljs-keyword">require</span>(<span class="hljs-string">"gulp-plumber"</span>)
<span class="hljs-keyword">var</span> rework = <span class="hljs-keyword">require</span>(<span class="hljs-string">"gulp-rework"</span>)

<span class="hljs-keyword">var</span> reworkPlugins = {
  atimport: <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework-npm"</span>),
  <span class="hljs-keyword">parent</span>: <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework-parent"</span>),
  vars: <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework-vars"</span>),
  calc: <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework-calc"</span>),
  colorFn: <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework-color-function"</span>),
  remFallback: <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework-rem-fallback"</span>),
  ieLimits: <span class="hljs-keyword">require</span>(<span class="hljs-string">"rework-ie-limits"</span>)
}
<span class="hljs-keyword">var</span> autoprefixer = <span class="hljs-keyword">require</span>(<span class="hljs-string">"gulp-autoprefixer"</span>)

gulp.task(<span class="hljs-string">"styles"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// ici on prends toutes les CSS √† la racine</span>
  <span class="hljs-comment">// on consid√®re que celle dans des sous dossiers sont √† importer</span>
  <span class="hljs-keyword">return</span> gulp.src(<span class="hljs-string">"./src/styles/*.css"</span>)
    .pipe(opts.production ? plumber() : util.noop())
    .pipe(rework(
      reworkPlugins.atimport({dir: <span class="hljs-string">"./src/styles/"</span>}),
      rework.colors(),
      rework.references(),
      rework.ease(),
      rework.inline,
      reworkPlugins.<span class="hljs-keyword">parent</span>,
      reworkPlugins.vars(), <span class="hljs-comment">// notez que certains plugins n√©cessite d'√™tre √©xecut√© (retourant une fonction dynamique)</span>
      reworkPlugins.calc,
      reworkPlugins.colorFn,
      reworkPlugins.remFallback,
      reworkPlugins.ieLimits
    ))
    .pipe(autoprefixer())
    .pipe(gulp.dest(<span class="hljs-string">"./dist/styles"</span>))
})

gulp.task(<span class="hljs-string">"default"</span>, [<span class="hljs-string">"styles"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  gulp.watch(<span class="hljs-string">"./src/css/**/*"</span>, [<span class="hljs-string">"styles"</span>])
})
</code></pre>
<p>Ensuite il reste plus qu‚Äô√† lancer Gulp au besoin qui s‚Äôoccupera d‚Äô√©xecuter le preprocessing
au d√©marrage et lors des changements de fichiers.
Il ne reste plus grand chose √† faire si ce n‚Äôest ajouter livereload en plus pour avoir le petit process au petit oignon.</p>
<pre><code class="lang-shell">$ gulp
[gulp] Using gulpfile ~/Development/monrework/Gulpfile.js
[gulp] Starting <span class="hljs-string">'styles'</span><span class="hljs-keyword">...</span>
[gulp] Finished <span class="hljs-string">'styles'</span> after <span class="hljs-number">49</span> ms
[gulp] Starting <span class="hljs-string">'default'</span><span class="hljs-keyword">...</span>
[gulp] Finished <span class="hljs-string">'default'</span> after <span class="hljs-number">4.16</span> ms
</code></pre>
<p>Le watch est lanc√©, on peut remplir notre fichier CSS</p>
<pre><code class="lang-css"><span class="hljs-pseudo">:root</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">--font-size</span>:<span class="hljs-value"> <span class="hljs-number">1</span>rem</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">--line-height</span>:<span class="hljs-value"> <span class="hljs-number">1.5</span>rem</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">--color-highlight</span>:<span class="hljs-value"> <span class="hljs-function">rgba(#f00, .<span class="hljs-number">8</span>)</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-tag">html</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">100</span>%</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> @width</span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-function">var(--font-size)</span>
</span></span></span>}

<span class="hljs-tag">p</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-function">calc(<span class="hljs-function">var(--line-height)</span> / <span class="hljs-number">2</span>)</span> <span class="hljs-number">0</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-tag">a</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">var(--color-highlight)</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">transition</span>:<span class="hljs-value"> all <span class="hljs-number">500</span>ms ease-out-back</span></span>;
<span class="hljs-rule">}</span></span>

&amp;<span class="hljs-pseudo">:hover</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">color(<span class="hljs-function">var(--color-highlight)</span> <span class="hljs-function">lightness(-<span class="hljs-number">10</span>%)</span>)</span></span></span>;
    <span class="hljs-rule"><span class="hljs-attribute">trasnform</span>:<span class="hljs-value"> <span class="hljs-function">rotate(<span class="hljs-number">1</span>deg)</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>Et on obtiendra</p>
<pre><code class="lang-css"><span class="hljs-tag">html</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">100</span>%</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100</span>%</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">1</span>rem</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-tag">p</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0.75</span>rem <span class="hljs-number">0</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-tag">a</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">rgba(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">8</span>)</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">-webkit-transition</span>:<span class="hljs-value"> all <span class="hljs-number">500</span>ms <span class="hljs-function">cubic-bezier(<span class="hljs-number">0.175</span>, <span class="hljs-number">0.885</span>, <span class="hljs-number">0.320</span>, <span class="hljs-number">1.275</span>)</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">transition</span>:<span class="hljs-value"> all <span class="hljs-number">500</span>ms <span class="hljs-function">cubic-bezier(<span class="hljs-number">0.175</span>, <span class="hljs-number">0.885</span>, <span class="hljs-number">0.320</span>, <span class="hljs-number">1.275</span>)</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-tag">a</span><span class="hljs-pseudo">:hover</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-function">rgba(<span class="hljs-number">204</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.8</span>)</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">transform</span>:<span class="hljs-value"> <span class="hljs-function">rotate(<span class="hljs-number">1</span>deg)</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>Gardez bien en t√™te qu‚Äôavec le code CSS d‚Äôorigine, vous avez (en majeur partie) un code futureproof.
D‚Äôici quelques temps on pourra supprimer une grande partie des plugins et les navigateurs prendront le relais üòâ.</p>
<p><em>Note: J‚Äôai ouvert <a href="https://github.com/reworkcss/rework-vars/issues/28">un ticket sur rework-vars</a> afin que celui-ci agisse comme un fallback (en rajoutant les valeurs) et non un remplacement. Je mettrais √† jour ce post dans ce sens d√®s que possible.</em></p>
<p><strong>Bon alors, on Less tomber Sass ?</strong></p>
</div><footer class="putainde-Post-footer"><div class="putainde-Post-footer-title">Action sur cette page</div><div class="Grid"><div class="Grid-cell u-size1of3"><a href="https://github.com/putaindecode/website/edit/master/pages/posts/css/preprocesseur-a-la-carte/index.md" class="putainde-Post-footer-action">Modifier</a></div><div class="Grid-cell u-size1of3"><a href="https://github.com/putaindecode/website/blame/master/pages/posts/css/preprocesseur-a-la-carte/index.md" class="putainde-Post-footer-action">Tracer les changements</a></div><div class="Grid-cell u-size1of3"><a href="https://github.com/putaindecode/website/commits/master/pages/posts/css/preprocesseur-a-la-carte/index.md" class="putainde-Post-footer-action">Historique</a></div></div></footer><div class="putainde-Author putainde-Author--author"><a href="https://github.com/MoOx" data-tip="MoOx" class="putainde-Author-picture "><img src="http://www.gravatar.com/avatar/2f6c2dcd4ba8fc44f1e7f0b2ed3d587d.png" alt="" class="putainde-Avatar js-AnimateLoad"/></a><div class="putainde-Author-description"><div class="putainde-Author-title"><h3 class="putainde-Author-name"><span class="putainde-WrittenBy">√âcrit par</span> MoOx</h3><div class="putainde-Author-social"><a href="http://moox.io/"><i class="putainde-Icon putainde-Icon--world"></i></a><a href="https://twitter.com/MoOx"><i class="putainde-Icon putainde-Icon--twitter"></i></a><a href="https://github.com/MoOx"><i class="putainde-Icon putainde-Icon--github"></i></a></div></div><p>Open source addict vivant dans la campagne pr√®s de Toulouse, Maxime est d√©veloppeur web front-end le jour, et justicier du code la nuit.   <br> Il aime faire des calins √† HTML, CSS et JavaScript en tant que freelance.</p></div></div><div class="putainde-Contributors"><strong class="putainde-Contributors-label">2 contributeurs</strong><a href="https://github.com/MoOx" data-tip="MoOx" class="putainde-Contributor AttrTip AttrTip--bottom"><img src="http://www.gravatar.com/avatar/2f6c2dcd4ba8fc44f1e7f0b2ed3d587d.png" alt="" class="putainde-Avatar js-AnimateLoad"/></a><a href="https://github.com/kud" data-tip="kud" class="putainde-Contributor AttrTip AttrTip--bottom"><img src="http://www.gravatar.com/avatar/9713e529bef70eea8965e0dda2000334.png" alt="" class="putainde-Avatar js-AnimateLoad"/></a></div><div id="disqus_thread" aria-live="polite"><noscript>| Please enable JavaScript to view the
a(href="http://disqus.com/?ref_noscript") comments powered by Disqus.</noscript></div></div></article></div><div class="putainde-Footer"><div class="Grid"><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text">¬© 1970 - 2014 Putain de Code !</p></div><div class="Grid-cell u-size6of12"><ul class="putainde-Footer-list"><li></li><li><a href="../../../feed.xml">Flux RSS</a></li><li><a href="../../../projets">Projets</a></li><li><a href="https://github.com/putaindecode/forum/issues">Forum</a></li><li><a href="irc://irc.freenode.net/putaindecode">IRC</a></li><a href="https://github.com/putaindecode/" data-tip="GitHub" class="AttrTip AttrTip--top"><i class="putainde-Icon putainde-Icon--github"></i></a><a href="https://twitter.com/putaindecode/" data-tip="Twitter" class="AttrTip AttrTip--top"><i class="putainde-Icon putainde-Icon--twitter"></i></a></ul></div><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text putainde-Footer-text--small putainde-Footer-text--right">Made with ‚ô•Ô∏é by <a href="../../../#crew">le crew</a></p></div></div></div><script>var disqus_shortname = "putaindecode";var disqus_identifier = "http://putaindecode.fr/posts/css/preprocesseur-a-la-carte/";
var disqus_url = "http://putaindecode.fr/posts/css/preprocesseur-a-la-carte/";
var disqus_script = "embed.js";;(function(d,s) {
s = d.createElement('script');s.async=1;s.src = '//' + disqus_shortname + '.disqus.com/'+disqus_script;
(d.getElementsByTagName('head')[0]).appendChild(s)
})(document)</script><script src="../../../scripts/index.js"></script><script>var _gaq=[['_setAccount','UA-43771806-1'],['_trackPageview']];
(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
g.src='//www.google-analytics.com/ga.js';
s.parentNode.insertBefore(g,s)}(document,'script'));</script></body></html>