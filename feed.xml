<?xml version="1.0" encoding="utf-8" ?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Putain de code !</title><description></description><link>http://putaindecode.fr</link><!-- generator putaindecode--><lastBuildDate>Thu, 01 May 2014 15:56:13 GMT</lastBuildDate><atom:link href="http://putaindecode.fr/feed.xml" rel="self" type="application/rss+xml"></atom:link><item><title>Introduction au testing js front</title><description><![CDATA[[
<p>Les tests automatisés en front-end ont longtemps été ignorés,
et le sont encore trop.</p>
<p>Écrire des tests peut paraître chiant, mais le temps qu&#39;ils rapportent
compense largement celui que l&#39;on passe à les écrire.</p>
<h2 id="-crire-du-js-testable">écrire du js testable</h2>
<p>Prenons un exemple simple et moche :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">//app.js</span>
;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>

  <span class="hljs-keyword">var</span> cart = $(<span class="hljs-string">"#cart"</span>)
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addToCart</span><span class="hljs-params">(id)</span>{</span>
    <span class="hljs-keyword">var</span> element = $(<span class="hljs-string">"&lt;li&gt;&lt;/li&gt;"</span>)
    element.html(catalog[id])
    cart.append(element)
  }

  $(<span class="hljs-string">".js-updateCart"</span>)
    .on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
      addToCart($(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">"id"</span>))
    })

})()
</code></pre>
<p>Tester ce code est particulièrement lourd, pour plusieurs raisons :</p>
<ul>
<li>les functions à tester ne sont pas accessibles</li>
<li>on doit simuler un <code>click</code> pour tester un comportement logique.</li>
<li>on doit créer un element et modifier sont <code>data-id</code> à chaque cas souhaité.</li>
<li>pour tester <code>addToCart</code> on doit aller regarder dans le DOM.</li>
</ul>
<h3 id="1-rendez-accessibles-vos-m-thodes-au-test-runner">1. rendez accessibles vos méthodes au test runner</h3>
<p>Vous pouvez utiliser un namespace adéquat.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> app = window.app = {}
app.cart = {}
app.cart.addToCart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span> <span class="hljs-comment">/* … */</span> }
</code></pre>
<p>Mais ne souhaitez probablement pas rendre vos méthodes accessibles à la console.</p>
<p>Utilisez un module-system : <a href="http://browserify.org">browserify</a> ou
<a href="http://requirejs.org">requirejs</a> (si vous n&#39;avez pas besoin de chargement
conditionnel et souhaitez créer un bundle par build, utilisez browserify qui
possède une syntaxe beaucoup plus sympathique et une codebase réduite, vous
pourrez même <code>require</code> depuis un module npm).</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>) <span class="hljs-comment">// oh, un module npm</span>

module.exports = {
  element : $(<span class="hljs-string">"#cart"</span>),
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-comment">/* … */</span>
  }
}
</code></pre>
<p>Vous pourrez ainsi séparer proprement votre application en modules et les tester individuellement.</p>
<h3 id="2-oui-mais-les-modules-interd-pendants-alors-">2. oui, mais les modules interdépendants alors ?</h3>
<p>Là, ça devient un peu plus tricky.
Ce que je conseille à titre personnel c&#39;est d&#39;utiliser des events
pour faire communiquer les différentes parties de l&#39;application.</p>
<p>Cela permet d&#39;éviter d&#39;utiliser des mocks d&#39;autres parties de l&#39;application partout.</p>
<p>Par exemple, si je souhaite tester le fait qu&#39;un click sur <code>.js-updateCart</code>
déclanchera bien <code>updateCart</code> :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">//view.js</span>

<span class="hljs-comment">// view est une petite class qui route les events</span>
<span class="hljs-comment">// en rendant les listeners accessibles aux tests</span>
<span class="hljs-comment">// vous pouvez très facilement en concevoir une</span>
<span class="hljs-comment">// à votre goût en quelques lignes de code</span>
<span class="hljs-keyword">var</span> view = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/view"</span>)

<span class="hljs-comment">// eventbus est l'event bus de l'application, il orchestre</span>
<span class="hljs-comment">// la communication entre les différents modules</span>
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)

<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>)

module.exports = view.extend({
  element : document.body,
  events : [
    {
      type : <span class="hljs-string">"click"</span>,
      selector : <span class="hljs-string">".js-addToCart"</span>,
      listener : <span class="hljs-string">"addToCart"</span>
    }
  ],
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    <span class="hljs-keyword">var</span> target = eventObject.currentTarget
    <span class="hljs-keyword">var</span> id = $(target).data(<span class="hljs-string">"id"</span>)
    eventbus.fire(<span class="hljs-string">"addToCart"</span>, {
      id : id
    })
  }
})
</code></pre>
<p>et je n&#39;aurais qu&#39;à écouter cet event depuis <code>cart</code> :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// cart.js</span>
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> catalog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../catalog"</span>)

module.exports = {
  initialize : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">this</span>._addToCart = <span class="hljs-keyword">this</span>.addToCart.bind(<span class="hljs-keyword">this</span>)
    eventbus.listen(<span class="hljs-string">"addToCart"</span>, <span class="hljs-keyword">this</span>._addToCart)
  },
  release : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    eventbus.stopListening(<span class="hljs-string">"addToCart"</span>, <span class="hljs-keyword">this</span>._addToCart)
  },
  addToCart : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    <span class="hljs-comment">// et on a eventObject.id</span>
    <span class="hljs-keyword">this</span>.products.push(catalog[eventObject.currentTarget.data(<span class="hljs-string">"id"</span>)])
  }
}
</code></pre>
<p>Grâce à cette architecture, je vais pouvoir tester individuellement
les deux modules.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// view.test.js</span>

<span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tape"</span>)
<span class="hljs-keyword">var</span> view = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../app/view"</span>)
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>)

tape(<span class="hljs-string">"view"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span>{</span>
  test.plan(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">var</span> element = $(<span class="hljs-string">"&lt;div&gt;&lt;/div&gt;"</span>)
  element.data(<span class="hljs-string">"id"</span>, <span class="hljs-number">1</span>)
  <span class="hljs-comment">// on teste facilement l'envoi</span>
  eventbus.listen(<span class="hljs-string">"addToCart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventObject)</span>{</span>
    test.equal(eventObject.id, <span class="hljs-number">1</span>)
  })
  view.addToCart({
    currentTarget : element
  })
})
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// cart.test.js</span>

<span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tape"</span>)
<span class="hljs-keyword">var</span> cart = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../app/cart"</span>)
<span class="hljs-keyword">var</span> eventbus = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../eventbus"</span>)
<span class="hljs-keyword">var</span> catalog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../catalog"</span>)

tape(<span class="hljs-string">"cart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span>{</span>
  cart.initialize()
  eventbus.fireSync(<span class="hljs-string">"addToCart"</span>, {id:<span class="hljs-number">1</span>})
  test.deepEqual(
    cart[<span class="hljs-number">0</span>],
    catalog[<span class="hljs-number">1</span>],
    <span class="hljs-string">"receives addToCart event"</span>
  )
  test.end()
})
</code></pre>
<h2 id="tester-tous-les-cas-possibles">tester tous les cas possibles</h2>
<p>Ce sont souvent les edge-cases qui nous font nous arracher les cheveux.
Pour pallier ces soucis, tester en profondeur est essentiel.</p>
<p>Prenons un exemple, une méthode qui teste si la valeur qu&#39;on lui passe est
une <code>string</code>.</p>
<p>On serait tenté de simplement tester les résultats positifs de cette façon :</p>
<pre><code class="lang-javascript">tape(<span class="hljs-string">"type.isString on strings"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(test)</span></span>{
  test.equal(<span class="hljs-built_in">type</span>.isString(<span class="hljs-string">""</span>), <span class="hljs-keyword">true</span>)
  test.<span class="hljs-keyword">end</span>()
})
</code></pre>
<p>Or, si par mégarde ma méthode <code>isString</code> se révèle être :</p>
<pre><code class="lang-javascript">type.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">"string"</span>
}
</code></pre>
<p>on ne vérifie pas le cas <code>type.isString(new String(&quot;&quot;))</code>.</p>
<p>Du coup, des tests complets :</p>
<pre><code class="lang-javascript">tape(<span class="hljs-string">"type.isString on strings"</span>, <span class="hljs-keyword">function</span>(test){
  test.equal(<span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">isString</span>(</span><span class="hljs-string">""</span>), <span class="hljs-keyword">true</span>)
  test.equal(<span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">isString</span>(</span><span class="hljs-keyword">new</span> String(<span class="hljs-string">""</span>)), <span class="hljs-keyword">false</span>)
  test.<span class="hljs-keyword">end</span>()
})
</code></pre>
<p>permettent ici d&#39;identifier qu&#39;en réalité on a besoin de :</p>
<pre><code class="lang-javascript">type.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> {</span>
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(value) == <span class="hljs-string">"[object String]"</span>
}
</code></pre>
<p>Et c&#39;est à la force des résultats de tests que vous identifierez rapidement
vous familiariserez à tous ces edge-cases.</p>
<p>À chaque correctif de bug, ajoutez des tests (mais ça, vous le saviez déjà).</p>
<h2 id="cross-browser-testing">cross-browser testing</h2>
<p>À l&#39;heure actuelle, où l&#39;on se trouve notamment très souvent avec du
feature testing.
Pour le tester complètement, on doit se servir de vrais navigateurs :
un headless (certes, très pratique) comme <a href="http://phantomjs.org">phantomjs</a>
ne permettra pas d&#39;obtenir 100% de coverage.</p>
<pre><code class="lang-javascript">var supportsAnimationFrame =
  !!(
    win.requestAnimationFrame <span class="hljs-string">||</span>
    win.webkitRequestAnimationFrame <span class="hljs-string">||</span>
    win.mozRequestAnimationFrame <span class="hljs-string">||</span>
    win.ORequestAnimationFrame <span class="hljs-string">||</span>
    <span class="hljs-comment">// vous avez fait une faute de frappe,</span>
    <span class="hljs-comment">// et mis un `O` majuscule, seul un</span>
    <span class="hljs-comment">// test sur les version concernées d'Opera</span>
    <span class="hljs-comment">// vous permettront de l'identifier</span>
    win.msRequestAnimationFrame
  )
</code></pre>
<p>De plus, vous pouvez par habitude être tenté d&#39;utiliser un
<code>Array.prototype.forEach</code> alors que votre scope navigateur inclut
IE8; seuls des tests sur un vrai browser vous permettront d&#39;identifier le souci.</p>
<p>Je vous conseille fortement testling, très simple à intégrer dans vos
modules, et gratuit pour tout projet open-source.</p>
<p>Dans le <code>package.json</code> :</p>
<pre><code class="lang-json">{
  "<span class="hljs-attribute">testling</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">files</span>": <span class="hljs-value"><span class="hljs-string">"test/**/*.js"</span></span>,
    "<span class="hljs-attribute">browsers</span>": <span class="hljs-value">[
      <span class="hljs-string">"ie/9..latest"</span>,
      <span class="hljs-string">"chrome/22..latest"</span>,
      <span class="hljs-string">"firefox/16..latest"</span>,
      <span class="hljs-string">"safari/6..latest"</span>,
      <span class="hljs-string">"opera/11.0..latest"</span>,
      <span class="hljs-string">"iphone/6..latest"</span>,
      <span class="hljs-string">"ipad/6..latest"</span>,
      <span class="hljs-string">"android-browser/latest"</span>
    ]
  </span>}
</span>}
</code></pre>
<p>Et ajouter un webhook dans l&#39;admin de votre repository GitHub pointant vers</p>
<blockquote>
<p><a href="http://git.testling.com">http://git.testling.com</a></p>
</blockquote>
<p>Vous pouvez l&#39;utiliser avec tape (son test harness par défaut)
Mocha, QUnit et n&#39;importe quelle bibliothèque
de test supportant <code>TAP</code> comme indiqué sur
<a href="https://ci.testling.com/guide/custom_libraries">le site de testling</a>.</p>
<p>Vous trouverez aussi des alternatives populaires
<a href="http://www.browserstack.com">similaires</a>,
ou ayant <a href="http://karma-runner.github.io">une approche différente</a>.</p>
<p>Par ailleurs, si dans votre code il existe des variations entre les navigateurs,
vous pouvez utiliser du test conditionnel :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">if</span>(typeof {}.__proto__ == <span class="hljs-string">"object"</span>){
  test.equal(<span class="hljs-keyword">list</span>.__proto__ === <span class="hljs-keyword">Array</span>.prototype, <span class="hljs-keyword">false</span>, <span class="hljs-string">"__proto__ isn't Array.prototype"</span>)
} <span class="hljs-keyword">else</span> {
  test.equal(<span class="hljs-keyword">list</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">Array</span>, <span class="hljs-keyword">false</span>, <span class="hljs-string">"Isn't a window Array"</span>)
}
</code></pre>
<p>Happy testing!</p>
<pre><code class="lang-shell">$ testling

TAP version <span class="hljs-number">13</span>
<span class="hljs-preprocessor"># tests</span>
ok <span class="hljs-number">1</span> bisous

<span class="hljs-number">1.</span><span class="hljs-number">.1</span>
<span class="hljs-preprocessor"># tests 1</span>
<span class="hljs-preprocessor"># pass  1</span>

<span class="hljs-preprocessor"># ok</span>
</code></pre>

]]></description><pubDate>Thu, 01 May 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/introduction-au-testing-js-front/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/introduction-au-testing-js-front/</guid></item><item><title>Introduction à Gulp</title><description><![CDATA[[
<p>Vous commencez tous à connaitre les <em>tasks runners</em>, ces outils qui permettent
d&#39;automatiser les tâches de développement récurrentes.
Personnellement
 <a href="http://moox.io/slides/2013/grunt-before-after/">je n&#39;ai</a>
 <a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">pas arrêté</a>
 <a href="http://moox.io/slides/2014/introduction-gulp/">d&#39;en parler</a>
 depuis que
 <a href="/posts/js/premiers-pas-avec-grunt/">Grunt</a>
 à déterré cette vielle problématique, assez récente pour le développement Web côté front end.</p>
<p>Il faut avouer que de par l&#39;évolution du développement Web, côté front end,
on voit beaucoup de personnes qui n&#39;ont pas de vraies bases de développeur.
Je veux dire par là non pas que ces personnes sont incompétentes, mais plutôt
qu&#39;il manque parfois la bonne flemme du développeur, celle qui le pousse à <strong>développer</strong>
des solutions techniques pour mieux développer des produits.
Il manque un peu <a href="http://fr.wiktionary.org/wiki/algorithmie">d&#39;algorithmie</a>
dans les veines, de curiosité et d&#39;amour du risque.
Ce n&#39;est pas en restant dans sa zone de confort qu&#39;on va de l&#39;avant. Enfin si vous
avez des exemples contraires, je suis preneur.
Mais tout cela doit provenir du fait que pas mal de métiers dans le web sont nouveaux,
dont celui de « développeur Web front end » et que du coup, peu de personnes ont
initialement suivi des formations appropriés (pour ma part je proviens d&#39;une
formation <em>d&#39;analyste-programmeur</em>, conception et développement software quoi).
Je remarque que niveau back end il y a beaucoup moins de lacunes, du fait que
les problématiques gérées de ce côté sont (il me semble) moins nouvelles.</p>
<p>Bref. Je ne vais pas m&#39;éterniser sur une intro du pourquoi on met en place un task
runner, ni faire une comparaison entre Make, Rake, Cake, Jake, Grunt, Brunch
et Broccoli.
Rentrons dans le vif. Parlons Gulp.</p>
<h1 id="pourquoi-gulp">Pourquoi Gulp</h1>
<p>Je vais faire court. Pour faire simple, son point fort réside dans le fait qu&#39;il utilise des
<a href="http://dailyjs.com/2012/09/10/streams/">streams</a> (tl;dr: un flux de données - en mémoire)
et qu&#39;il limite au maximum l&#39;utilisation de fichiers.
Au point qu&#39;il existe une <a href="https://github.com/godaddy/gulp-header/issues/4#issuecomment-32111457">police Gulp</a>
pour vous dire.
Si vous voulez en savoir plus sur les streams, n&#39;hésitez pas à lire l&#39;article de
Nicolas Froidure <a href="http://www.insertafter.com/articles-gulp_vs_grunt.html">Gulp remplacera-t-il Grunt ?</a>
qui contient une partie explicative sur les streams.</p>
<p>Dans la pratique cela évite d&#39;avoir un gruntfile qui, si on imagine une task
sass -&gt; autoprefixer -&gt; csso, passe <a href="/posts/css/mise-en-place-autoprefixer/#autoprefixer-avec-grunt">3 fois par des lectures/écritures sur le système
de fichiers</a>.</p>
<figure>
  <img src="http://jaysoo.ca/images/grunt-flow-2.png" alt="">
  <figcaption>Sans stream</figcaption>
</figure>

<p>Et du coup au lieu d&#39;avoir un fichier de conf d&#39;une soixantaine de lignes, on arrive
à avoir <a href="http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/#autoprefixer-avec-gulp">quelque chose de concis</a>
(une vingtaine de ligne seulement).</p>
<figure>
  <img src="http://jaysoo.ca/images/gulp-flow.png" alt="">
  <figcaption>Avec stream</figcaption>
</figure>

<h2 id="installation">Installation</h2>
<p>Pour avoir la commande globale sur le système (comme grunt-cli) :</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>npm i -g gulp
</code></pre>
<p>Ensuite dans votre projet :</p>
<pre><code class="lang-shell">$ npm i <span class="hljs-attribute">-D</span> gulp gulp<span class="hljs-attribute">-util</span> gulp<span class="hljs-attribute">-plumber</span> gulp<span class="hljs-attribute">-WHATEVER</span>
</code></pre>
<p><em>Note : <code>npm i -D</code> == <code>npm install --save-dev</code>, c&#39;est cadeau.</em></p>
<p>Bon dans mon exemple j&#39;ai mis un peu n&#39;importe quoi, donc on va faire un mini workflow de hipster hacker.</p>
<h2 id="utilisation">Utilisation</h2>
<p>On part avec une tâche très simple : pré-processeur CSS <a href="http://myth.io">Myth</a> et
optimisation avec <a href="https://github.com/css/csso">CSSO</a>.</p>
<pre><code class="lang-shell">$ mkdir putaindegulp <span class="hljs-subst">&amp;&amp;</span> cd putaindegulp
$ npm init
$ npm i <span class="hljs-attribute">-D</span> gulp gulp<span class="hljs-attribute">-util</span> gulp<span class="hljs-attribute">-plumber</span> gulp<span class="hljs-attribute">-myth</span> gulp<span class="hljs-attribute">-csso</span> minimist
</code></pre>
<pre><code class="lang-js">var gulp = require(<span class="hljs-string">"gulp"</span>)
  , gutil = require(<span class="hljs-string">"gulp-util"</span>)
  , plumber = require(<span class="hljs-string">"gulp-plumber"</span>)
  , myth = require(<span class="hljs-string">"gulp-myth"</span>)
  , csso = require(<span class="hljs-string">"gulp-csso"</span>)
  , options = require(<span class="hljs-string">"minimist"</span>)(process<span class="hljs-preprocessor">.argv</span><span class="hljs-preprocessor">.slice</span>(<span class="hljs-number">2</span>))

gulp<span class="hljs-preprocessor">.task</span>(<span class="hljs-string">"styles"</span>, function() {
  gulp<span class="hljs-preprocessor">.src</span>(<span class="hljs-string">"./src/css/*.css"</span>)
    <span class="hljs-preprocessor">.pipe</span>(options<span class="hljs-preprocessor">.production</span> ? plumber() : gutil<span class="hljs-preprocessor">.noop</span>())
    <span class="hljs-preprocessor">.pipe</span>(myth({sourcemap: !options<span class="hljs-preprocessor">.production</span>}))
    <span class="hljs-preprocessor">.pipe</span>(options<span class="hljs-preprocessor">.production</span> ? csso() : gutil<span class="hljs-preprocessor">.noop</span>())
    <span class="hljs-preprocessor">.pipe</span>(gulp<span class="hljs-preprocessor">.dest</span>(<span class="hljs-string">"./dist/css/"</span>))
})

gulp<span class="hljs-preprocessor">.task</span>(<span class="hljs-string">"default"</span>, [<span class="hljs-string">"styles"</span>], function() {
  gulp<span class="hljs-preprocessor">.watch</span>(<span class="hljs-string">"./src/css/**/*"</span>, [<span class="hljs-string">"styles"</span>])
})
</code></pre>
<p>Voilà c&#39;est tout. Et heureusement.</p>
<p>Bon, on se refait l&#39;exemple commenté :</p>
<pre><code class="lang-js"><span class="hljs-comment">// bah là ok, on est obligé d'y passer pour avoir l'API Gulp</span>
<span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp"</span>)

  <span class="hljs-comment">// Ça c'est optionnel, c'est pour avoir (entre autres la méthode noop())</span>
  <span class="hljs-comment">// je reviens dessus après</span>
  <span class="hljs-comment">// https://github.com/gulpjs/gulp-util</span>
  , gutil = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-util"</span>)

  <span class="hljs-comment">// Là on a Mario le plombier qui fixe la tuyauterie foireuse.</span>
  <span class="hljs-comment">// Ce plugin patch le problème de stream avec node.js qui fait que tout le process</span>
  <span class="hljs-comment">// explose à la moindre erreur (pas pratique en cas de watch par exemple)</span>
  <span class="hljs-comment">// en gros, il remplace la méthode pipe et attrape les erreurs pour les ressortir gentiment</span>
  <span class="hljs-comment">// https://gist.github.com/floatdrop/8269868</span>
  , plumber = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-plumber"</span>)

  <span class="hljs-comment">// Ici, rien de magique, du plugin en veux-tu en voilà</span>
  , myth = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-myth"</span>)
  , csso = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-csso"</span>)

  <span class="hljs-comment">// ici on chope les options de la ligne de commande</span>
  <span class="hljs-comment">// exemple: pour avoir options.production à true,</span>
  <span class="hljs-comment">// il suffit de faire `gulp --production`</span>
  , options = <span class="hljs-built_in">require</span>(<span class="hljs-string">"minimist"</span>)(process.argv.slice(<span class="hljs-number">2</span>))

<span class="hljs-comment">// Définition d'une tâche, un nom et une fonction.</span>
<span class="hljs-comment">// Ce qui est pratique c'est le fait de pouvoir mettre ce qu'on veut</span>
<span class="hljs-comment">// y compris un console.log() ^^</span>
<span class="hljs-comment">// un autre paramètre peut être ajouté avant la fonction, qui permet de préciser</span>
<span class="hljs-comment">// les dépendances (cf task dev plus bas par exemple)</span>
gulp.task(<span class="hljs-string">"styles"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

  <span class="hljs-comment">// Ici on attrape les fichiers (glob classique)</span>
  <span class="hljs-comment">// à la racine (on va considérer que nos fichiers finaux ne seront pas dans</span>
  <span class="hljs-comment">// des sous dossiers, réservés aux partials &amp; co)</span>
  gulp.src(<span class="hljs-string">"./src/css/*.css"</span>)

    <span class="hljs-comment">// On utilise plumber que si on build en dev, sinon faut que ça pête, qu'on</span>
    <span class="hljs-comment">// soit prévenu lors d'un build pour la prod</span>
    .pipe(options.production ? plumber() : gutil.noop())

    <span class="hljs-comment">// Et là on pipe nos plugins</span>
    <span class="hljs-comment">// toujours en jouant avec les options si besoin</span>
    .pipe(myth({sourcemap: !options.production}))
    .pipe(options.production ? csso() : gutil.noop())

    <span class="hljs-comment">// Super important, on convertit nos streams en fichiers</span>
    .pipe(gulp.dest(<span class="hljs-string">"./dist/css/"</span>))
})

<span class="hljs-comment">// Ici on a une tâche de dev qui lance un watch APRES avoir exécuté `styles` une fois</span>
gulp.task(<span class="hljs-string">"default"</span>, [<span class="hljs-string">"styles"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

  <span class="hljs-comment">// gulp.watch est natif (pas comme avec grunt)</span>
  <span class="hljs-comment">// vous noterez qu'ici par exemple on va surveiller tous les fichiers</span>
  <span class="hljs-comment">// et non pas ceux juste à la racine par exemple</span>
  gulp.watch(<span class="hljs-string">"./src/css/**/*"</span>, [<span class="hljs-string">"styles"</span>])
})

<span class="hljs-comment">// Comme grunt, `gulp` sans argument lancera la tâche `default`.</span>
</code></pre>
<p>Bien entendu, vous avez déjà compris que si vous voulez remplacer Myth par Sass,
c&#39;est l&#39;histoire de 4 secondes.</p>
<h2 id="putain-de-code-approuve-gulp-">Putain de Code approuve Gulp.</h2>
<p>Ici on est carrément fan de Gulp. Il faut bien avouer que
<a href="https://twitter.com/putaindecode/status/460868992396460032">ça va vite</a>
(encore plus appréciable lorsque l&#39;on n&#39;a pas de SSD) et que c&#39;est plaisant à écrire.
Pas de configurations pas spécialement verbeuse et trop espacée.
Avec Gulp on se sent plus libre, moins contraint.
Du coup, <strong>on a carrément fait notre site avec Gulp</strong>
(puis au passage un petit refresh graphique tant qu&#39;à faire).</p>
<p>Pour aller plus loin, vous n&#39;avez qu&#39;à ouvrir notre <a href="https://github.com/putaindecode/website/blob/master/Gulpfile.js">Gulpfile</a>
et regarder nos <a href="https://github.com/putaindecode/website/tree/master/tasks">tasks</a>
qui vont de <a href="https://github.com/putaindecode/website/blob/master/tasks/clean.js">la plus simple</a>
à <a href="https://github.com/putaindecode/website/blob/master/tasks/contributors.js">la plus compliqué</a>.</p>
<p>Pour voir des tâches plus « real world example » je vous invite à regarder les tasks suivantes :</p>
<ul>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/server.js">server</a>,
le server de dev local avec livereload dedans ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/watch.js">watch</a>,
le classique et si simple watcher ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/publish.js">publish</a>,
la tâche pour publier le dossier <code>dist/</code> sur les <a href="https://pages.github.com/">gh-pages</a> ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/icons.js">icons</a>,
qui transforme des SVG en fontes d&#39;icones avec le bout de CSS qui va bien ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/scripts-linting.js">scripts-linting</a>,
qui vérifie la qualité du code ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/scripts.js">scripts</a>,
du <a href="/posts/js/browserify-all-the-things/">browserify</a> pour nos JS côté client ;</li>
<li><a href="https://github.com/putaindecode/website/blob/master/tasks/stylesheets.js">stylesheets</a>,
notre tâche qui mélange (pour l&#39;instant) Stylus et Rework (suite à une rixe à la récré, on n&#39;a pas réussi à se mettre d&#39;accord, donc chacun à rajouté son morceau) ;</li>
</ul>
<p>Bien entendu, si vous ne comprenez pas certaines parties, n&#39;hésitez pas à
<a href="https://github.com/putaindecode/website/issues/new">ouvrir une issue</a>
pour demander des explications.</p>
<h2 id="vous-reprendrez-bien-un-peu-de-gulp-pardon-">Vous reprendrez bien un peu de… Gulp* ! Pardon.</h2>
<p>Si vous avez encore envie de détails je vous renvoie sur l&#39;article anglais
<a href="http://markgoodyear.com/2014/01/getting-started-with-gulp/">Getting started with gulp</a>
qui détaille tellement bien chaque point que même un anglophobe comprendrait.</p>
<p>Vous avez aussi
<a href="https://github.com/gulpjs/gulp/blob/master/docs/README.md">une documentation</a>
très bien faite, qui comporte carrément
<a href="https://github.com/gulpjs/gulp/tree/master/docs/recipes">des exemples <em>officiels</em> tout prêts</a>.</p>
<p>Comme je vous disais plus tôt, les auteurs de Gulp sont assez carrés et valident
(ou plutôt <em>invalident</em>) <a href="https://npmjs.org/search?q=gulpplugin">les plugins</a> qui
ne respectent pas les
<a href="https://github.com/gulpjs/gulp/blob/master/docs/writing-a-plugin/guidelines.md">règles</a>.
Je trouve que c&#39;est gage de qualité.</p>
<p>Pour finir quelques liens pour ceux qui en veulent toujours plus :</p>
<ul>
<li><a href="http://www.insertafter.com/articles-retour_experience_gulp.html">Gulp : Retour d&#39;expérience</a></li>
<li><a href="http://jaysoo.ca/2014/01/27/gruntjs-vs-gulpjs/">Grunt vs. Gulp, au-delà des chiffres</a> (anglais)</li>
</ul>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>gulp bisous
❯ ♡ 😘
</code></pre>

]]></description><pubDate>Tue, 29 Apr 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/introduction-gulp/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/introduction-gulp/</guid></item><item><title>Les post-processeurs CSS</title><description><![CDATA[[
<p>Vous avez surement entendu parler des <a href="http://iamvdo.me/blog/les-postprocesseurs-css"><em>post-processeurs CSS</em></a>.
J&#39;ai personnellement pas mal fait référence à <del>ce concept</del> cette expression ces derniers temps.
Que ce soit lorsque je vous racontais
<a href="/posts/css/comment-en-finir-avec-les-prefixes/">comment se passer des préfixes CSS</a>
ou lors
<a href="/posts/css/le-point-sur-les-preprocesseurs/">d&#39;un point sur les pré-processeurs CSS</a>.
N&#39;y a-t-il rien qui vous a fait tiquer ?</p>
<h2 id="du-post-processing-">Du post-processing ?</h2>
<p>Bon on va pas jouer sur les mots mais quand même un peu. <em>Post</em> ça veut dire après.
Mais après quoi ? Après du <em>processing</em>. Donc en théorie après que la feuille de
style ait été traitée.</p>
<p>Si on revient sur <em>pré-processeurs</em>, on a quelques choses de sensé.
On travaille sur la feuille de style avant qu&#39;elle n&#39;ait été traitée.
Traitée par qui ? Je dirais le navigateur pas vous ?
Dans ce cas le pré-processing est tout à fait logique.</p>
<p>Mais le post-processing ? Du vrai post-processing ça existe ? Oui et ça ressemblerait à ça par exemple :
<a href="http://jsfiddle.net/yyx990803/B5JTg/">Interpolation de CSS avec Vue.js</a> (enfin je crois).
Ici on a un process sur du CSS existant, déjà traité par le navigateur.</p>
<p>Bon ok j&#39;avoue que je pinaille un peu. On pourrait considérer que le &quot;process&quot;,
c&#39;est le fait d&#39;améliorer sa feuille de style et dans ce cas, on pourrait accepter pré- et post-process.
Mais ça reste pas super exact de mon point de vue.</p>
<p>Du coup on appelle ça comment les post-processeurs ?
Devrait-on appeler ça du <em>post-pré-processing</em> ? Je vous le demande.</p>
<p>Assez plaisanté, passons donc à l&#39;explication de ce qu&#39;on appelera le <em>post-processing.</em></p>
<h2 id="le-post-processing">Le post-processing</h2>
<p>Quel est la différence avec du pré-processing ? Pour répondre à cette question,
il faut bien définir ce qu&#39;est le pré-processing dans notre contexte.</p>
<h3 id="le-pr-processing-css">Le pré-processing CSS</h3>
<p>Le pré-processing est un pré-traitement avant le traitment final. Dans le cas de feuille de style,
on travaille donc sur des pré-feuilles de style. Ce ne sont donc pas des feuilles de style.
Comment les différencie-t-on ? La syntaxe.</p>
<p>Hola hola, calmez-vous. J&#39;en entends déjà chouiner qu&#39;avec Sass, Less et Stylus,
on peut coller du CSS valide et Ça Marche™. Oui ça marche. Mais seulement dans ce sens.
Si on essaye de faire parser un <code>@foreach</code>, <code>@include</code> ou ce genre de nouveautés
apportés par un pré-processeur, votre navigateur il va faire la gueule.</p>
<p>En effet un pré-processeur n&#39;est rien d&#39;autre qu&#39;un langage. Un nouveau.
Il ajoute des éléments à ce langage, et change même éventuellement la syntaxe.
Certes il peut s&#39;appuyer sur un langage existant (par exemple la syntaxe Scss de Sass, ou la syntaxe Less )
mais ça n&#39;est pas obligé (exemple avec l&#39;ancienne syntaxe Sass, ou encore pour changer de registre, CoffeeScript pour du JavaScript).</p>
<h3 id="diff-rence-entre-post-processing-et-pr-processing">Différence entre post-processing et pré-processing</h3>
<p>Avant de parler des différences il nous faut un cas concret pour y voir plus clair.
Autoprefixer est un très bon exemple, mais je vais vous en montrer un encore plus pertinent: les fallbacks REM.
J&#39;espère que vous connaissez le REM (root EM), cette unité CSS très utile qui permet d&#39;avoir la souplesse de l&#39;unité EM,
en se basant non sur l&#39;élement parent, mais l&#39;élement root (donc le document).
Cette unité CSS n&#39;est par exemple pas compatible avec IE8, et certain d&#39;entre vous doivent encore le supporter.</p>
<p>On a donc vu pas mal de mixins genre <code>rem2px()</code> pour ajouter un fallback, via des pré-processeurs CSS.
Sauf que là, il semble beaucoup plus pertinent de ne pas alourdir son code (car on y ajoute rien d&#39;intéressant),
surtout lorsque c&#39;est pour supporter de vieux navigateurs.
Et si on pouvait ajouter un petit coup de peinture magique, je dirais même automatique,
afin d&#39;avoir ce fallback ?</p>
<p>Et bien, on peut. Ça prend 20 secondes, et ça fera les choses bien, sans oubli.
Exemple avec <a href="https://github.com/ctalkington/rework-rem-fallback">rework-rem-fallback</a></p>
<pre><code class="lang-js"><span class="hljs-comment">// il faudrait installer les dépendances de la façon suivante</span>
<span class="hljs-comment">// $ npm i rework rework-rem-fallback</span>

<span class="hljs-keyword">var</span> rework = <span class="hljs-keyword">require</span>(<span class="hljs-string">'rework'</span>) <span class="hljs-comment">// le moteur rework, je reviens dessus après</span>
  , remFallback = <span class="hljs-keyword">require</span>(<span class="hljs-string">'rework-rem-fallback'</span>) <span class="hljs-comment">// le plugin rework</span>

  <span class="hljs-comment">// lecture du fichier css</span>
  , css = <span class="hljs-keyword">require</span>(<span class="hljs-string">'fs'</span>).readFileSync(<span class="hljs-string">'dist/index.css'</span>, <span class="hljs-string">'utf8'</span>).toString()

  <span class="hljs-comment">// on traite le CSS en indiquant à rework la source, et le plugin à utiliser</span>
  , out = rework(css).<span class="hljs-keyword">use</span>(remFallback()).toString()

  <span class="hljs-comment">// ici on fait la même chose, mais comme si la font de base était en 14px</span>
  , out14 = rework(css).<span class="hljs-keyword">use</span>(remFallback(<span class="hljs-number">14</span>)).toString()
</code></pre>
<p>Avec l&#39;exemple d&#39;avant, et ce bout de CSS:</p>
<pre><code class="lang-css"><span class="hljs-class">.main-header</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">5</span>rem </span></span></span>}
</code></pre>
<p>... On obtiendra le résultat suivant:</p>
<pre><code class="lang-css"><span class="hljs-class">.main-header</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">80</span>px</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">5</span>rem</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>Notre exemple n&#39;est pas intégré dans un
<a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">workflow automatisé</a>,
mais c&#39;est juste pour vous montrer que c&#39;est l&#39;histoire de 5 lignes de code
et pas autant de lignes que de fois où l&#39;on a <code>rem</code> dans sa feuille de style.</p>
<p>Sexy n&#39;est-ce pas ?</p>
<p>L&#39;autre grosse différence entre le pré- et le post-processing, c&#39;est le langage.
Ce post-processing s&#39;effectue après du pré-processing. Donc après que le pré-processeur,
cet autre langage, ait fait son boulot.</p>
<p><strong>Le post-processing s&#39;effectue sur du CSS de manière transparente.</strong></p>
<p><em>Ce processing s&#39;effectue sur du vrai CSS (disons la syntaxe CSS).</em></p>
<p>Cette syntaxe étant très simple (se résumant principalement à <code>selecteur { prop: value }</code> - oui y&#39;a les règles <code>@*</code> en plus je sais),
<a href="https://github.com/reworkcss/css-parse#performance">c&#39;est très rapide à parser</a>.</p>
<h2 id="pourquoi-du-post-processing-">Pourquoi du post-processing ?</h2>
<p>Comme on vient de le voir avec les 2 points précédents, on a déjà 3 bonnes raisons :</p>
<ul>
<li>la simplicité (pour certains cas de figures, c&#39;est plus pertinent, ça évite trop de code et des
oublis)</li>
<li>la vitesse</li>
<li>le fait de pouvoir brancher ses propres plugins</li>
</ul>
<p>Je sais pas vous mais moi ça me suffit. Et en cherchant mieux, on pourrait sûrement trouver d&#39;autres arguments.
(<em>Rappel : d&#39;ailleurs n&#39;hésitez pas à modifier cet article si vous en avez</em>).</p>
<h2 id="avec-quoi-doit-on-post-processer-ces-css-">Avec quoi doit-on post-processer ces CSS ?</h2>
<p>Comme vous avez pu le voir tout à l&#39;heure j&#39;ai pris dans un exemple Rework,
mais il existe aussi PostCSS, plus récent.</p>
<h3 id="-rework-https-github-com-reworkcss-rework-"><a href="https://github.com/reworkcss/rework">Rework</a></h3>
<p>Rework a été initié par le grand <a href="https://github.com/visionmedia">TJ Holowaychuck</a>,
cette machine de guerre (<a href="http://www.quora.com/TJ-Holowaychuk-1/How-is-TJ-Holowaychuk-so-insanely-productive">que certains ne pensent même pas humain</a> pour vous dire).
TJ était il fut un temps utilisateur de Sass, il avait donc même commencé le
portage de <a href="https://github.com/stunti/sass.js">Sass en Node</a>.
Il a dû se rendre compte bien avant nous que ce n&#39;était finalement pas forcément la meilleure option.
Il a donc développé <a href="https://github.com/LearnBoost/stylus/">Stylus</a> (si, si, c&#39;est bien lui),
le temps de comprendre qu&#39;une autre approche était possible (pour info, il ne maintient maintenant plus Stylus).</p>
<p>C&#39;est donc <a href="https://github.com/reworkcss/rework/commit/0a7be255bfe753d03f93c7072351266fa636e80a">le 1er Septembre 2012 qu&#39;il pousse la première version de Rework</a>.</p>
<p>L&#39;objectif de Rework n&#39;est pas spécialement de gérer du post-process.
Rework se place comme un manipulateur de CSS, permettant (entre autres) :</p>
<ul>
<li>l&#39;automatisation d&#39;ajout des préfixes</li>
<li>la création de nouvelles propriétés</li>
<li>l&#39;intégration d&#39;images inline</li>
</ul>
<p>Vous me direz que ça ressemble vachement à un pré-processeur n&#39;est-ce pas ?
Vu l&#39;historique que je viens de vous conter et <a href="https://github.com/reworkcss/rework#plugins">les plugins par défaut</a>,
vous aurez bien compris que c&#39;est l&#39;idée : faire un moteur de pré-processeur où l&#39;on y branche des plugins pour ajouter nos propres fonctionnalités.
C&#39;est grâce à ce projet qu&#39;Autoprefixer a initialement vu le jour d&#39;ailleurs.</p>
<h3 id="-postcss-https-github-com-ai-postcss-"><a href="https://github.com/ai/postcss">PostCSS</a></h3>
<p>Beaucoup plus récent, PostCSS a été écrit par l&#39;auteur d&#39;Autoprefixer.</p>
<blockquote>
<p>Heu mais quoi ? Tu viens de nous dire que Autoprefixer utilisait Rework ?!</p>
</blockquote>
<p>Oui <em>c&#39;était</em> le cas. <em>Utilisait</em>. L&#39;auteur de PostCSS s&#39;explique dans <a href="https://github.com/ai/postcss#rework">son README</a>.
Il y indique que, bien que très similaire, Rework et PostCSS n&#39;ont pas été développé pour les mêmes raisons.
C&#39;est ce qui explique les différences au niveau des moteurs.
PostCSS se veut plus préservateur par rapport à votre source d&#39;origine,
et gère donc mieux sourcemap, peut conserver votre espacement et indentation,
parse de manière plus sécurisé (vu que ça se veut mieux gérer le code legacy).</p>
<p>Dans la pratique je n&#39;ai jamais eu de problème avec Rework, me souciant peu de la mise en forme de la sortie CSS.
Mais PostCSS semble avoir une API plus haut niveau et plus souple pour mieux travailler les feuilles de styles.</p>
<h3 id="rework-ou-postcss-">Rework ou PostCSS ?</h3>
<p>Tout dépend ce que vous voulez faire. Si vous avez en tête l&#39;idée de développer un outil,
je pencherais plus vers PostCSS. Mais en temps qu&#39;utilisateur, pour l&#39;instant, définitivement Rework.</p>
<p>Ce dernier a clairement beaucoup plus de plugins existants. Voyez par vous-mêmes :</p>
<ul>
<li><a href="https://www.npmjs.org/search?q=rework">npmjs.org/search?q=rework</a></li>
<li><a href="https://www.npmjs.org/search?q=postcss">npmjs.org/search?q=postcss</a></li>
</ul>
<h2 id="rework-ce-n-est-pas-_que_-du-post-processing-">Rework ce n&#39;est pas <em>que</em> du post-processing ?</h2>
<p>Oui en effet, comme je le disais avant, c&#39;est pas le but. C&#39;est du &quot;processing&quot;.
Pré-, post-... Qu&#39;est-ce que ça change dans le fond hein ?</p>
<p>L&#39;idée, en temps que développeur, est d&#39;améliorer le confort d&#39;écriture sans contrainte.
Comme je l&#39;ai indiqué <a href="/posts/css/le-point-sur-les-preprocesseurs/#mon-avis-sur-les-pr-processeurs">précédemment</a>,
j&#39;ai laché les pré-processeurs &quot;classiques&quot; ayant l&#39;impression d&#39;utiliser un tank pour tuer une mouche.
Car au fond pour 90% (si ce n&#39;est plus) d&#39;entres nous,
que nous faut-il pour bien développer des feuilles de styles ?
Un peu d&#39;organisation, des variables et un poil de math ?
Personnellement je me contente de ça. Pour l&#39;organisation, je suis devenu fan de BEM
(on vous en parle bientôt).</p>
<p><strong>Et en attendant de vraiment pouvoir utiliser les variables CSS associé à <code>calc()</code>,
je reste sur du <em>custom pré-processing</em> via Rework avec lequel je peux coder avec la syntaxe des specs (même si c&#39;est en draft), plus future-proof.</strong></p>
<p>J&#39;aime conserver la syntaxe CSS et avoir un process ultra-rapide et transparent.</p>
<h3 id="prochaine-tape-faire-son-propre-pr-post-processeur-css-c-est-simple">Prochaine étape: faire son propre pré/post-processeur CSS, c&#39;est simple</h3>
<p>Rework ayant un bon petit paquet de plugins déjà existants, c&#39;est assez simple de réaliser son propre pré-processeur via quelques lignes de code seulement.
La mise en place et l&#39;automatisation feront l&#39;objet d&#39;un prochain article !</p>

]]></description><pubDate>Tue, 08 Apr 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/les-post-processeurs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/les-post-processeurs/</guid></item><item><title>Le point sur les pré-processeurs CSS</title><description><![CDATA[[
<h2 id="pourquoi-les-pr-processeurs">Pourquoi les pré-processeurs</h2>
<p>Voilà ce que j&#39;ai écrit en 2011 dans
<a href="http://moox.io/blog/utiliser-des-variables-fonctions-css/">mon premier post sur les pré-processeur</a>.
Je venais de découvrir cette notion et j&#39;avais donc fait le tour de la question.</p>
<blockquote>
<p>Le langage des CSS n’a pas de côté dynamique. C’est lui avec lequel, à chaque
fois qu’on intègre une maquette graphique, on doit se taper tout de zéro.
Il a beau exister des CSS « Reset », des frameworks CSS, tout un tas de
grilles prête à l’emploi, des composants de CSS réutilisables avec l’approche
objet, je n’ai jamais réellement était satisfait par ces méthodes, que ce soit
à cause des contraintes qu’impose la syntaxe (devoir mettre des classes à tout
va dans l’HTML ça peut vite devenir chiant dans un CMS), ou par d’éventuelles
limitations qui obligent à « trop » modifier la source du document (pas assez
de, ou trop de, ou seulement ça ne me plait pas comment c’est fait).</p>
</blockquote>
<p>J&#39;avais tout dit, même des trucs qu&#39;aujourd&#39;hui je pense être des conneries (il
n&#39;y a que les cons qui ne changent pas d&#39;avis + c&#39;est en faisant des erreurs
qu&#39;on apprend le mieux), mais je reviendrais dessus plus tard.</p>
<p>Du coup on en retire quoi ? Qu&#39;utiliser un pré-processeur se justifie par
l&#39;ajout de fonctionnalités lorsque vous écrivez des feuilles de style (en tant
que développeur). En tant qu&#39;utilisateur du code produit, cela va permettre
d&#39;ajouter une couche abstraction (ce qui peut poser des problèmes, je reviendrais
sur ce point plus tard).</p>
<h2 id="principales-fonctionnalit-s">Principales fonctionnalités</h2>
<ul>
<li>variables</li>
<li>fonctions</li>
<li>mixins (permettant de réaliser des sorties CSS paramétrables)</li>
<li><code>@import</code> intelligent (pas côté client)</li>
<li>nesting (imbrications des sélecteurs pour éviter la répétition)</li>
<li>optimisation et abstraction poussée (via les mixins, placeholders et <code>@extend</code>)</li>
</ul>
<p>Anciennement on aurait rajouté à cette liste la gestion du CSS 3, mais comme
je l&#39;expliquais il y a peu, ce n&#39;est plus nécessaire, on a une méthode bien
mieux, rapide et surtout <b>maintenu à jour</b> avec
<a href="/posts/css/comment-en-finir-avec-les-prefixes/">AutoPrefixer</a></p>
<h2 id="les-principaux-pr-processeurs">Les principaux pré-processeurs</h2>
<h3 id="-sass-http-sass-lang-com-"><a href="http://sass-lang.com/">Sass</a></h3>
<p>Sass est à mon avis le plus mature des pré-processeurs CSS.
Il possède 2 syntaxes (une indentée et une plus proche de CSS).
Ce projet avance à bon rythme. Niveau fonctionnalités, rien à dire si ce n&#39;est que
celui-ci a un petit plus pour avec la feature <code>@content</code> qui permet pour le coup de
passer tout un bloc de propriétés en paramètre à des mixins. Ce qui est super
pratique lorsque l&#39;on écrit pas mal de media queries.
(Après, venez pas me dire qu&#39;on a plein de fois les media-queries qui se
répètent et que ce n&#39;est pas bien pour la taille du fichier, gzip se chargera de ça -
<small><a href="https://twitter.com/kaelig/status/412909849207644160">exemple similaire</a>)</small>.</p>
<p>Le langage Sass possède une implémentation d&#39;origine en Ruby mais aussi depuis
quelques temps une implémentation C qui se veut beaucoup plus rapide et portable:
<a href="http://libsass.org/">libsass</a> mais qui est encore un peu en retard niveau
fonctionnalité (affaire à suivre). Surtout depuis la version 3.3 qui possède de
nouvelles fonctionnalités (comme les maps, entre autres).</p>
<p>Avec ce pré-processeur, on peut s&#39;éloigner pas mal du CSS natif, que ce soit avec
la syntaxe ou l&#39;aspect programmation (il n&#39;y a qu&#39;à voir des trucs comme
<a href="https://github.com/Team-Sass/modular-scale">modular-scale</a> ou
<a href="https://github.com/HugoGiraudel/SassyMatrix">SassyMatrix</a>).</p>
<p>Bibliotèques construites sur Sass :</p>
<ul>
<li><a href="http://compass-style.org/">Compass</a>, solide, basé sur Ruby (incompatible libsass),</li>
<li><a href="http://bourbon.io/">Bourbon</a>, plus light mais plus rapide.</li>
</ul>
<h3 id="-less-http-lesscss-org-"><a href="http://lesscss.org/">LESS</a></h3>
<p>Je n&#39;ai pas trop envie de parler de ce pré-processeur assez classique, qui a fait un
choix assez étrange pour les variables par exemple (oui, <code>@</code> est un caractère
spécial en CSS, c&#39;est assez étrange de rajouter une couche avec pour les variables
avec ce dernier).
J&#39;espère seulement que ceux qui l&#39;utilisent aujourd&#39;hui n&#39;utilise pas le script côté client
(ce qui provoquerait un affichage sans CSS si le client n&#39;a pas JavaScript activé).
Bien qu&#39;il soit populaire, le repository sur GitHub n&#39;est pas signe de bonne santé
à mes yeux. Voir des pull-requests qui traînent vielles de plusieurs
<del>mois</del> <ins>années</ins> me laissent dubitatif...
Puis il n&#39;y a qu&#39;à voir l&#39;exemple sur la homepage du site avec les box-shadow,
pour voir que ce pré-processeur est assez déprécié.</p>
<p>Ajoutons à cela le fait que Twitter Boostrap a (enfin) une version Sass...</p>
<p>Côté fonctionnalités, l&#39;aspect programmation est assez laborieux avec la façon dont
sont gérés les mixins conditionnels. Je passe sur ce point gerbant.</p>
<p>Bibliotèques construites sur Less :</p>
<ul>
<li><a href="http://lesshat.madebysource.com/">LESS Hat</a>,</li>
<li><a href="http://lesselements.com/">LESS Elements</a>.</li>
</ul>
<h3 id="-stylus-http-learnboost-github-io-stylus-"><a href="http://learnboost.github.io/stylus/">Stylus</a></h3>
<p>Stylus se veut plus transparent que les autres pré-processeurs. C&#39;est un point
réussi puisqu&#39;il permet d&#39;avoir des mixins transparents au niveau écriture.
Cela peut par contre bien entendu rendre la maintenance et la compréhension plus
difficile si on en abuse.
Il permet aussi de coder sans <code>{}</code> ni <code>:</code> ni <code>;</code> (bien que tout cela soit optionnel)</p>
<p>Niveau fonctionnalités cela ne vaut pas Sass. Ici pas de <code>@content</code> ou de maps.</p>
<p>Bibliotèque construite sur Stylus :</p>
<ul>
<li><a href="http://visionmedia.github.io/nib/">Nib</a></li>
</ul>
<h3 id="alternatives">Alternatives</h3>
<p>On peut s&#39;amuser à faire un pré-processeur CSS avec n&#39;importe quel langage c&#39;est
évident.
Mais <a href="http://www.alsacreations.com/astuce/lire/1433-utiliser-php-pour-gerer-vos-styles-css.html">les enfants, ne faites pas ça.</a>
À moins que vous souhaitiez alourdir vos CSS plus que vous y gagnerez.
Puis si c&#39;est juste pour ajouter des variables, il existe d&#39;autres solutions...</p>
<p><em>Note: si vous avez d&#39;autres pré-processeurs intéressants, je me ferais un plaisir
de les ajouter ici. Mais bon <a href="https://github.com/putaindecode/website/blob/master/pages/posts/css/le-point-sur-les-preprocesseurs/index.md">vous pouvez aussi le faire tout seul comme un
grand</a>.</em></p>
<h2 id="les-pr-processeurs-sont-ils-vraiment-n-cessaire-">Les pré-processeurs sont-ils vraiment nécessaire ?</h2>
<blockquote>
<p>Oula. Le mec vient de nous poser un post pour nous parler des pré-processeurs,
et il nous sort une question comme ça ? Il est où le piège ?</p>
</blockquote>
<p>Si je pose la question c&#39;est que j&#39;ai une petite réponse par là. Et elle ne va
peut-être pas vous plaire.</p>
<p>Je vais revenir sur certains points qui peuvent poser problème avec les pré-processeurs.</p>
<h3 id="le-nesting-cay-mal">Le nesting cay mal</h3>
<p>Ahh... Le nesting, c&#39;est bien pratique lorsque l&#39;on travaille sur un CMS
(ou n&#39;importe quoi ayant un code HTML qu&#39;on ne maitrise pas facilement)
de pouvoir utiliser le nesting pour pouvoir rapidement produire les sélecteurs adéquats.
Mais en terme de maintenance et surtout de réutilisation, c&#39;est vraiment à chier.
Faut dire ce qui est.</p>
<pre><code class="lang-scss">.widget {
 <span class="hljs-comment"> // titre</span>
  h3 { }

 <span class="hljs-comment"> // widget body</span>
  &gt; <span class="hljs-operator">div</span> {

   <span class="hljs-comment"> // liste</span>
    ul {

    }
  }
}
</code></pre>
<p>Cet exemple est parfait pour démontrer les limites du nesting.
Comment faire si, sur un widget donnée, nous avons comme titre un h2 ou h4 ?
Il faut alourdir la CSS. Pareillement, si notre fameuse liste dans le corps n&#39;est
pas dans la même arborescence que celle décrite, il faut à nouveau alourdir notre CSS.
Sans rentrer dans ces solutions solides (nous parlerons de BEM très bientôt),
cette solution serait bien plus élégante pour la réutilisation :</p>
<pre><code class="lang-css"><span class="hljs-class">.widget</span> <span class="hljs-rules">{<span class="hljs-rule">}</span></span>

  <span class="hljs-class">.widget-title</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.widget-body</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>

    <span class="hljs-class">.widget-body-list</span> <span class="hljs-rules">{ <span class="hljs-rule">}</span></span>
</code></pre>
<p>Vous remarquerez que j&#39;ai un code ici beaucoup plus compréhensible par un nouveau,
mais aussi bien mieux réutilisable et surtout, point très important, non couplé
(non dépendant) à notre arborescence HTML (coucou le DOM).
De plus, utiliser le nesting provoque des sélecteurs à rallonges, après c&#39;est la
course à la longueur (et au poids) des sélecteurs quand il faut surcharger une
règle héritée.
Avec de simple sélecteurs, pas de souci de ce genre là.</p>
<p><em>ProTip™ : vous remarquerez que j&#39;indente mon CSS à l&#39;image des composants, ça mange
pas de pain, est cela facilite la lecture, moins linéaire.</em></p>
<p>Donc je reviens sur ce que je disais, il faut utiliser pleins de classes dans l&#39;HTML.
Ça sert à ça. Votre CSS produit de cette façon sera bien plus réutilisable.</p>
<h3 id="l-abstraction-cay-dangereux">L&#39;abstraction cay dangereux</h3>
<p>On en revient à la magie. Lorsqu&#39;on a trop de couche qui cache ce qu&#39;il y a
réellement sous le capot, <a href="http://linuxfr.org/news/encore-un-exemple-de-code-spaghetti-toyota">on peut vite perdre le contrôle</a>.</p>
<p>Et voici <a href="https://github.com/MoOx/compass-recipes/issues/104">un parfait exemple</a>
où un utilisateur de ma bibliothèque <a href="https://github.com/MoOx/compass-recipes">Compass Recipes</a>
avait un problème lorsqu&#39;il utilisait 2 mixins qui cachaient trop de code.
Dans  notre cas corners-tucked (version coin scotché) et background-noise (bruit visuel).
Il en a perdu des choses simples et avait passé beaucoup de temps à se prendre la tête
alors que la solution était très (trop) simple (une histoire entre <code>background-image</code>
et le shorthand <code>background</code>).</p>
<p>Je me laisse souvent attirer par la magie d&#39;un code, mais mon expérience m&#39;indique
aujourd&#39;hui qu&#39;il ne faut pas abuser de cette partie mystérieuse où l&#39;on ne sait
plus ce qui se passe.</p>
<p>Je vous laisse imaginer du nesting caché dans des mixins qui utilisent d&#39;autres mixins
qui font des @extends de placeholders...</p>
<blockquote>
<p>Un grand pouvoir implique de grandes responsabilités.</p>
</blockquote>
<p>Tout est dit. Il faut faire attention. Très attention.</p>
<h2 id="mon-avis-sur-les-pr-processeurs">Mon avis sur les pré-processeurs</h2>
<p>Je pense que les pré-processeurs restent utiles mais seulement pour des projets
de très grosse envergure, qui possède énormément de code CSS et/ou extrêmement dynamique.
Ou que vous utilisez de solutions comme <a href="http://getbootstrap.com/">Bootstrap</a> ou
<a href="http://foundation.zurb.com/">Foundation</a>, chose que je déconseille pour autre chose que des prototypes.</p>
<p>De part mon expérience et mon recul (si si j&#39;en prends je vous jure), je pense que
j&#39;aurais pu m&#39;en passer bien plus souvent que j&#39;ai voulu l&#39;admettre par le passé.
Mais bon comme je dis souvent, quel plaisir de se planter quand ce n&#39;est pas dans un platane !</p>
<p>Ce qu&#39;il faut retenir clairement c&#39;est que ce ne sont pas les pré-processeurs qui
vont vous faire écrire des meilleurs feuilles de styles. C&#39;est plus un travail sur
une méthodologie et  une organisation adapté à vos besoins qui amélioreront
votre quotidien de webdesigner (oui quoi, dès qu&#39;on code du CSS, on peut
utiliser l&#39;appellation webdesigner sur son CV, ça en jete).</p>
<p>J&#39;ai donc longtemps apprécié les pré-processeurs CSS, mais aujourd&#39;hui je commence
à leur tourner le dos du fait que je n&#39;utilise que trop peu de leurs fonctionnalités.
J&#39;évite l&#39;overkill quoi.</p>
<p>Quand on voit que des <em>grands</em> de l&#39;HTML / CSS comme <a href="http://nicolasgallagher.com/">@necolas</a>
n&#39;utilise pas de pré-processeur, on a de quoi se poser des questions.
Avec une bonne bibliothèque comme <a href="https://github.com/suitcss/suit/">SUIT CSS</a>,
on s&#39;en retrouve à ne manquer que des petites choses.</p>
<p>Que l&#39;on peut combler.</p>
<p>Avec les post-processeurs par exemple.</p>
<p>J&#39;ai donc à ce jour moi aussi conservé une couche pour ajouter le minimum vital en tant que développeur.</p>
<p>Mais ne voulant pas alourdir ce post consacré aux pré-processeurs CSS,
vous pourrez continuer la lecture au prochain épisode qui sera consacré aux post-processeurs...</p>
<p><small>(Mamam, t&#39;as vu ce cliffhanger digne des séries US !)</small></p>
<p>Bon promis la prochain fois je vous en parle des post-processeurs. Pour de vrai.</p>

]]></description><pubDate>Tue, 11 Mar 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/le-point-sur-les-preprocesseurs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/le-point-sur-les-preprocesseurs/</guid></item><item><title>Mise en place d’autoprefixer</title><description><![CDATA[[
<p>Suite à mon précédent article <a href="/posts/css/comment-en-finir-avec-les-prefixes/">Comment en finir avec les préfixes CSS</a>,
certains sont restés sur leur faim.
Voici donc de rapides exemples de mise en place de cette solution.</p>
<h2 id="installation-d-autoprefixer">Installation d’autoprefixer</h2>
<p>Il vous faudra <a href="http://nodejs.org/">Node.js</a> (qui embarque maintenant <a href="https://www.npmjs.org/">Npm</a>) afin de pouvoir
installer ce nouveau joujou.</p>
<pre><code class="lang-shell"><span class="hljs-comment"># on install autoprefixer via npm en global</span>
$ <span class="hljs-built_in">npm</span> install --<span class="hljs-built_in">global</span> autoprefixer
<span class="hljs-comment"># ou pour les fainéants</span>
$ <span class="hljs-built_in">npm</span> i -g autoprefixer
</code></pre>
<p>Une fois ceci fait, vous devriez avoir la commande <code>autoprefixer</code> disponible.
On vérifie de suite avec <code>autoprefixer -v</code>.</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer -v
autoprefixer <span class="hljs-number">1.0</span>.<span class="hljs-number">20140203</span>
</code></pre>
<p>Vous remarquerez que le numéro de version est un peu spécial : il contient une
date en place d’un numéro de patch. Cette date correspond à la dernière mise à
jour de la base de données de <em>Can I Use</em>.</p>
<h2 id="utilisation-d-autoprefixer">Utilisation d’autoprefixer</h2>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer *.css
</code></pre>
<p>C’est aussi simple que ça.</p>
<p>En fait non je plaisante, c’est un tout petit peu plus long car par défaut,
comme beaucoup de commandes, vous allez avoir la sortie crachée en plein visage.</p>
<p>Pour voir les options, comme d’habitude <code>--help</code> ou <code>-h</code> :</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>autoprefixer -h
</code></pre>
<p>On y apprend l’existance des options suivantes :</p>
<pre><code>Options:
  -<span class="ruby">b, --browsers <span class="hljs-constant">BROWSERS</span>  add prefixes <span class="hljs-keyword">for</span> selected browsers
</span>  -<span class="ruby">o, --output <span class="hljs-constant">FILE</span>        set output file
</span>  -<span class="ruby">d, --dir <span class="hljs-constant">DIR</span>            set output dir
</span>  -<span class="ruby">m, --map                generate source map
</span>  -<span class="ruby">i, --info               show selected browsers <span class="hljs-keyword">and</span> properties
</span>  -<span class="ruby">h, --help               show help text
</span>  -<span class="ruby">v, --version            print program version</span>
</code></pre><p>Du coup si on veut faire un coup de commande bien personnalisée on pourra faire :</p>
<pre><code class="lang-shell">$ autoprefixer -b <span class="hljs-string">"last 2 versions, &gt; 1%, Explorer 7, Android 2"</span> -o prefixed<span class="hljs-preprocessor">.css</span> index<span class="hljs-preprocessor">.css</span>
</code></pre>
<p>Il va par contre nous falloir un fichier css pour tester :</p>
<pre><code class="lang-shell"><span class="hljs-comment"># on met un peu de CSS dans index.css manière de tester le bouzin</span>
$ <span class="hljs-built_in">echo</span> <span class="hljs-string">"* { box-sizing:border-box}"</span> &gt; index.css
</code></pre>
<p>On peut donc essayer notre commande plus haut qui va remplir le fichier <code>prefixed.css</code></p>
<p>Pour vérifier :</p>
<pre><code class="lang-shell">$ cat prefixed<span class="hljs-built_in">.</span>css
<span class="hljs-subst">*</span> { <span class="hljs-attribute">-webkit</span><span class="hljs-attribute">-box</span><span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>; <span class="hljs-attribute">-moz</span><span class="hljs-attribute">-box</span><span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>; box<span class="hljs-attribute">-sizing</span>:border<span class="hljs-attribute">-box</span>}
</code></pre>
<p>On a bien eu des préfixes ajoutés en fonction de notre demande (bon rien pour IE
qui n’est pas passé par une version préfixé)</p>
<p>Par défaut, <em>autoprefixer</em> utilise <code>&gt; 1%, last 2 versions, Firefox ESR, Opera 12.1</code> pour les navigateurs.
Je pense que pour la plupart d’entre vous voudront ajouter &quot;Explorer 8&quot; à la liste, mais ça
n’est en théorie pas nécessaire vu le permier argument qui demande de préfixer tous les navigateurs
dont l’usage global est supérieur à 1%. Peut-être Explorer 7 pour certains ?
Faites un tour sur la <a href="http://caniuse.com/usage_table.php">page dédié aux statistiques globales sur CanIUse.com</a> pour avoir une idée.</p>
<p>Sinon, pour du petit one shot, un plugin dans votre éditeur suffira:</p>
<ul>
<li><a href="https://github.com/sindresorhus/atom-autoprefixer">plugin autoprefixer pour Atom</a></li>
<li><a href="https://github.com/sindresorhus/sublime-autoprefixer">plugin autoprefixer pour Sublime Text</a></li>
<li><a href="https://github.com/mikaeljorhult/brackets-autoprefixer">plugin autoprefixer pour Brackets</a></li>
</ul>
<figure>
  <img src="../../../images/posts/sublime-text/autoprefixer.gif" alt="sublime text autoprefixer preview">
  <figcaption>Intégration dans Sublime Text</figcaption>
</figure>

<h2 id="automatisation-d-autoprefixer-autoception-">Automatisation d’autoprefixer (autoception)</h2>
<p>Bien entendu on va pas se taper la commande à la main tout le temps hein...
Il nous faut automatiser nos processus. Sans quoi on perd du temps, et
<a href="http://deboutlesgens.com/blog/jai-pas-le-temps-la-pire-excuse-qui-soit/">le temps... C’est du temps !</a></p>
<p>Donc, comme je l’ai dit précédemment, on peut utiliser <em>autoprefixer</em> avec les solutions
suivantes:</p>
<ul>
<li>via <a href="https://github.com/ai/autoprefixer#nodejs">Node.js</a> directement,</li>
<li>en plugin <a href="https://www.npmjs.org/package/gulp-autoprefixer">Gulp</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#grunt">Grunt</a>,</li>
<li>via <a href="https://github.com/ai/autoprefixer#compass">Compass</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#stylus">Stylus</a>,</li>
<li>avec <a href="https://github.com/ai/autoprefixer#ruby-on-rails">RoR</a> ou <a href="https://github.com/ai/autoprefixer#ruby">Ruby</a>,</li>
<li>avec l’application <a href="https://github.com/ai/autoprefixer#prepros">Prepros</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#mincer">Mincer</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#middleman">Middleman</a></li>
<li>avec <a href="https://github.com/ai/autoprefixer#php">PHP</a> (vous avez bien lu)</li>
</ul>
<p>Si vous avez besoin, je pense que vous trouverez sans trop de problème d’autres
implémentations.</p>
<p>Cela dit, je vais vous montrer quelques cas d’utilisations:</p>
<h3 id="make">Make</h3>
<p>Là c’est facile, tout bon développeur doit avoir <code>make</code> sur sa machine (sinon
c’est que t’es pas développeur, je sais pas trop ce que tu fais ici du coup).</p>
<p>On peut tout simplement créer un fichier <code>Makefile</code> avec la commande précédente:</p>
<pre><code class="lang-shell"><span class="hljs-comment"># création d’un dossier pour notre popote (puis on va dedans...)</span>
<span class="hljs-variable">$ </span>mkdir autoprefixer-test &amp;&amp; cd autoprefixer-test

<span class="hljs-comment"># On créer un makefile avec une tâche `css` (création/écrasement via &gt;)</span>
<span class="hljs-variable">$ </span>echo <span class="hljs-string">"css:"</span> &gt; <span class="hljs-constant">Makefile</span>

<span class="hljs-comment"># On vérifie qu’on a bien rempli le fichier</span>
<span class="hljs-variable">$ </span>cat <span class="hljs-constant">Makefile</span>

<span class="hljs-comment">## On ajoute notre commande au fichier (ajout au fichier existant via &gt;&gt;)</span>
<span class="hljs-variable">$ </span>echo <span class="hljs-string">"\tautoprefixer index.css -b \"last 2 versions, &gt; 1%, Explorer 7, Android 2\" -o prefixed.css"</span> &gt;&gt; <span class="hljs-constant">Makefile</span>

<span class="hljs-comment"># On vérifie qu’on a bien rempli le fichier</span>
<span class="hljs-variable">$ </span>cat <span class="hljs-constant">Makefile</span>
</code></pre>
<p>Voilà votre Makefile doit être bien rempli. Pour tester la commande <code>css</code>:</p>
<pre><code class="lang-shell"><span class="hljs-variable">$ </span>make css
</code></pre>
<p>Vous remarquerez que la commande <em>autoprefixer</em> s’affiche, si ça vous embête, rajoutez
<code>@</code> devant. Vous pouvez modifier votre Makefile dans ce sens:</p>
<pre><code><span class="hljs-label">css:</span>
    echo <span class="hljs-string">"❯ Autoprefixage magique."</span>
    @autoprefixer index<span class="hljs-preprocessor">.css</span> -b <span class="hljs-string">"last 2 versions, &gt; 1%, Explorer 7, Android 2"</span> -o prefixed<span class="hljs-preprocessor">.css</span>
</code></pre><p><em>Attention : Les Makefiles utilisent des tabulations uniquement ! Sans quoi cela
ne va pas marcher comme prévu.</em></p>
<p>Vous avez donc maintenant un exemple assez simpliste qui peut être utilisé si
vous n’avez pas encore <a href="http://www.24joursdeweb.fr/2013/automatisez-votre-workflow-front-end/">automatisé votre workflow</a>
via des outils comme <a href="http://gulpjs.com/">Gulp</a> ou <a href="http://gruntjs.com/">Grunt</a>.</p>
<p>Passons justement à ces solutions plus sérieuses.</p>
<h3 id="autoprefixer-avec-gulp">Autoprefixer avec Gulp</h3>
<p>Je ne vais pas trop rentrer dans les détails de Gulp (ce n’est pas le sujet ici).
Voici cependant une exemple assez bref et compréhensible pour commencer, avec
une seule écriture sur le système de fichier (contrairement à la solution Grunt).</p>
<pre><code class="lang-js"><span class="hljs-comment">// gulp stuff</span>
<span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp"</span>)
  , gutil = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-util"</span>)
  <span class="hljs-comment">// le plombier ajuste les fuites des tuyaux (erreur de pipe)</span>
  <span class="hljs-comment">// ceci est conseillé pour éviter que chaque erreur "casse" tout le process</span>
  <span class="hljs-comment">// dès qu’une erreur est remonté par un plugin</span>
  , plumber = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-plumber"</span>)

<span class="hljs-comment">// css stuff</span>
<span class="hljs-keyword">var</span> sass = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-ruby-sass"</span>)
  , autoprefixer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-autoprefixer"</span>)
  , csso = <span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-csso"</span>)

<span class="hljs-comment">// css task: sass, autoprefixer et csso si --production</span>
gulp.task(<span class="hljs-string">"styles"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  gulp.src(<span class="hljs-string">"./src/css/*.scss"</span>)
    <span class="hljs-comment">// it’s me, Mario</span>
    .pipe(plumber())

    .pipe(sass({style: <span class="hljs-string">"expanded"</span>}))

    <span class="hljs-comment">// Autoprefixer \\</span>
    <span class="hljs-comment">// vous remarquerez que ici chaque option est un paramètre</span>
    <span class="hljs-comment">// pas comme pour l’appel en ligne de commande.</span>
    .pipe(autoprefixer(<span class="hljs-string">"last 2 versions"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>, <span class="hljs-string">"Android 2"</span>))

    <span class="hljs-comment">// optimisation CSS pour la prod uniquement</span>
    .pipe(gulp.env.production ? csso() : gutil.noop())

    <span class="hljs-comment">// unique écriture sur disque</span>
    .pipe(gulp.dest(<span class="hljs-string">"./dist/css/"</span>))
    <span class="hljs-comment">// je passe sur cette partie à configurer, mais ici on peut imaginer un</span>
    <span class="hljs-comment">// livereload en plus, il faudra définir livereload et livereloadServer</span>
    <span class="hljs-comment">// cette partie dépend un peu de votre serveur durant le dév.</span>
    <span class="hljs-comment">// ca fera l’objet d’un post tiens...</span>
    <span class="hljs-comment">//.pipe(livereload(livereloadServer))</span>
})

gulp.task(<span class="hljs-string">"dev"</span>, [<span class="hljs-string">"styles"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  gulp.watch(<span class="hljs-string">"./src/css/**/*"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    gulp.run(<span class="hljs-string">"styles"</span>)
  })
})

<span class="hljs-comment">// Tâches disponibles :</span>

<span class="hljs-comment">// - pour générer les feuilles de styles</span>
<span class="hljs-comment">//   (pour optimiser pour la prod, utiliser l’option)</span>
<span class="hljs-comment">// $ gulp styles [--production]</span>

<span class="hljs-comment">// - pour le dev, surveille et lance la tâche `styles` dès que nécessaire</span>
<span class="hljs-comment">// $ gulp dev</span>
</code></pre>
<h3 id="autoprefixer-avec-grunt">Autoprefixer avec Grunt</h3>
<p>Voici un petit Gruntfile avec la même configuration que ci dessus</p>
<pre><code class="lang-js">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>
<span class="hljs-pi">  "use strict"</span>;

  grunt.loadNpmTasks(<span class="hljs-string">"grunt-contrib-sass"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-autoprefixer"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-csso"</span>)
  grunt.loadNpmTasks(<span class="hljs-string">"grunt-contrib-watch"</span>)

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">"expanded"</span>
        }
      , files: [{
          expand: <span class="hljs-literal">true</span>
        , flatten: <span class="hljs-literal">true</span>
        , cwd: <span class="hljs-string">"./src/css"</span>
        , src: [<span class="hljs-string">"*.scss"</span>]
        , dest: <span class="hljs-string">"./dist/css"</span>
        , ext: <span class="hljs-string">".css"</span>
        }]
      }
    }
  , autoprefixer: {
      options: {
        browsers: [<span class="hljs-string">"last 2 versions"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>, <span class="hljs-string">"Android 2"</span>]
      }
    , dist: {
        expand: <span class="hljs-literal">true</span>
      , flatten: <span class="hljs-literal">true</span>
      , cwd: <span class="hljs-string">"./dist/css"</span>
      , src: [<span class="hljs-string">"*.css"</span>]
      , dest: <span class="hljs-string">"./dist/css/"</span>
      }
    }
  , csso: {
      dist: {
        expand: <span class="hljs-literal">true</span>
      , flatten: <span class="hljs-literal">true</span>
      , cwd: <span class="hljs-string">"./dist/css/"</span>
      , src: [<span class="hljs-string">"*.css"</span>]
      , dest: <span class="hljs-string">"./dist/css/"</span>
      }
    }

  , watch: {
      styles: {
        files: [<span class="hljs-string">"./src/css/**/*.scss"</span>]
      , tasks: [<span class="hljs-string">"styles"</span>]
      }
    }
  })

  grunt.registerTask(<span class="hljs-string">"styles"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"autoprefixer"</span>])
  grunt.registerTask(<span class="hljs-string">"styles:production"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"autoprefixer"</span>, <span class="hljs-string">"csso"</span>])
  grunt.registerTask(<span class="hljs-string">"dev"</span>, [<span class="hljs-string">"sass"</span>, <span class="hljs-string">"watch"</span>])
}

<span class="hljs-comment">// Tâches disponibles :</span>

<span class="hljs-comment">// - pour générer les feuilles de styles</span>
<span class="hljs-comment">// $ grunt styles</span>

<span class="hljs-comment">// - pareil, mais optimiser pour la prod</span>
<span class="hljs-comment">// $ grunt styles:production</span>

<span class="hljs-comment">// - pour le dev, surveille et lance la tâche `styles` dès que nécessaire</span>
<span class="hljs-comment">// $ grunt watch</span>
</code></pre>
<p>Comme vous pouvez le voir, la version Grunt est un peu plus volumineuse (bien qu’espacée).
Personnellement j’aime la concision de gulp.
De plus la version Grunt sera plus longue car nous aurons 3 lectures / écritures sur le disque.</p>
<p><em>Notez que bien entendu dans notre exemple précédent, nous pouvons remplacer Sass
par un autre pré / post-processeur.</em></p>
<h3 id="autoprefixer-avec-stylus">Autoprefixer avec Stylus</h3>
<p>Dans les exemples précédents, j’ai montré une solution classique avec Sass.
Mais voici complètement autre chose: <em>autoprefixer</em> peut s’utiliser en &quot;plugin&quot; Stylus.</p>
<p>C’est assez simple il suffit d’utiliser l’option <code>use</code> (<code>-u</code> en cli).
Voilà ce qu’on aurait en cli :</p>
<pre><code class="lang-shell">$ npm install <span class="hljs-attribute">-g</span> stylus autoprefixer<span class="hljs-attribute">-stylus</span>
$ stylus <span class="hljs-attribute">-u</span> autoprefixer<span class="hljs-attribute">-stylus</span> <span class="hljs-attribute">-o</span> index<span class="hljs-built_in">.</span>css index<span class="hljs-built_in">.</span>styl
</code></pre>
<h4 id="avec-grunt">Avec Grunt</h4>
<p>Il suffira d’utiliser donc l’option <code>use</code> dans votre configuration.</p>
<h4 id="-avec-gulp-"><del>Avec Gulp</del></h4>
<p>La façon de faire de gulp, via des streams pour éviter la lecture / écriture multiple fait que le plugin
<em>autoprefixer-stylus</em> est vide de sens.
Vous pouvez donc utiliser <em>autoprefixer</em> normalement, après l’appel du pré-processeur.</p>
<hr>
<p>Voilà j’espère que cette fois-ci vous êtes rassasié(e) afin de ne plus avoir envie de manger des préfixes CSS !</p>

]]></description><pubDate>Tue, 04 Mar 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/mise-en-place-autoprefixer/</guid></item><item><title>Git, boutez les bugs, domptez votre historique!</title><description><![CDATA[[
<p>Vous viendez de lire l&#39;<a href="/posts/git/versionner-avec-git/">article de madx</a> sur le gestionnaire
de version Git et vous vous dites que vous aimeriez en découvrir plus! Vous l&#39;utilisez déjà mais êtes
en quête de quelques nouvelles (ou pas) astuces à vous mettre sous la dent! Bienvenue!</p>
<p>Si vous désirez vous servir de cet article comme d&#39;un tutoriel il est recommandé d&#39;avoir quelques
bases concernant l&#39;utilisation et le fonctionnement de Git (commits/branches/etc…).</p>
<p>Allez, je ne vous fais pas plus attendre, voici ma liste des fonctionnalités Git dont je ne
saurais plus me passer:</p>
<h2 id="git-lg-l-alias-qui-vous-parle-d-histoire">git lg, l&#39;alias qui vous parle d&#39;Histoire</h2>
<p>À l&#39;aide, à l&#39;aide je ne comprends plus rien à l&#39;historique de mon dépôt Git!
J&#39;ai créé un monstre… Pas de panique! J&#39;ai pour vous l&#39;alias qu&#39;il vous faut,
honteusement pompé de <a href="https://coderwall.com/p/euwpig">ce site</a>, mais
comme j&#39;ai pas d&#39;honneur… Pour le mettre en place il suffit d&#39;entrer la commande
suivante dans votre terminal préféré:</p>
<pre><code class="lang-bash">$ git config --global alias.lg <span class="hljs-string">"log --color --graph --pretty=format:'<span class="hljs-variable">%Cred</span><span class="hljs-variable">%h</span><span class="hljs-variable">%Creset</span> -<span class="hljs-variable">%C</span>(yellow)<span class="hljs-variable">%d</span><span class="hljs-variable">%Creset</span> <span class="hljs-variable">%s</span> <span class="hljs-variable">%Cgreen</span>(<span class="hljs-variable">%cr</span>) <span class="hljs-variable">%C</span>(bold blue)&lt;<span class="hljs-variable">%an</span>&gt;<span class="hljs-variable">%Creset</span>' --abbrev-commit"</span>
</code></pre>
<p>Au cas où vous ne seriez pas à l&#39;aise avec ce genre de choses, sachez simplement que la commande
<code>git config --global alias.lg</code> permet d&#39;inscrire à votre configuration générale un nouvel alias (
ici lg). Le reste est ce que doit faire cet alias, à savoir afficher un historique reformaté de votre
dépôt Git.</p>
<p>Allez, je vous met au défi d&#39;oser taper un coup de <code>git lg</code> dans votre terminal
maintenant (dans un dépôt Git bien entendu banane). Pour l&#39;exemple, je l&#39;ai réalisé dans le dépôt
de Putain De Code:</p>
<figure>
  <img src="../../../images/posts/git/boutez-les-bugs-domptez-votre-historique/omagad-history.png" alt="capture historique">
  <figcaption>Le pouvoir de l&#39;arc en ciel</figcaption>
</figure>

<p>Eh oui, sous vos yeux ébahis se dessine maintenant l&#39;historique de votre dépôt!
Tout y est: créations de branches, commits, merges, les miaouOnes… Voilà, vous ne pourrez plus
dire que vous n&#39;y comprenez rien, vous seriez un fieffé menteur.</p>
<h2 id="git-bisect-trouver-et-punir">git bisect, trouver et punir</h2>
<p>S&#39;il y a bien quelque chose d&#39;agaçant dans l&#39;activité de développement, c&#39;est que bien
souvent on est amené à travailler en équipe, et évidemment, il y en a toujours
un pour introduire des Putain De Bugs. Alors c&#39;est parti on sort le débugger pour
l&#39;autre ingrat, on place les <code>console.log</code> et autres <code>var_dump()</code> pour trouver d&#39;où
peut bien venir ce fichu problème, et on se coule un café parce qu&#39;entre nous, ça peut
prendre du temps.</p>
<p>Heureusement pour nous, là aussi Git est au rendez-vous avec sa fonctionnalité de <em>bisecting</em>. Je vous vois déjà en
train de baver devant votre écran, mais non, Git ne va pas corriger vos bugs bien évidemment, il va vous aider
à trouver le changement dans le code qui l&#39;a fait apparaître et ceci grâce à la commande <code>git bisect</code>.</p>
<p>Pour lancer une <em>bisection</em> par Git il suffit d&#39;entrer <code>git bisect start</code> dans votre terminal préféré
et le tour est joué!</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git bisect start
$
</code></pre>
<figure>
    <figcaption> Capitaine, regardez il n&#39;y a rien </figcaption>
</figure>

<p>Oui bon d&#39;accord, il va falloir s&#39;investir un peu plus pour parvenir à nos fins. Pour l&#39;instant Git est
passé en mode <em>bisection</em>, maintenant il a besoin d&#39;informations pour s&#39;exécuter:</p>
<ul>
<li>Un commit où le bug est présent</li>
<li>Un commit où le bug est absent</li>
</ul>
<p>Imaginons que le commit sur lequel nous sommes comporte le bug, nous allons donc le signaler à Git avec
<code>git bisect bad</code>. Nous allons ensuite nous déplacer sur un commit plus ancien qui ne comporte pas le bug et
le signaler à son tour: <code>git bisect good</code>.</p>
<p>Git va alors se mettre en route et vous déplacer automatiquement de commit en commit. Pour chacun d&#39;eux vous n&#39;aurez
qu&#39;à le déclarer bon ou mauvais comme expliqué au dessus, jusqu&#39;à ce que Git vous fournisse le premier commit
comportant le bug, celui dont le changement a révélé le disfonctionnement.</p>
<pre><code class="lang-bash">$ git bisect bad
1082351d9157e98aed1bbee8b9ad6deedca1288f is the first bad <span class="hljs-operator"><span class="hljs-keyword">commit</span>
<span class="hljs-keyword">commit</span> <span class="hljs-number">1082351</span>d9157e98aed1bbee8b9ad6deedca1288f
Author: Maxime Thirouin &lt;m@***.io&gt;
<span class="hljs-keyword">Date</span>:   Fri Jan <span class="hljs-number">17</span> <span class="hljs-number">08</span>:<span class="hljs-number">19</span>:<span class="hljs-number">46</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    ¯\_(ツ)_/¯ Fix shit bring <span class="hljs-keyword">in</span> <span class="hljs-number">34</span>a44c98048f2b74fc2dd20f0be807c1e23e8b58

:<span class="hljs-number">040000</span> <span class="hljs-number">040000</span> <span class="hljs-number">7</span>a5d5010f0aaa052ffdc0747b182dc6178a346db d3562872efd1b9d662a89825a3070d64f860cc34 M  src</span>
</code></pre>
<figure>
    <figcaption>1, 2, 3, Soleil!</figcaption>
</figure>

<p>Et voilà, le tour est joué, en plus Git vous a positionné sur ce commit, il ne manque plus qu&#39;un petit coup de
<code>git show</code> et vous savez tout. Pour revenir à votre travail, un simple <code>git bisect reset</code> fera l&#39;affaire!
Il ne vous reste plus qu&#39;à punir la personne fautive, mais pour ça je vous laisse avec votre imagination,
je suis sûr que vous trouverez.</p>
<p>Pour les fanatiques de l&#39;efficacité et de l&#39;automatisation, sachez que Git en a encore dans le ventre. Si vous
connaissez déjà un bon et un mauvais commit, vous pouvez tout simplement lancer la <em>bissection</em> à grand coup de
<code>git bisect start MAUVAIS_COMMIT BON_COMMIT</code> et si, cerise sur le gâteau, vous êtes en possession d&#39;une suite de tests
unitaires (oui non je sais faut pas déconner), <code>git bisect run &lt;votre_script&gt;</code> vous permettra de la lancer et la
recherche du premier commit défectueux se fera alors toute seule!</p>
<h2 id="git-rebase-du-pur-story-telling">git rebase, du pur story-telling</h2>
<p>Je ne sais pas s&#39;il vous est déjà arrivé de naviguer dans les dépôts Git de projets libres, mais souvent on y trouve que très
peu de commits poubelles, ces commits avec comme message &quot;step&quot; ou autre &quot;stuff&quot;. Chaque commit correspond à une fonctionnalité,
un bug fix, une unité logique cohérente. Je ne sais pas pour vous, mais personnellement un <em>git log</em> ne ressemble pas à
ça chez moi!</p>
<pre><code>commit e739e7c0248b841b0250eb85d99a1b4ba149149d
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Now my new functionality finally works

commit <span class="hljs-number">551</span>b243525d826afcfece3e2c4c471ebd1e91779
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    misc

commit <span class="hljs-number">9</span>db49a39fdb05a54adcfc2b46832818ef05b9c72
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">43</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    stuff

commit ca4ff952310d6246216e83f49309b32b2d2fa010
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">35</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    first commit
</code></pre><figure>
    <figcaption>best git log, ever</figcaption>
</figure>

<p>Bien que l&#39;on essaye de nous faire croire que les logiciels libres sont codés par des rockstars, ce qui permet de justifier le
mythe du <em>1 commit = 1 fonctionnalité</em>, vous n&#39;êtes pas dupes; l&#39;historique Git de ces dépôts est bel et bien retravaillé, et ceci dans
le but de maintenir sa cohérence et de permettre à tous les contributeurs de le comprendre. Si cela s&#39;applique particulièrement
dans le cadre des logiciels libres, il n&#39;en est pas moins satisfaisant d&#39;avoir également un historique clair sur ses propres dépôts.</p>
<p>Pour cela, l&#39;arme de choix s&#39;appelle <code>git rebase</code>. Cette fonctionnalité permet de réécrire l&#39;historique de vos dépôts, de
réorganiser les commits, d&#39;en supprimer, de changer leur message associé etc… La fonctionnalité est assez simple à utiliser, nous allons
prendre exemple sur l&#39;historique présenté ci-dessus: je voudrais supprimer le commit dont le message est &#39;stuff&#39; parce que finalement il
s&#39;avère inutile. Je veux également fusionner le commit &#39;misc&#39; avec le commit &#39;Now my new functionality finally works&#39; et renommer ce dernier
pour qu&#39;il soit plus explicite et fasse référence à ma User Story correspondante dans mon outil de tracking préféré.</p>
<p>Pour commencer, il faut dire jusqu&#39;à quel commit on souhaite effectuer cette réécriture; pour cela, dans mon cas, deux solutions:</p>
<ul>
<li>Faire référence à partir de HEAD (l&#39;étiquette courante), ici: HEAD~3 (je veux réécrire jusqu&#39;au commit avant &#39;stuff&#39;)</li>
<li>Fournir le SHA1 du commit avant &#39;stuff&#39; (ici 2645b1cdbdd72bea6c392c011320556997327761)</li>
</ul>
<p>Je vais utiliser la première méthode (le choix n&#39;influe en rien sur la suite), et donc lancer la réécriture en invoquant la commande: <code>git rebase -i HEAD~3</code>
( -i voulant dire de lancer un <em>rebase</em> en mode intéractif). Voici ce qui m&#39;est alors présenté:</p>
<pre><code>pick <span class="hljs-number">9</span>db49a3 stuff
pick <span class="hljs-number">551</span>b243 misc
pick e739e7c Now my <span class="hljs-keyword">new</span> functionality finally works

<span class="hljs-preprocessor"># Rebase ca4ff95..e739e7c onto ca4ff95</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Commands:</span>
<span class="hljs-preprocessor">#  p, pick = use commit</span>
<span class="hljs-preprocessor">#  r, reword = use commit, but edit the commit message</span>
<span class="hljs-preprocessor">#  e, edit = use commit, but stop for amending</span>
<span class="hljs-preprocessor">#  s, squash = use commit, but meld into previous commit</span>
<span class="hljs-preprocessor">#  f, fixup = like "squash", but discard this commit's log message</span>
<span class="hljs-preprocessor">#  x, exec = run command (the rest of the line) using shell</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># These lines can be re-ordered; they are executed from top to bottom.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># If you remove a line here THAT COMMIT WILL BE LOST.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># However, if you remove everything, the rebase will be aborted.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Note that empty commits are commented out</span>
</code></pre><p>Git m&#39;affiche tous les commits concernés par l&#39;opération (en ordre inverse), devant chacun d&#39;eux, la mention <em>pick</em>, et une légende en bas.
<em>pick</em>, comme l&#39;indique la légende, signifie que ce commit sera conservé, mais je peux remplacer cette mention par les suivantes:</p>
<ul>
<li>reword : modifier le message de commit.</li>
<li>edit : utiliser le commit mais me laisser le modifier avec un <code>git commit --amend</code> qui permet de commiter l&#39;état courant de la copie de travail en
l&#39;incorporant au commit précédent.</li>
<li>squash : utiliser le commit en le fusionnant avec le commit précédent.</li>
<li>fixup : utiliser le commit en le fusionnant avec le commit précédent et ne pas utiliser son message associé.</li>
<li>exec : exécuter une commande sur ce commit.</li>
</ul>
<p>En plus de ces différentes mentions, je peux également effectuer deux autres actions:</p>
<ul>
<li>déplacer un commit, ce qui aura pour effet final de le déplacer dans l&#39;historique.</li>
<li>supprimer un commit, ce qui aura comme résultat de le faire disparaître de l&#39;historique.</li>
</ul>
<p>Pour ma part, je vais:</p>
<ul>
<li>supprimer la première ligne parce que j&#39;ai décidé que le commit &#39;stuff&#39; ne me servait à rien.</li>
<li>mettre la mention reword devant le commit &#39;misc&#39;, car je vais fusionner le dernier commit avec celui-ci et mettre un nouveau message.</li>
<li>mettre la mention fixup devant le commit &#39;Now my new functionality finally works&#39; car je vais le fusionner au précédent et abandonner son message.</li>
</ul>
<p>Ce qui nous donne le résultat suivant:</p>
<pre><code>reword <span class="hljs-number">551</span>b243 misc
fixup e739e7c Now my <span class="hljs-keyword">new</span> functionality finally works

<span class="hljs-preprocessor"># Rebase ca4ff95..e739e7c onto ca4ff95</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Commands:</span>
<span class="hljs-preprocessor">#  p, pick = use commit</span>
<span class="hljs-preprocessor">#  r, reword = use commit, but edit the commit message</span>
<span class="hljs-preprocessor">#  e, edit = use commit, but stop for amending</span>
<span class="hljs-preprocessor">#  s, squash = use commit, but meld into previous commit</span>
<span class="hljs-preprocessor">#  f, fixup = like "squash", but discard this commit's log message</span>
<span class="hljs-preprocessor">#  x, exec = run command (the rest of the line) using shell</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># These lines can be re-ordered; they are executed from top to bottom.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># If you remove a line here THAT COMMIT WILL BE LOST.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># However, if you remove everything, the rebase will be aborted.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Note that empty commits are commented out</span>
</code></pre><figure>
    <figcaption>Attention chérie, ça va trancher</figcaption>
</figure>

<p>Il n&#39;y a plus qu&#39;à sauvegarder et quitter (:x dans vim) pour que la machine se mette en route. Si certaines actions que vous avez effectuées, notamment
le déplacement de commits, provoquent des conflits, Git va vous demander de les résoudre au fur et à mesure; il suffit pour cela d&#39;éditer vos fichiers, puis
de les marquer comme résolus au moyen de la commande <code>git add &lt;lefichier&gt;</code> avant de reprendre avec la commande <code>git rebase --continue</code>. Comme convenu,
Git vous demande d&#39;éditer le message du commit marqué en <em>reword</em>:</p>
<pre><code>Story #<span class="hljs-number">34</span> - Poker cards now have a real back picture

<span class="hljs-preprocessor"># Please enter the commit message for your changes. Lines starting</span>
<span class="hljs-preprocessor"># with '#' will be ignored, and an empty message aborts the commit.</span>
<span class="hljs-preprocessor"># HEAD detached at ca4ff95</span>
<span class="hljs-preprocessor"># You are currently rebasing branch 'master' on 'ca4ff95'.</span>
<span class="hljs-preprocessor">#   (all conflicts fixed: run "git rebase --continue")</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Changes to be committed:</span>
<span class="hljs-preprocessor">#   (use "git reset HEAD &lt;file&gt;..." to unstage)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># modified:   README.txt</span>
<span class="hljs-preprocessor">#</span>
</code></pre><figure>
    <figcaption>Un commit qu&#39;il est mieux pour le relire</figcaption>
</figure>

<p>L&#39;opération va continuer puis Git va vous rendre la main. Il vous suffit alors de faire un <code>git log</code> pour apprécier le résultat:</p>
<pre><code>commit <span class="hljs-number">481</span>b4dccf4fedf4ed9d7f4e83ae5c19a07f7e12e
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Story <span class="hljs-preprocessor">#34 - Poker cards now have a real back picture</span>
</code></pre><figure>
    <figcaption>Et c&#39;est le succèèèèèèès</figcaption>
</figure>

<p>Vous n&#39;avez plus qu&#39;un seul commit tout beau tout propre! Vous pouvez maintenant le pousser sur votre dépôt et vous vanter d&#39;avoir un bel historique, parce
que vous aussi, vous êtes une rockstar :).</p>
<p>Pour ceux qui désirent aller encore plus loin dans l&#39;automatisation de ce processus de rebase, je vous conseille d&#39;aller jeter un œil à l&#39;utilisation
de l&#39;option <a href="http://madx.me/articles/git_rebase_autosquash.html">--autosquash</a>.</p>
<h2 id="git-reflog-la-commande-de-celui-qui-a-fait-n-importe-quoi">git reflog, la commande de celui qui a fait n&#39;importe quoi</h2>
<p>Voici venu le temps <del>des rires et des chants</del> de la denière commande que je souhaitais vous présenter, j&#39;ai nommé <code>git reflog</code>. Cette commande
c&#39;est votre <em>joker</em>, elle assure votre survie, notamment si vous avez été assez zinzins pour suivre les exemples donnés dans cet article, parce
que honnêtement…</p>
<figure>
    <img src="http://i1.kym-cdn.com/photos/images/newsfeed/000/305/224/3e1.jpg" alt="I have no idea what I&#39;m doing">
</figure>

<p>Vous ne le savez peut être pas, mais Git, dans sa grande bonté, garde une référence de toutes vos actions, de tous les endroits où vous vous êtes déplacez.
Ce registre, c&#39;est le <em>references log</em>, et en plus on peut y accéder simplement grâce à la commande <code>git reflog</code> (sans déconner). Faisons un petit tour
dans le miens:</p>
<pre><code><span class="hljs-number">481</span>b4dc HEAD@{<span class="hljs-number">0</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
<span class="hljs-number">481</span>b4dc HEAD@{<span class="hljs-number">1</span>}: rebase -i (fixup): Story <span class="hljs-comment">#34 - Poker cards now have a real back picture</span>
<span class="hljs-number">8</span>fd5835 HEAD@{<span class="hljs-number">2</span>}: rebase -i (<span class="hljs-keyword">continue</span>): Story <span class="hljs-comment">#34 - Poker cards now have a real back picture</span>
ca4ff95 HEAD@{<span class="hljs-number">3</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> ca4ff952310d6246216e83f49309b32b2d2fa010
e739e7c HEAD@{<span class="hljs-number">4</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">5</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">6</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">7</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">8</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">9</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">10</span>}: rebase -i (finish): <span class="hljs-keyword">returning</span> <span class="hljs-keyword">to</span> refs/heads/master
e739e7c HEAD@{<span class="hljs-number">11</span>}: checkout: moving <span class="hljs-keyword">from</span> master <span class="hljs-keyword">to</span> e739e7c
e739e7c HEAD@{<span class="hljs-number">12</span>}: commit: Now <span class="hljs-keyword">my</span> new functionality finally works
<span class="hljs-number">551</span>b243 HEAD@{<span class="hljs-number">13</span>}: commit: misc
<span class="hljs-number">9</span>db49a3 HEAD@{<span class="hljs-number">14</span>}: commit (amend): stuff
af7fc36 HEAD@{<span class="hljs-number">15</span>}: commit: misc
ca4ff95 HEAD@{<span class="hljs-number">16</span>}: commit (initial): <span class="hljs-keyword">first</span> commit
</code></pre><figure>
    <figcaption>Il est beau mon reflog, il est frais</figcaption>
</figure>

<p>On voit ici l&#39;ensemble de mes opérations apparaître comme le <em>rebase</em> effectué précédemment (bon d&#39;accord il apparaît plusieurs fois parce que j&#39;ai
fait quelques tests avant d&#39;écrire cette partie de l&#39;article). Chaque opération possède un SHA1 qui est en fait une référence vers le commit concerné, dans l&#39;état
dans lequel il était au moment de l&#39;opération. Bien, imaginons que j&#39;ai fait n&#39;importe quoi avec le rebase et que je veuille retrouver mon état précédent, et bien
il me suffira ici de faire un <code>git checkout e739e7c</code> (dans votre cas la ligne sera probablement plus simple à trouver). Et là si je refais un <code>git log</code>, miracle:</p>
<pre><code>commit e739e7c0248b841b0250eb85d99a1b4ba149149d
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">50</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    Now my new functionality finally works

commit <span class="hljs-number">551</span>b243525d826afcfece3e2c4c471ebd1e91779
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">39</span>:<span class="hljs-number">23</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    misc

commit <span class="hljs-number">9</span>db49a39fdb05a54adcfc2b46832818ef05b9c72
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">43</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    stuff

commit ca4ff952310d6246216e83f49309b32b2d2fa010
<span class="hljs-label">Author:</span> Martin GOYOT (Erwyn/Martinus) &lt;martin@***<span class="hljs-preprocessor">.com</span>&gt;
<span class="hljs-label">Date:</span>   Tue Feb <span class="hljs-number">18</span> <span class="hljs-number">21</span>:<span class="hljs-number">38</span>:<span class="hljs-number">35</span> <span class="hljs-number">2014</span> +<span class="hljs-number">0100</span>

    first commit
</code></pre><p>Vous voilà retombés sur vos pieds! Vous n&#39;avez plus qu&#39;à reconnecter votre branche à ce commit si jamais vous en aviez une et vous êtes reparti pour de nouvelles
aventures.</p>
<p>Sachez tout de même que ce <em>references log</em> peut être effacé, et il est même conseillé de le faire régulièrement pour des problématiques de performance de Git sur
votre dépôt; conserver tous ces commits peut devenir coûteux à la longue. La commande <code>git gc</code> pour <em>garbage collector</em> s&#39;occupera de faire le ménage
pour vous.</p>
<p>Voilà, on arrive au bout de notre aventure, j&#39;espère que vous avez appris quelque chose et que Git vous fait maintenant moins peur.</p>
<p>Amike,</p>

]]></description><pubDate>Thu, 27 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/git/boutez-les-bugs-domptez-votre-historique/</link><guid isPermaLink="true">http://putaindecode.fr/posts/git/boutez-les-bugs-domptez-votre-historique/</guid></item><item><title>Twitter comme lecteur de flux</title><description><![CDATA[[
<p><em>(Note : dans cet article, j&#39;ai volontairement pris comme exemple la version Web afin que tout le monde puisse profiter de l&#39;expérience mais il est évident que vous puissiez le faire avec votre application twitter favorite).</em></p>
<p>Bien avant la fin de Google Reader, je me posais déjà la question de l&#39;intérêt d&#39;un lecteur de flux {rss|atom}. En effet, il m&#39;était pénible d&#39;organiser les flux que je souhaitais lire : les ranger par catégorie, supprimer les sites morts ou ceux qui ne m&#39;intéressaient plus; de plus, je n&#39;ai jamais réellement utilisé les fonctionnalités d&#39;un lecteur de flux comme le système de marquage, savoir si le flux a été lu ou non, lire l&#39;article dans le lecteur (je le lis toujours sur le site, jamais dans l&#39;application). Et puis c&#39;est parfois pénible de trouver un lecteur de flux simple, multi-OS et gratuit.</p>
<p>J&#39;ai été un grand fan à l&#39;époque de Netvibes puis je l&#39;ai délaissé pour Google Reader et nous voilà quelques temps après, sans réelle solution à mon sens pour lire agréablement des flux tel que je le concois.</p>
<p>J&#39;expérimente pourtant une solution depuis quelques mois qui me sied bien. J&#39;utilise en effet Twitter en tant que lecteur de flux. Oui, car cela a plusieurs avantages :</p>
<ul>
<li><p>Il existe une application pour <a href="https://play.google.com/store/apps/details?id=com.twitter.android&amp;hl=fr">Android</a>, <a href="https://about.twitter.com/products/iphone">iOS</a> ainsi que <a href="https://itunes.apple.com/fr/app/twitter/id409789998?mt=12">Mac</a>; mais aussi la <a href="https://twitter.com/">version Web</a> et <a href="https://tweetdeck.twitter.com/">Tweetdeck</a> est disponible sur tous les environnements.</p>
</li>
<li><p>Je fais ma veille majoritairement via Twitter; j&#39;écrème au fil de la journée ce qui m&#39;intéresse ou non. Si c&#39;est rapide à lire alors je le lis, sinon je <em>bookmark</em> l&#39;article en &quot;Read later&quot; sur mon navigateur. Cela permet de trier rapidement l&#39;information et de lire plus paisiblement cela au moment opportun.
De plus, étant donné que l&#39;information est donnée par mes <em>following</em> et que je suis les personnes qui m&#39;intéressent vraiment, l&#39;information est alors souvent pertinente. Encore faut-il avoir la bonne TL.
Et  si j&#39;ai besoin d&#39;aller chercher une information précise, j&#39;irai la trouver à travers un moteur de recherche... donc aucune problématique de &quot;neutralité&quot; de l&#39;information.</p>
</li>
<li><p>De plus, étant donné que je fais justement cette veille via Twitter, cela me permet d&#39;avoir qu&#39;un seul outil. Cela m&#39;ennuie au plus haut point de collectionner les outils. Je suis certes partisant d&#39;utiliser le bon outil pour chaque tâche plutôt qu&#39;un couteau-suisse, mais finalement Twitter et un lecteur de flux ne sont pas si éloignés.</p>
</li>
<li><p>Enfin, la majorité des blogs / sites que j&#39;apprécie ont leur propre compte twitter qui postent l&#39;url de leurs articles, il suffit alors de les suivre. Et si ce n&#39;est pas le cas, je vous montrerai une petite astuce pour que ça le soit.</p>
</li>
</ul>
<p>Vous vous sentez chaud(e) pour commencer ? Très bien, c&#39;est parti !</p>
<h2 id="cr-er-une-liste-twitter">Créer une liste Twitter</h2>
<p>Pour créer une liste, aucun problème, vous allez dans &quot;Me&quot; dans le <em>header</em> puis &quot;List&quot; dans la colonne de gauche pour vous retrouver ici :</p>
<p><img src="../../../images/posts/twitter/twitter-list.jpg" alt=""></p>
<p>Puis vous cliquez sur <code>Create list</code> et vous rentrez les informations que vous souhaitez :</p>
<p><img src="../../../images/posts/twitter/create-list.png" alt=""></p>
<p>Nous voilà avec notre belle liste. Il n&#39;y a plus qu&#39;à la remplir de jolis <em>following</em>.</p>
<p>Prenons par exemple <code>@nodenpm</code>, un beau <em>bot</em> tweetant les nouveaux packages node.js ou/et les updates de ces packages.</p>
<p><img src="../../../images/posts/twitter/nodenpm.jpg" alt=""></p>
<p>Ajoutons-le à notre liste.</p>
<p><img src="../../../images/posts/twitter/add-in-list.png" alt=""></p>
<p>Nous voilà maintenant avec notre liste comprenant un <em>following</em>. Ce qui en ayant ajouté quelques comptes donnera quelque chose comme ceci :</p>
<p><img src="../../../images/posts/twitter/twitter-list-read.jpg" alt=""></p>
<p>Vous pouvez maintenant apprécier votre lecteur de flux.</p>
<p>Oh mais ! C&#39;est là que vous constatez qu&#39;un de vos sites préférés n&#39;a pas de compte Twitter ! Que faire ? Haha, et si on utilisait la puissance de IFTTT pour se créer un bot twitter qui tweet chaque nouvel article d&#39;un des sites que vous appréciez ?! Mais ouais !</p>
<h2 id="ifttt-la-solution-pour-parfaire-notre-lecteur">IFTTT, la solution pour parfaire notre lecteur</h2>
<p>Mais avant tout, créons notre compte twitter &quot;bot&quot; qui va tweeter ce qu&#39;on souhaite.</p>
<h3 id="compte-twitter-bot-">Compte twitter &quot;bot&quot;</h3>
<ul>
<li>Déconnectez-vous</li>
<li>Inscrivez-vous à nouveau sur Twitter (le mien s&#39;appelle <a href="https://twitter.com/kud_feeds">@kud_feeds</a> par exemple)</li>
<li>Mettez-lui une belle bio, un bel avatar</li>
<li>Déconnectez-vous à nouveau</li>
<li>Connectez-vous avec votre vrai compte</li>
<li>Ajoutez votre &quot;bot&quot; à la liste que vous venez de créer précédemment</li>
</ul>
<p>... et voilà !</p>
<h3 id="ifttt">IFTTT</h3>
<p><img src="../../../images/posts/ifttt.png" alt=""></p>
<p>Maintenant, IFTTT.</p>
<blockquote>
<p>IFTTT (&quot;If This Then That&quot;) est un service qui permet aux utilisateurs de connecter différentes applications ensemble à travers de simples conditions nommées &quot;recettes&quot;.</p>
</blockquote>
<p>IFTTT va vous permettre d&#39;aller pomper les flux {rss|atom} de vos sites préférés puis ayant accès à votre <em>bot</em> va permettre de tweeter le contenu des flux ! C&#39;est pas beau ça hein ?! =)</p>
<ul>
<li>Allez sur <a href="https://ifttt.com">ifttt.com</a></li>
<li>Créez-vous un compte (je vous conseille de créer un compte spécialement pour le <em>bot</em> car IFTTT ne propose de relier qu&#39;un seul compte twitter. Du coup, si comme moi vous appréciez IFTTT et que vous souhaitez autant utiliser IFTTT pour votre compte twitter principal que votre compte <em>bot</em>, je vous conseille de vous créer deux comptes IFTTT)</li>
<li>Créez une nouvelle recette en cliquant sur <code>Create</code></li>
<li>Cliquez sur <code>this</code></li>
<li>Puis <code>feed</code></li>
<li>Choissisez le <em>trigger</em> (&quot;déclencheur&quot;) que vous souhaitez, moi je prends plutôt le premier <code>New feed item</code> (le plus simple)</li>
<li>Indiquez l&#39;url du flux de votre site, par exemple <code>http://dribbble.com/_kud/shots/following.rss</code></li>
<li>Puis <code>then</code></li>
<li>Twitter</li>
<li><code>Post a tweet</code></li>
<li>Laissez tel quel le <em>template</em> de base pour le moment (vous pourrez le changer quand vous serez à l&#39;aise avec IFTTT)</li>
<li>Mettez la description qui va bien</li>
</ul>
<p>Et on est bon.</p>
<p>Vous avez maintenant une nouvelle recette qui dès qu&#39;un article sortira, un tweet de votre <em>bot</em> apparaitra. Vous pouvez d&#39;ailleurs vérifier que tout marche bien en cliquant sur la flèche <em>Check Recipe Now</em>.</p>
<p>Vous n&#39;aurez plus qu&#39;à créer une nouvelle recette en dupliquant cette recette à chaque fois que vous voudrez suivre un nouveau flux. Certes éventuellement plus contraignant qu&#39;un vrai lecteur de flux mais vous y gagnerez largement par la suite ;)</p>
<p>Et voilà, nous avons maintenant une belle liste Twitter qui représentre votre lecteur de flux. Voici la mienne : <a href="https://twitter.com/_kud/lists/feeds">https://twitter.com/_kud/lists/feeds</a></p>
<p>Vous pouvez même pousser le vice en créant plusieurs listes par catégorie mais ça sous-entend aussi de créer des <em>bots</em> et donc des comptes IFTTT par catégorie. Heureusement que j&#39;en ai qu&#39;une. ;)</p>
<p>Enjoy!</p>

]]></description><pubDate>Wed, 26 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/hack/twitter-comme-lecteur-de-flux/</link><guid isPermaLink="true">http://putaindecode.fr/posts/hack/twitter-comme-lecteur-de-flux/</guid></item><item><title>Comment en finir avec les préfixes CSS</title><description><![CDATA[[
<p>En mettant de côté le débat trollesque <em>faut-il ou pas des préfixes CSS ?</em>
(car avouons-le, ils sont là, il faut faire avec), on ne va pas se le cacher,
les préfixes CSS ça nous brise tous les... touches du clavier.
Eh bien oui, sans automatisation on est obligé de se taper des caractères en plus.
Même avec un IDE correct, on peut faire ça rapidement, mais ça nécessite
presque à chaque fois une action de notre part.</p>
<h2 id="pr-fixer-via-des-outils-en-ligne">Préfixer via des outils en ligne</h2>
<p>Les élèves au fond de la classe me montreront de suite des solutions comme
<a href="http://prefixmycss.com/">prefixmycss.com</a> ou l&#39;ancien prefixr.
Inopinément, un moche &quot;Mourrez moi sile vou pler&quot; sort de mon corps.
Non, sérieusement, ce n’est pas une façon de faire ça. Aller sur une web app à
chaque fois que je veux préfixer mes CSS ? Sérieusement ?
Vous avez qu’à aussi faire un service postal où j’envoie mes fichiers CSS dans
une clé USB et qu’on me renvoie sous 48h avec les préfixes ajoutés.
Super pratique.</p>
<h2 id="pr-fixer-via-javascript">Préfixer via JavaScript</h2>
<p>Une autre solution serait <a href="http://leaverou.github.io/prefixfree/">prefix-free</a>,
mais je ne vais même pas en parler tellement l’idée de dépendre de JavaScript pour
avoir un <code>border-radius</code> ou une <code>transition</code> CSS me donne une migraine.
Je vous passe les détails niveau performance. Selon les cas, on pourrait même avoir
un petit flash visuel sans les propriétés préfixées.
Non mais flûte. On ne fait pas ça. On n’alourdit pas une page web avec du JavaScript
pour parser la feuille de style et réintégrer des préfixes quoi. Au secours.</p>
<h2 id="pr-fixer-via-les-pr-processeurs-css">Préfixer via les pré-processeurs CSS</h2>
<p>Alors là, j’en entends déjà qui parle à voix haute au milieu de la classe :</p>
<blockquote>
<p>Bah lui c’est clair il’connait pas les pré-processeurs CSS le noube</p>
</blockquote>
<p>Sans rentrer dans un débat trollesque (encore un), à part peut-être avec <em>Stylus</em> et ces
mixins transparent (coucou <em><a href="http://visionmedia.github.io/nib/">Nib</a></em>),
on est obligé de rajouter du code.
Avec <em>Sass</em> il faudra (en scss) rajouter <code>@include</code> et un couple de parenthèse (et
au passage avoir <em>Compass</em> si on ne veut pas coder les mixins à la main).
Avec <em>Less</em> il faudra aussi une librairie <em>Less Hat</em> si on n’a pas envie de se taper
du mixin qui donne de la nausée comme on peut voir sur la
<a href="http://lesscss.org/">page d’accueil</a>.</p>
<h2 id="les-pr-fixes-c-est-comme-le-lait-a-tourne">Les préfixes, c’est comme le lait, ça tourne</h2>
<p>D’ailleurs, parlons en vite fait de cette page d’accueil qui au jour où j’écris
se post, comporte <b>en premier exemple</b> un mixin pour <code>box-shadow</code>
(hashtag ohlol).</p>
<p>Certaines propriétés comme <code>box-shadow</code>, ou encore <code>border-radius</code>, sont
aujourd’hui préfixées à tort, car comme on peut le voir sur le site de
<a href="http://caniuse.com/">CanIUse.com</a>, elles n’ont plus vraiment besoin d’être préfixées, à
moins que vous supportiez encore Firefox 3.6, Safari iOS 3 ou Android 2...
Je vous renvoie rapidement sur ce (vieil) article de Chris Coyier
<a href="http://css-tricks.com/do-we-need-box-shadow-prefixes/">Do we need box-shadow or border-radius prefixes anymore?</a>
en guise de mémo :)</p>
<p>Sans être de mauvaise foi, on va vite avouer qu’on ne peut pas forcément tout savoir.
Donc on ne peut pas être au top pour connaître quand il faut ou quand il n’y a plus
besoin de préfixer x ou y (oui bon x et y ne sont pas des propriétés CSS, c’est
pour l’exemple).
Qui sait qu’on peut enfin arrêter de préfixer box-sizing dans Firefox depuis la 29 ?
Ou la 30 je ne sais plus...</p>
<p>Bon mais alors comment faire ? J’entends les fayots du premier rang parler d’auto...
auto... AUTOPREFIXER ?!</p>
<p>MAIS C’EST POSSIBLE ÇA ?</p>
<p>Bon allons à l’essentiel, assez trollé.</p>
<h1 id="autoprefixer">Autoprefixer</h1>
<p>Ce magnifique outil, basé sur une solide base de données (au hasard, CanIUse.com),
permet de préfixer automatiquement vos CSS, et ce, de manière intelligente.
Vous pouvez en effet configurer autoprefixer, afin de lui préciser quel
navigateur vous voulez utiliser.
Vous pouvez au choix lui demander de supporter X versions en arrière, les versions
qui ont un usage global &gt; à Y% de trafic, ou encore une version minimale donnée.</p>
<p>Voici quelques exemples de configuration.</p>
<pre><code class="lang-js"><span class="hljs-comment">// Je supporte une version en arrière et les navigateurs qui ont plus de 1% de trafic ainsi qu'Internet Explorer 7</span>
<span class="hljs-function">autoprefixer(<span class="hljs-string">"last 1 version"</span>, <span class="hljs-string">"&gt; 1%"</span>, <span class="hljs-string">"Explorer 7"</span>)</span><span class="hljs-class">.process</span>(css)<span class="hljs-class">.css</span>;

<span class="hljs-comment">// Je supporte 2 versions en arrière, et minimum BlackBerry 10 et Android 4</span>
<span class="hljs-function">autoprefixer(<span class="hljs-string">"last 2 version"</span>, <span class="hljs-string">"BlackBerry 10"</span>, <span class="hljs-string">"Android 4"</span>)</span><span class="hljs-class">.process</span>(css)<span class="hljs-class">.css</span>;
</code></pre>
<p>Dans ces lignes de code JavaScript... Quoi attendez c’est en JavaScript ? Oh le
fourbe, il nous recale sa techno de front-end de mes deux.
Bon faites pas les relous, que vous soyez front-end ou back-end, vous avez Node.js hein ?</p>
<p>Donc aucune inquiétude, il existe une commande pour que vous puissiez faire ça rapidement :</p>
<pre><code class="lang-shell"><span class="hljs-preprocessor"># on install autoprefixer via npm en global</span>
npm install --global autoprefixer
<span class="hljs-preprocessor"># ou pour les fainéants</span>
npm i -g autoprefixer

<span class="hljs-preprocessor"># on prefixe !</span>
autoprefixer *.css
</code></pre>
<p>Là bon de suite, réflexe, vous me sautez dessus à la gorge en me criant:</p>
<blockquote>
<p>NON MAIS T’AS CRU QUE J’ALLAIS TAPER LA COMMANDE À CHAQUE FOIS TOCARD ?</p>
</blockquote>
<p>No problem, comme tout outil bien foutu, il y’a une multitudes de façon de
l’utiliser :</p>
<ul>
<li>via <a href="https://github.com/ai/autoprefixer#nodejs">Node.js</a> directement,</li>
<li>en plugin <a href="https://www.npmjs.org/package/gulp-autoprefixer">Gulp</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#grunt">Grunt</a>,</li>
<li>via <a href="https://github.com/ai/autoprefixer#compass">Compass</a>,</li>
<li>en plugin <a href="https://github.com/ai/autoprefixer#stylus">Stylus</a>,</li>
<li>avec <a href="https://github.com/ai/autoprefixer#ruby-on-rails">RoR</a> ou <a href="https://github.com/ai/autoprefixer#ruby">Ruby</a>,</li>
<li>avec l’application <a href="https://github.com/ai/autoprefixer#prepros">Prepros</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#mincer">Mincer</a></li>
<li>via <a href="https://github.com/ai/autoprefixer#middleman">Middleman</a></li>
<li>avec <a href="https://github.com/ai/autoprefixer#php">PHP</a> (vous avez bien lu),</li>
</ul>
<p>Bien entendu, parfois, lorsqu’on fait un petit bout de CSS standalone,
vous avez aussi à dispo des plugins pour
<a href="https://github.com/sindresorhus/sublime-autoprefixer">Sublime Text</a>
 ou <a href="https://github.com/mikaeljorhult/brackets-autoprefixer">Brackets</a>
 afin de ne pas forcément avoir à utiliser les app ou process cités juste avant.</p>
<figure>
  <img src="../../../images/posts/sublime-text/autoprefixer.gif" alt="sublime text autoprefixer preview">
  <figcaption>Intégration dans Sublime Text</figcaption>
</figure>

<p>Cet outil est maintenant basé sur <a href="https://github.com/ai/postcss">PostCSS</a>,
un post-processeur CSS. Vous pouvez donc l’utiliser en plugin pour ce post-procésseur.</p>
<p>Attends attends, un WAT ? Un <strong>POST</strong>-processeur ? Oui tu as bien lu car les
pré-processeurs c’est so 2000.
Mais ça, je vous en parle la prochaine fois ;)</p>
<p>Tout plein de -moz-bisous.</p>
<hr />

<p>PS: Convaincu par cette solution ? Tant mieux, elle est simple à mettre en place.
Tout ça est décrit dans la <a href="/posts/css/mise-en-place-autoprefixer/">mise en place d&#39;autoprefixer</a>
avec des exemples concrets pour ajouter ça dans un workflow existant.</p>

]]></description><pubDate>Tue, 25 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/css/comment-en-finir-avec-les-prefixes/</link><guid isPermaLink="true">http://putaindecode.fr/posts/css/comment-en-finir-avec-les-prefixes/</guid></item><item><title>Sublime Text en tant qu'éditeur Markdown</title><description><![CDATA[[
<p>La vie de développeur n&#39;est jamais facile. Tu souhaites faire quelque chose de précis et tu te retrouves à faire totalement autre chose, <em>patchant</em> ci ou tu as découvert ça.</p>
<p>Typiquement, j&#39;étais tranquillement en train d&#39;écrire un article pour <strong>p!</strong> qui n&#39;avait rien à voir avec celui actuel, et je me retrouve à personnaliser mon Sublime Text pour Markdown car ne souhaitant plus utiliser autre chose que celui-ci pour l&#39;écriture.</p>
<p>Il y a certes le très bon <a href="http://mouapp.com/">Mou.app</a> (<code>$ brew cask install mou</code>) sur Mac OS X mais comme indiqué, il n&#39;est que pour Mac, or il m&#39;arrive parfois d&#39;être sur Windows.
De plus, les éditeurs en ligne comme <a href="https://stackedit.io/">stackedit.io</a> ou <a href="http://dillinger.io/">dillinger.io</a> sont pratiques mais comme j&#39;ai tendance à stocker mes brouillons sur <a href="https://db.tt/nTkiSUb">dropbox</a>, ces outils vous demandent l&#39;accès de toute votre dropbox, chose que je n&#39;aime pas spécialement.</p>
<p>Bref, tout ça pour dire que tout centraliser sur Sublime Text et utiliser dropbox pour écrire des articles me semble une pratique plutôt agréable.</p>
<p>Pour cela, quittez totalement vos éditeurs Markdown et installez les plugins Sublime Text qui vont bien.</p>
<h2 id="markdownediting">MarkdownEditing</h2>
<p>Premièrement, <a href="http://ttscoff.github.io/MarkdownEditing/">MarkdownEditing</a>, ce petit plugin est votre parfait compagnon qui vous permettra d&#39;avoir la bonne coloration syntaxique de votre Markdown. Il vous permettra de mettre en évidence les liens, le code, et tout le reste. Du bonheur donc.</p>
<p><img src="../../../images/posts/preview-markdownediting.png" alt=""></p>
<p>Oui alors, j&#39;ai fait quelques configurations car à la base, ca ressemble plutôt à ça :</p>
<p><img src="../../../images/posts/preview-markdownediting-light.png" alt=""></p>
<p>Si vous souhaitez modifier Sublime Text mais uniquement pour le format Markdown, faites : <code>Preferences &gt; Browse Packages...</code> puis aller dans <code>User</code> et créez un fichier <code>Markdown.sublime-settings</code>. Celui-ci sera lu et appliqué à chaque fois que vous éditerez un fichier Markdown.</p>
<p>Voici ce que j&#39;ai pour le moment :</p>
<pre><code>{
  "<span class="hljs-attribute">color_scheme</span>": <span class="hljs-value"><span class="hljs-string">"Packages/MarkdownEditing/MarkdownEditor-Dark.tmTheme"</span></span>,
  "<span class="hljs-attribute">enable_table_editor</span>": <span class="hljs-value"><span class="hljs-literal">true</span></span>,
  "<span class="hljs-attribute">table_editor_syntax</span>": <span class="hljs-value"><span class="hljs-string">"Auto"</span></span>,
  "<span class="hljs-attribute">tab_size</span>": <span class="hljs-value"><span class="hljs-number">2</span></span>,
  "<span class="hljs-attribute">extensions</span>":
  <span class="hljs-value">[
    <span class="hljs-string">"mdown"</span>,
    <span class="hljs-string">"txt"</span>,
    <span class="hljs-string">"md"</span>
  ]
</span>}
</code></pre><p>Le thème <code>dark</code> pour pas se niquer les yeux (coucou <a href="https://twitter.com/bloodyowl">@bloodyowl</a>), j&#39;active aussi d&#39;autres plugins dont je vais vous parler d&#39;ici peu, j&#39;affecte le spacing à <code>2</code>, et je déclare que j&#39;utiliserai l&#39;éditeur Markdown pour ce genre de fichiers : <code>.mdown</code>, <code>.txt</code>, <code>.md</code>.</p>
<p>Bien, passons à la suite.</p>
<h2 id="markdown-preview">Markdown Preview</h2>
<p>Notre cher <a href="https://twitter.com/revolunet">@revolunet</a> a fait un excellent plugin Markdown pour Sublime Text: <a href="https://github.com/revolunet/sublimetext-markdown-preview">Sublime Text Markdown Preview</a>. Celui-ci permet d&#39;avoir un rendu de votre Markdown en <code>.html</code>. Vous pouvez soit compiler votre Markdown pour créer un fichier HTML, soit l&#39;ouvrir directement dans votre navigateur.</p>
<p>Différents formats disponibles :</p>
<ul>
<li>Python Markdown</li>
<li>Github Flavored Markdown</li>
</ul>
<p>Un autre parfait compagnon en somme, qui quant à lui s&#39;occupera de digérer l&#39;excellent article que vous êtes en train d&#39;écrire.</p>
<p>Je vous parlerai éventuellement un jour de <a href="http://johnmacfarlane.net/pandoc/">pandoc</a> qui permet de faire ce genre de choses mais en un peu plus complet et générique (Sublime Text n&#39;est pas nécessaire) mais c&#39;est un poil plus complexe. Jettez-y un œil tout de même.</p>
<h2 id="smartmarkdown">SmartMarkdown</h2>
<p><a href="https://github.com/demon386/SmartMarkdown">Petit plugin</a> intéressant qui vous permettra de cacher des parties de votre texte en le repliant. Par exemple, vous vous mettez devant un titre du style <code>##</code> et vous appuyez sur <code>tab</code>, cela repliera votre texte. Plutôt pratique pour se focaliser.</p>
<p><img src="../../../images/posts/preview-smartmarkdown.png" alt=""></p>
<h2 id="sublimetableeditor">SublimeTableEditor</h2>
<p>Précédemment dans ma configuration Markdown, vous avez pu voir ceci :</p>
<pre><code>  <span class="hljs-string">"enable_table_editor"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"table_editor_syntax"</span>: <span class="hljs-string">"Auto"</span>,
</code></pre><p>Cela permet de configurer <a href="https://github.com/vkocubinsky/SublimeTableEditor">SublimeTableEditor</a> qui vous permettra de correctement aligner vos tableaux dans Markdown.</p>
<p>Et voilà. Avec tout ceci, vous êtes paré(e) à écrire votre Markdown dans de bonnes conditions. Plus qu&#39;à mettre du Jazz et vous préparer une tasse de thé et c&#39;est parti.</p>
<h2 id="bonus-markdown-extended">Bonus : Markdown Extended</h2>
<p>Il est possible que vous n&#39;aimiez pas forcément MarkdownEditing, et dans ce cas je vous propose un autre plugin pas inintéressant non plus s&#39;appelant <a href="https://github.com/jonschlinkert/sublime-markdown-extended">Markdown Extended</a>. Il vous permettra d&#39;avoir la bonne coloration syntaxique lorsque vous écrivez du code dans votre éditeur.</p>
<h4 id="avant">Avant</h4>
<p><img src="../../../images/posts/preview-markdownextended-before.png" alt=""></p>
<h4 id="apr-s">Après</h4>
<p><img src="../../../images/posts/preview-markdownextended-after.png" alt=""></p>
<p>Oh et j&#39;oubliais, voici quelques documentations sur Markdown histoire de bien l&#39;utiliser :</p>
<ul>
<li><a href="http://daringfireball.net/projects/markdown/syntax">Documentation officielle</a></li>
<li><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Markdown Cheatsheet</a></li>
<li><a href="http://warpedvisions.org/projects/markdown-cheat-sheet.md">Another Markdown Cheatsheet</a></li>
</ul>

]]></description><pubDate>Thu, 20 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/sublime-text/sublime-text-et-markdown/</link><guid isPermaLink="true">http://putaindecode.fr/posts/sublime-text/sublime-text-et-markdown/</guid></item><item><title>La puissance de dnsmasq</title><description><![CDATA[[
<p>Dernièrement, j&#39;ai voulu accéder avec mon Smartphone à ma machine virtuelle (<em>VM</em>) de développement qui se trouve sur mon poste de travail (<em>machine ou poste hôte</em>). Ma machine virtuelle me permet de reproduire à l&#39;identique la production afin d&#39;avoir le moins de marge d&#39;erreur possible entre la phase de développement et la phase de mise en production.</p>
<p>A ce moment là, j&#39;accédais à ma machine virtuelle à partir de mon poste via le fichier <em>hosts</em> comprenant ceci :</p>
<pre><code><span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.145</span> monsite<span class="hljs-preprocessor">.dev</span>
</code></pre><p>Le problème est que seul mon poste est au courant de la résolution du nom de domaine de par cette méthode.</p>
<p>Étant donné qu&#39;il est laborieux de changer des <em>hosts</em> sur un appareil comme un téléphone et que je n&#39;ai pas non plus envie de dupliquer cette modification sur chaque appareil, il me fallait trouver une solution généralisée.</p>
<p>C&#39;est là que <strong><a href="http://fr.wikipedia.org/wiki/Dnsmasq">dnsmasq</a></strong> entre en jeu.</p>
<blockquote>
<p>Dnsmasq est un serveur léger pour fournir les services DNS, DHCP, Bootstrap Protocol et TFTP pour un petit réseau, voire pour un poste de travail. Il permet d&#39;offrir un service de nommage des machines du réseau interne non intégrées au service de nommage global (i.e. le service DNS d&#39;Internet). Le service de nommage est associé au service d&#39;adressage de telle manière que les machines dont le bail DHCP est fourni par Dnsmasq peuvent avoir automatiquement un nom DNS sur le réseau interne. Le logiciel offre un service DHCP statique ou dynamique.</p>
</blockquote>
<h2 id="dnsmasq-le-serveur-dns-tout-petit">dnsmasq, le serveur dns tout petit</h2>
<p><strong>dnsmasq</strong> va me permettre de faire plusieurs choses :</p>
<ul>
<li>accélérer la résolution dns</li>
<li>ne pas polluer le réseau interne de la boite avec des résolutions de domaines propre à votre poste (imaginez que vous soyez plusieurs à avoir <em>monsite.dev</em> (ce qui est le cas dans notre boite)); une résolution se ferait uniquement vers un seul poste donc impossible de faire sans si vous êtes plusieurs</li>
<li>ne pas dupliquer sur chacun appareil la résolution dns</li>
<li>réussir à résoudre un nom de domaine sur un appareil où le fichier <em>hosts</em> est difficile voire impossible d&#39;accès</li>
</ul>
<p>Cependant, tout n&#39;est pas si rose, je vais vous montrer pourquoi après.</p>
<h3 id="partage-de-connexion">Partage de connexion</h3>
<p>Je vous propose dans un premier temps de partager votre connexion via le Wifi sous Mac OS X afin :</p>
<ul>
<li>d&#39;avoir constamment un débit stable et performant; étant donné que vous êtes souvent devant votre poste pour tester sur différents appareils, en partageant votre connexion via Wifi, vous vous assurez d&#39;avoir un excellent débit, chose qui n&#39;est pas toujours évidente quand le wifi de votre boite est un peu / souvent trop loin</li>
<li>d&#39;utiliser le serveur dns (dnsmasq) que vous allez monter</li>
</ul>
<p>Pour cela, il suffit de faire : <code>System Preferences &gt; Sharing &gt; Internet Sharing</code> puis choisir <code>Ethernet</code> en source, et <code>Wifi</code> en sortie. (Je vous conseille d&#39;ailleurs de protéger votre Wifi avec une clé WPA2).</p>
<figure><img src="../../../images/posts/macosx-network-sharing.png" alt=""></figure>

<p><em>Ici, c&#39;est USB Ethernet en source car je suis sur un Mac Book Air donc aucun port ethernet natif mais choisissez Ethernet si possible.</em></p>
<p>Une fois que le partage de connexion via Wifi est activé, vous pouvez vous y connecter avec votre smartphone (ou tablette).</p>
<p>Cela crée alors un nouveau réseau privé entre votre machine hôte et votre téléphone avec des adresses comme <code>192.168.2.x</code>. La machine hôte aura sûrement l&#39;adresse <code>192.168.2.1</code> et votre téléphone très probablement <code>192.168.2.2</code>.</p>
<p>C&#39;est alors un autre réseau que le réseau interne à la boite en <code>192.168.1.x</code>.</p>
<p>Notez aussi que la machine hôte, faisant bridge, donne les informations en cascade aux appareils connectés. Ce que vous spécifiez comme serveurs dns sur la machine hôte sera alors ceux utilisés par les appareils étant connectés à votre partage de réseau.</p>
<h3 id="aaaah-dnsmasq-">Aaaah dnsmasq !</h3>
<p>On est sous Mac OS X, la vie est si simple, on installe <strong>dnsmasq</strong> via <strong>homebrew</strong>.</p>
<h4 id="dnsmasq-via-homebrew">dnsmasq via homebrew</h4>
<pre><code><span class="hljs-variable">$ </span>brew install dnsmasq
</code></pre><h4 id="configuration-de-dnsmasq">configuration de dnsmasq</h4>
<p>Une fois installé, on copie la configuration :</p>
<pre><code>$ <span class="hljs-keyword">cp</span> /usr/local/opt/dnsmasq/dnsmasq<span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.example</span> /usr/local/etc/dnsmasq<span class="hljs-preprocessor">.conf</span>
</code></pre><p>puis on édite le comme ceci :</p>
<pre><code><span class="hljs-preprocessor"># Add domains which you want to force to an IP address here.</span>
<span class="hljs-preprocessor"># The example below send any host in double-click.net to a local</span>
<span class="hljs-preprocessor"># web-server.</span>
<span class="hljs-preprocessor">#address=/double-click.net/127.0.0.1</span>
address=/monsite.dev/<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.145</span>

<span class="hljs-preprocessor"># If you want dnsmasq to listen for DHCP and DNS requests only on</span>
<span class="hljs-preprocessor"># specified interfaces (and the loopback) give the name of the</span>
<span class="hljs-preprocessor"># interface (eg eth0) here.</span>
<span class="hljs-preprocessor"># Repeat the line for more than one interface.</span>
<span class="hljs-preprocessor">#interface=</span>
<span class="hljs-preprocessor"># Or you can specify which interface _not_ to listen on</span>
<span class="hljs-preprocessor">#except-interface=</span>
<span class="hljs-preprocessor"># Or which to listen on by address (remember to include 127.0.0.1 if</span>
<span class="hljs-preprocessor"># you use this.)</span>
listen-address=<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
<span class="hljs-preprocessor"># If you don't want dnsmasq to read /etc/hosts, uncomment the</span>
<span class="hljs-preprocessor"># following line.</span>
no-hosts
</code></pre><p>Nous précisons dans un premier temps la résolution du nom de domaine <code>monsite.dev</code> (notez que c&#39;est du wildcard, donc pas besoin de préciser les sous-domaines), puis nous indiquons que le serveur DNS marche sur toutes les IPs de la machine hôte et enfin nous indiquons que nous ne voulons pas prendre en compte le fichier <code>/etc/hosts</code> vu qu&#39;on spécifie les résolutions via <code>address</code>.</p>
<p>Cela permettra à terme de ne plus gérer le fichier <code>/etc/hosts</code> et de tout spécifier dans <code>dnsmasq.conf</code>.</p>
<h4 id="lancer-dnsmasq-au-d-marrage-de-la-machine">lancer dnsmasq au démarrage de la machine</h4>
<p>On copie le fichier de démon dans le dossier qui va bien puis on lance le démon.</p>
<pre><code>$ <span class="hljs-built_in">sudo</span> cp -fv /usr/local/opt/dnsmasq/*.plist /Library/LaunchDaemons
$ <span class="hljs-built_in">sudo</span> launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist
</code></pre><h4 id="utiliser-le-serveur-dnsmasq">utiliser le serveur dnsmasq</h4>
<p>Etant donné que vous partagez votre connexion et que votre poste fait hôte, le serveur dns utilisé sera celui installé sur votre poste, donc rien à faire.</p>
<p>Sinon :</p>
<ul>
<li><p>vous pouvez changer le serveur dns de la machine hôte dans <code>network</code> et dans ce cas, que ce soit sur vos appareils connectés au wifi ou votre machine principale, vous utiliserez <strong>dnsmasq</strong> mais je vous le déconseile car j&#39;ai constaté que j&#39;atteignais trop facilement le nombre de connexions maximum.</p>
</li>
<li><p>vous pouvez aussi modifier le serveur dns de l&#39;appareil connecté au wifi partagé :</p>
</li>
</ul>
<p><em>(Sous Android)</em></p>
<p><code>Wifi &gt; Press on the current connnection &gt; Modify network &gt; Show advanced options</code></p>
<figure><img src="../../../images/posts/android-network-advanced.jpg" alt=""></figure>

<p>Mais quel intérêt car vous devrez faire cela sur tous vos appareils connectés</p>
<ul>
<li>vous pouvez aussi éditer le fichier <code>/etc/bootpd.plist</code> qui définit toute votre configuration de partage de connexion :</li>
</ul>
<pre><code>$ <span class="hljs-built_in">sudo</span> <span class="hljs-variable">$EDITOR</span> /etc/bootpd.plist
</code></pre><pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">plist</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"1.0"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>Subnets<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dict</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>_creator<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>com.apple.InternetSharing<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>allocate<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">true</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_domain_name_server<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_router<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>lease_max<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-title">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>lease_min<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-title">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2/24<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_address<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.0<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_mask<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>255.255.255.0<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_range<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.2<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.254<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>bootp_enabled<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">false</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>detect_other_dhcp_server<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">true</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_enabled<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>bridge100<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>use_server_config_for_dhcp_options<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">false</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">plist</span>&gt;</span>
</code></pre>
<p><code>192.168.2.1</code> est l&#39;adresse de votre machine hôte dans le réseau de partage.</p>
<h2 id="oh-oui-j-oubliais-mac-os-x-peut-tre-lourd-parfois">Oh oui, j&#39;oubliais, Mac OS X peut être lourd parfois</h2>
<p>Oui, quand vous créez un partage de connexion sur Mac OS X, il lance son propre serveur dns s&#39;appelant <strong>_mdnsresponder</strong>. C&#39;est le système <em>Bonjour</em> de iOS/Mac OS X permettant à n&#39;importe quel appareil Apple de communiquer entre eux. Le problème c&#39;est qu&#39;il risque de marcher sur les pieds de <strong>dnsmasq</strong>.</p>
<p>Faites donc un <code>$ sudo lsof -i :53</code> et vous pourrez éventuellement voir que <strong>_mdnsresponder</strong> est lancé aussi bien en ipv6 qu&#39;en ipv4 sur le port 53. Cela vous empêchera de lancer <strong>dnsmasq</strong>.</p>
<p>Ce que je vous propose dans ces cas là, c&#39;est de couper votre partage de connexion, puis notez le pid de <strong>_mdnsresponder</strong> via <code>$ sudo lsof -i :53</code>, de le <code>sudo kill :pid</code>, de lancer <code>$ sudo dnsmasq</code> puis de relancer le partage de connexion. Comme ça <strong>_mdnsresponser</strong> ne prendra plus la place de <strong>dnsmasq</strong>.</p>
<p>Autre point, évitez, mais vraiment, de nommer vos noms de domaines personnels en <code>.local</code>. En effet, ceux-ci sont plutôt réservés à l&#39;environnement Mac OS X. Ils sont d&#39;ailleurs en rapport avec <strong>_mdnsresponder</strong>. Les <code>.local</code> permettent à n&#39;importe quel produit Apple sur le réseau de se connecter à d&#39;autres postes Apple via <code>nom-de-l-appareil.local</code>. Votre connexion pourrait alors s&#39;emméler entre le serveur dns de <strong>Bonjour</strong> et votre propre serveur dns.</p>
<p>Happy coding !</p>

]]></description><pubDate>Thu, 20 Feb 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/env/la-puissance-de-dnsmasq/</link><guid isPermaLink="true">http://putaindecode.fr/posts/env/la-puissance-de-dnsmasq/</guid></item><item><title>BROWSERIFY ALL THE THINGS</title><description><![CDATA[[
<p>Alors que je prends goût à me passer de frameworks (principalement à cause des
courbes d&#39;apprentissage et des éventuelles lourdeurs et/ou restrictions que cela
impose, mais c&#39;est une autre histoire),
je cherchais la meilleure façon d&#39;écrire des micro composants réutilisables.</p>
<p>Pour le JavaScript, j&#39;ai commencé il y a bien longtemps par des extensions/plugins
<a href="http://prototypejs.org/">Prototype</a>, puis peu de temps après, du plugins
<a href="http://plugins.jquery.com/">jQuery</a> à la pelle.
Souvent à tord puisque j&#39;utilisais peut être 1% de la librairie en dépendance -
exemple avec mon <a href="https://github.com/MoOx/jQuery.Loading-Indicator/">indicateur de chargement avec sémaphore</a>
ou encore mon <a href="https://github.com/MoOx/jQuery.External-Links/">plugin qui ouvre les liens externes avec du target blank automatique</a>.</p>
<p><b>Je ne ferais plus jamais ça pour la simple raison du ratio &quot;poids / % d&#39;utilisation&quot; de la dépendance.</b></p>
<p>Alors oui, utiliser jQuery a peut-être du bon. Mais s&#39;en passer aussi.
<a href="/posts/js/de-jquery-a-vanillajs/">C&#39;est faisable pour pleins de petites choses</a>.
<a href="/posts/js/comment-se-passer-de-libraries-frameworks-javascript/">Et c&#39;est pas forcément difficile</a>.</p>
<p>Car si je veux utiliser mon petit script qui ajoute des targets blank automatiquement,
 devoir inclure jQuery pour si peu, ça fait mal à mes kilobites.</p>
<p>En attendant <a href="http://wiki.ecmascript.org/doku.php?id=harmony:modules">
la gestion de modules via ES6</a>, il nous faut gérer aujourd&#39;hui nos composants
et dépendances à la main.
Encore qu&#39;on pourrait faire un transpiler pour utiliser cette syntaxe (ça existe
déjà, il n&#39;y a qu&#39;à voir sur GitHub), mais là on ne ferait que créer une nouvelle
définition de module.</p>
<p>Côté back-end, on a déjà ce qu&#39;il faut en JavaScript avec la gestion
<a href="http://nodejs.org/api/modules.html">des modules en Node</a>.
Un simple <code>require(&#39;module&#39;)</code> va tenter de récupérer un module avec ce nom.
Un module n&#39;est rien d&#39;autre qu&#39;un fichier JavaScript. Node va essayer de loader
un <code>.js</code>, puis <code>.json</code> et enfin <code>.node</code> si besoin), qui lui même peut
éventuellement charger d&#39;autres dépendances (les dépendances sont gérées localement)
tout en prenant en compte les packages NPM.
Même si <a href="http://nodejs.org/">Node</a> n&#39;implémente pas totalement
<a href="http://wiki.commonjs.org/wiki/CommonJS">CommonJS</a>, un projet de développement d&#39;une API pour
écrire des programmes en JavaScript ailleurs que dans le navigateur,
la façon de faire est assez proche.</p>
<figure><img src="../../../images/posts/browserify.png" alt=""></figure>

<p>L&#39;idée de <a href="http://browserify.org/">Browserify</a> est d&#39;amener cette façon de faire
dans le navigateur.</p>
<p>À côté de ça, vous me direz qu&#39;on a déjà <a href="http://requirejs.org/">RequireJS</a>
pour un résultat similaire.</p>
<p>RequireJS implémente l&#39;API AMD  (Asynchronous Module Definition),
différent de l&#39;API CommonJS.
Cette API, dérivée de CommonJS, se veut adaptée au navigateur. Son principal atout
étant le chargement des modules de manière asynchrone.
En théorie, c&#39;est super.</p>
<p>Sauf que dans la pratique (du moins quelque chose de simple et classique,
disons pour l&#39;exemple du petit JavaScript pour améliorer une page web, ou encore
une simple <em>single page webapp</em> (SPA)) ce n&#39;est pas forcément pertinent.</p>
<p>En effet charger des modules de manières asynchrones n&#39;est forcément pas optimisé
lorsqu&#39;il s&#39;agit de faire des pages qui se chargent rapidement.
Il suffit de penser aux problématiques de débits selon la vitesse de la connexion
au réseau (Edge, faible 3G...) et donc nombre de requêtes HTTP qui peuvent nous
faire souffrir de gros ralentissement pour se rendre compte que cela peut poser
problème.</p>
<p>En plus de cela, je trouve personnellement dégueulasse  la façon de déclarer les
modules AMD, mais ça ce n&#39;est qu&#39;un détail.</p>
<p>Comparons les différentes méthodes comme on nous les montre sur le site de
<a href="http://requirejs.org/docs/whyamd.html">RequireJS</a> :</p>
<p>Le web aujourd&#39;hui:</p>
<pre><code class="lang-js">(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> $ = <span class="hljs-keyword">this</span>.jQuery;

    <span class="hljs-keyword">this</span>.myExample = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
}());
</code></pre>
<p>AMD:</p>
<pre><code class="lang-js">define([<span class="hljs-string">'jquery'</span>] , <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
});
</code></pre>
<p>CommonJS:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
exports.myExample = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};
</code></pre>
<p>AMD et CommonJS utilisent tout les deux une identification par chaîne de caractères.
Il faut bien que ces chaînes soient déclarées quelque part.</p>
<p>Côté RequireJS (AMD), on doit éventuellement mapper toutes ces chaînes à la main,
dans le fichier configuration.
De plus la déclaration des dépendances se faisant dans l&#39;entête du module, ça peut
devenir lourd :</p>
<pre><code class="lang-js">define([ <span class="hljs-string">"require"</span>, <span class="hljs-string">"jquery"</span>, <span class="hljs-string">"blade/object"</span>, <span class="hljs-string">"blade/fn"</span>, <span class="hljs-string">"rdapi"</span>,
         <span class="hljs-string">"oauth"</span>, <span class="hljs-string">"blade/jig"</span>, <span class="hljs-string">"blade/url"</span>, <span class="hljs-string">"dispatch"</span>, <span class="hljs-string">"accounts"</span>,
         <span class="hljs-string">"storage"</span>, <span class="hljs-string">"services"</span>, <span class="hljs-string">"widgets/AccountPanel"</span>, <span class="hljs-string">"widgets/TabButton"</span>,
         <span class="hljs-string">"widgets/AddAccount"</span>, <span class="hljs-string">"less"</span>, <span class="hljs-string">"osTheme"</span>, <span class="hljs-string">"jquery-ui-1.8.7.min"</span>,
         <span class="hljs-string">"jquery.textOverflow"</span>],
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(require,   $,        object,         fn,         rdapi,
          oauth,   jig,         url,         dispatch,   accounts,
          storage,   services,   AccountPanel,           TabButton,
          AddAccount,           less,   osTheme)</span> {</span>
  <span class="hljs-comment">// ici le corps de la fonction</span>
});
</code></pre>
<p>Bon vous me direz que si un module a autant de dépendances, il y a peut être un
problème en amont et vous n&#39;aurez pas tort.</p>
<p>Côté Browserify (CommonJS like), les dépendances externes proviennent (à la base)
de NPM.
On a donc rien à mapper nul part. Puis pour avoir un module local, il suffit de
faire un <code>require(&#39;./mon/module&#39;)</code>, et Browserify se chargera de régler la
dépendance (et je vous montre encore mieux après).</p>
<p>RequireJS propose un &quot;optimizer&quot;, qui au final ne fait que supprimer son point fort:
le côté asynchrone du téléchargement des modules.
Du coup on se retrouve avec tout RequireJS dans la source ET toutes les dépendances avec le mapping.
Il y a bien une façon de vraiment optimiser par bundle quand on cherche un peu
dans la doc, mais
<a href="http://requirejs.org/docs/optimization.html#wholemultipage">ça n&#39;est pas vraiment mis en avant</a>.
Il existe aussi <a href="https://github.com/jrburke/almond">Almond.js</a> qui se veut être
plus léger, mais du coup, utiliser RequireJS pour optimiser avec Almond, je ne
trouve pas ça cohérent.</p>
<p>Si jusque là, Browserify vous intéresse (plus car les autres solutions ne vous
intéressent pas), attaquons le corps du sujet.</p>
<h2>Installation de Browserify</h2>

<p>Si vous souhaitez accéder à la commande via le terminal, la chose la plus simple
à faire est d&#39;installer le paquet en global.</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>npm install -g browserify
</code></pre>
<p>Si vous ne l&#39;installez pas en global (sans l&#39;option <code>-g</code>, vous aurez la commande
accessible dans <code>./node_modules/.bin/browserify</code>).
Mais selon votre workflow, vous pouvez l&#39;utiliser via une tâche
<a href="https://www.npmjs.org/package/grunt-browserify">grunt-browserify</a>
ou <a href="https://www.npmjs.org/package/gulp-browserify">gulp-browserify</a>.</p>
<h2>Utilisation de Browserify</h2>

<p>Partons d&#39;un simple fichier <code>main.js</code>:</p>
<pre><code class="lang-js"><span class="hljs-function">alert(<span class="hljs-string">'Hello world !'</span>)</span>;
</code></pre>
<p>Sans aucune dépendance, ça n&#39;a que peu de sens, mais c&#39;est plus pour montrer un
dernier point intéressant.</p>
<p>Je le compile avec la commande suivante:</p>
<pre><code class="lang-bash">$ browserify main<span class="hljs-preprocessor">.js</span> -o bundle<span class="hljs-preprocessor">.js</span>
</code></pre>
<p>J&#39;obtiens le fichier suivant.</p>
<pre><code class="lang-js">(function e(t,n,r){function s(o,u){if(!n[<span class="hljs-link_label">o</span>]){if(!t[<span class="hljs-link_label">o</span>]){var a=typeof require=="function"&amp;&amp;require;if(!u&amp;&amp;a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[<span class="hljs-link_label">o</span>]={exports:{}};t[<span class="hljs-link_label">o</span>][<span class="hljs-link_reference">0</span>].call(f.exports,function(e){var n=t[<span class="hljs-link_label">o</span>][<span class="hljs-link_reference">1</span>][<span class="hljs-link_label">e</span>];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&amp;&amp;require;for(var o=0;o<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">r.length;o++)s(r[o]);return</span> <span class="hljs-attribute">s</span>})({<span class="hljs-attribute">1:</span>[<span class="hljs-attribute">function</span>(<span class="hljs-attribute">require</span>,<span class="hljs-attribute">module</span>,<span class="hljs-attribute">exports</span>){
<span class="hljs-attribute">alert</span>('<span class="hljs-attribute">Hello</span> <span class="hljs-attribute">world</span> !');


},{}]},{},[<span class="hljs-attribute">1</span>])</span></span>
</code></pre>
<p>On reconnaît notre ligne en plein milieu. Avec un ajout conséquent. Ça peut paraître
beaucoup, mais c&#39;est rien comparé à la
<a href="http://requirejs.org/docs/release/2.1.10/minified/require.js">source de RequireJS</a></p>
<p>Bon du coup partons avec un exemple peut être plus représentatif qu&#39;on peut voir
sur la homepage de Browserify.</p>
<pre><code class="lang-js"><span class="hljs-reserved">var</span> foo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./foo'</span>);
<span class="hljs-reserved">var</span> gamma = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gamma'</span>);

<span class="hljs-reserved">var</span> n = gamma(foo(<span class="hljs-number">5</span>) * <span class="hljs-number">3</span>);
<span class="hljs-reserved">var</span> txt = <span class="hljs-built_in">document</span>.createTextNode(n);
<span class="hljs-built_in">document</span>.body.appendChild(txt);
</code></pre>
<p>Ici on aura en plus <code>foo.js</code></p>
<pre><code class="lang-js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n)</span></span> { <span class="hljs-keyword">return</span> n * <span class="hljs-number">11</span> }
</code></pre>
<p>Et le module <code>gamma</code> qu&#39;on a installé depuis NPM</p>
<pre><code class="lang-bash">$ npm <span class="hljs-built_in">i</span> <span class="hljs-built_in">gamma</span>
</code></pre>
<p><small><i><code>i</code> est l&#39;alias de <code>install</code>.</i></small></p>
<p>Avec la même commande que précédement (et donc le même ajout), Browserify va parser
l&#39;arbre syntaxique abstrait (AST) des appels à <code>require()</code> et va créer un graph
des dépendances du projet.<br>Un fois ceci fait, il va simplement ajuster les chemins et déclarer les fonctions
mappées dans un object par leur identifiant. Lorsqu&#39;une fonction appelle <code>require</code>,
le petit bout de script ajouté va se charger de retourner la dépendance.</p>
<p>Notez qu&#39;on peut aussi simplement utiliser une redirection de sortie de commande
pour gérer le fichier final:</p>
<pre><code class="lang-bash">$ browserify main<span class="hljs-preprocessor">.js</span> &gt; bundle<span class="hljs-preprocessor">.js</span>
</code></pre>
<p>Du coup on a plus qu&#39;à utiliser une simple balise <code>&lt;script&gt;</code> pour incorporer ça
dans nos pages web.</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"bundle.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<h2>Les transformations avec Browserify</h2>

<p>Tant qu&#39;à utiliser un outil, autant l&#39;exploiter jusqu&#39;au bout. Car pour l&#39;instant
je n&#39;ai parlé que de NPM.
Que faire si mon module n&#39;est pas sur NPM ?
Bon déjà je double check, car maintenant la plupart des librairies y sont
(jQuery, Backbone et Jean passe).
Si ce n&#39;est pas le cas, je pourrais toujours faire <code>npm i https//adresse.git</code>
mais si le paquet n&#39;a pas de <code>package.json</code> avec le <code>main</code> bien rempli, ça ne va
pas forcément être le mieux.</p>
<p>Cela dit, si mon paquet est prévu pour Bower par exemple, il existe une <i>transformation</i>
prévue pour aider Browserify à résoudre les références aux paquets pour les
consommer depuis Bower: <code>debowerify</code>.
Dans le même esprit, on va retrouver de nombreuses transformations telles que :</p>
<ul>
<li><code>decomponentify</code>: pour consommer des <a href="https://github.com/component/component">component</a>s,</li>
<li><code>deamdify</code>:  pour consommer des modules AMD,</li>
<li><code>deglobalify</code>: pour consommer des modules qui utilisent des variables globales,</li>
<li><code>jadeify</code>: pour consommer des fichiers de templates jade,</li>
<li><code>hbsify</code>: pour consommer des fichiers de templates handlebars,</li>
<li><code>es6ify</code>: pour écrire du JavaScript ES6 (compilé en ES5),</li>
<li><code>uglifyify</code>: appliquer uglify.</li>
</ul>
<p>Il existe plein <a href="https://www.npmjs.org/browse/keyword/browserify">d&#39;autres transformations</a>
qui s&#39;adapteront sûrement à vos besoins.</p>
<p>Du coup la ligne ultime pour consommer a peu près n&#39;importe quel module :</p>
<pre><code class="lang-bash">browserify <span class="hljs-attribute">-t</span> debowerify <span class="hljs-attribute">-t</span> decomponentify <span class="hljs-attribute">-t</span> deamdify <span class="hljs-attribute">-t</span> deglobalify <span class="hljs-attribute">-t</span> es6ify main<span class="hljs-built_in">.</span>js <span class="hljs-subst">&gt;</span> bundle<span class="hljs-built_in">.</span>js
</code></pre>
<p>L&#39;équivalent avec les tâches Grunt ou Gulp sera tout aussi simple via un tableau.
Pensez bien à installer ces dépendances avant:</p>
<pre><code class="lang-bash"><span class="hljs-comment">npm</span> <span class="hljs-comment">install</span> <span class="hljs-comment">debowerify</span> <span class="hljs-comment">decomponentify</span> <span class="hljs-comment">deamdify</span> <span class="hljs-comment">deglobalify</span> <span class="hljs-comment">es6ify</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span>
</code></pre>
<h2>Ecrire un module pour Browserify (mais pas que)</h2>

<p>Consommer c&#39;est bien, mais faire c&#39;est <del>mieux</del> bien aussi.</p>
<figure><img src="../../../images/posts/browserify-potter.png" alt=""></figure>

<p>Tout droit sorti de <a href="https://github.com/umdjs/umd">UMD</a> (Universal Module Definition),
voici un wrapper qui vous permettra de créer votre module compatible avec CommonJS,
AMD et pour les projets old school !</p>
<pre><code class="lang-js"><span class="hljs-list">(<span class="hljs-title">function</span> <span class="hljs-list">(<span class="hljs-title">root</span>, factory)</span> <span class="hljs-collection">{
  if <span class="hljs-list">(<span class="hljs-title">typeof</span> exports === 'object')</span> <span class="hljs-collection">{
    // CommonJS
    module.exports = factory<span class="hljs-list">(<span class="hljs-title">require</span><span class="hljs-list">(<span class="hljs-title">'b'</span>)</span>)</span><span class="hljs-comment">;</span>
  }</span> else if <span class="hljs-list">(<span class="hljs-title">typeof</span> define === 'function' &amp;&amp; define.amd)</span> <span class="hljs-collection">{
    // AMD
    define<span class="hljs-list">(<span class="hljs-collection">['b']</span>, function <span class="hljs-list">(<span class="hljs-title">b</span>)</span> <span class="hljs-collection">{
      return <span class="hljs-list">(<span class="hljs-title">root.returnExportsGlobal</span> = factory<span class="hljs-list">(<span class="hljs-title">b</span>)</span>)</span><span class="hljs-comment">;</span>
    }</span>)</span><span class="hljs-comment">;</span>
  }</span> else <span class="hljs-collection">{
    // Global Variables
    root.returnExportsGlobal = factory<span class="hljs-list">(<span class="hljs-title">root.b</span>)</span><span class="hljs-comment">;</span>
  }</span>
}</span><span class="hljs-list">(<span class="hljs-title">this</span>, function <span class="hljs-list">(<span class="hljs-title">b</span>)</span> <span class="hljs-collection">{

  // Ici votre module <span class="hljs-list">(<span class="hljs-title">fonction</span>, objet, whatever...)</span>
  return <span class="hljs-collection">{}</span><span class="hljs-comment">;</span>
}</span>)</span>)</span><span class="hljs-comment">;</span>
</code></pre>
<p>Il existe bien sur <a href="https://github.com/umdjs/umd#variations">plusieurs façons de faire</a>
selon vos critères. À vous de choisir.</p>
<p>Maintenant vous aller pouvoir consommer et écrire des modules facilement, et
sans vous prendre la tête.</p>
<p>Bisous.</p>

]]></description><pubDate>Wed, 15 Jan 2014 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/browserify-all-the-things/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/browserify-all-the-things/</guid></item><item><title>Responsive webdesign et structure du DOM</title><description><![CDATA[[
<p>Bien, commençons par le commencement, si tu veux bien. Le <strong>responsive
webdesign</strong>, ça te dit quelque chose ? Oui ? Bon. Dans ce cas, tu as peut-être
comme moi déjà été confronté à un cas de figure plutôt ennuyeux. Que tu sois
adepte du <em>mobile-first</em> ou irréductible dégradateur progressiste, il est
forcément arrivé un moment où tu t&#39;es dit cette chose toute bête :</p>
<blockquote>
<p>Ce serait quand même pas mal si cet élément était ici plutôt que là. Sauf que
non.</p>
</blockquote>
<p>Le cas typique est celui d&#39;un menu un minimum complexe, dont on réordonnerait
volontiers les éléments un chouïa au dessus ou en deçà d&#39;une certaine taille
d&#39;écran. Et là, il faut bien avouer qu&#39;il n&#39;existe pas vraiment de solution
miracle.</p>
<p>J&#39;entends déjà les plus teigneux vociférer qu&#39;avec une meilleure réflexion en
amont, le <em>markup</em> aurait été mieux conçu et on n&#39;en serait pas là. Bien qu&#39;un
peu facile, cette réponse peut s&#39;avérer vraie dans un certain nombre de cas
(admire la phrase du mec qui ne se mouille pas). Mais quoi qu&#39;il en soit, si tu
en es au stade de ce type de questionnement, c&#39;est qu&#39;il est de toute façon trop
tard pour faire machine arrière.</p>
<p>Au train où va l&#39;innovation dans notre branche, surtout pour tout ce qui touche
au mobile en général et à la conception web en particulier, il n&#39;est pas exclu
que les bouts de ficelle que je vais t&#39;exposer ici soient obsolètes dans six
mois, et que cet article fasse un comeback incroyable sur Twitter, les RT
moquant gentiment les techniques précolombiennes auxquelles nous étions réduits
il n&#39;y a encore pas si longtemps. Va savoir, je pourrais bien faire l&#39;objet
d&#39;une célébrité paradoxalement décadente à la Rick Astley. En attendant, il
s&#39;agit des seules solutions que je connais pour ce type de cas. Si tu as mieux à
proposer, je te recommande chaudement de l&#39;ouvrir dans les commentaires pour
qu&#39;on en bénéficie tous. C&#39;est bon, on y va ? Je t&#39;attends, moi !</p>
<h2 id="-l-ancienne-do-repeat-yourself">À l&#39;ancienne : Do Repeat Yourself</h2>
<p>Imagine une page de blog, où apparaissent consécutivement le titre de l&#39;article,
la photo l&#39;illustrant, et enfin le texte. Comme une photo, selon la qualité de
ta connexion, ça peut être un peu galère à charger sur mobile (et que la
question des images en responsive design
<a href="http://css-tricks.com/responsive-images-hard/">est encore un sacré bordel</a>), tu
prends la décision de passer la photo en dessous du contenu textuel pour que tes
visiteurs puissent lire leur article peinards même si la photo n&#39;a pas fini de
charger - et tu vas même en profiter pour la remplacer par une version plus
light.</p>
<p>Dans un tel cas, la meilleure solution peut encore être de dupliquer ta balise
<code>img</code>, et de masquer l&#39;une ou l&#39;autre avec CSS en fonction de la taille d&#39;écran,
grâce à une <code>media query</code>. Voilà un exemple rudimentaire :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-desktop"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Lâche tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-css"><span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
  <span class="hljs-comment">/* Par défaut, l'image desktop est cachée */</span>
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-comment">/* Si on est sur "grand" écran, on affiche l'image desktop... */</span>
  <span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-comment">/* ...et on masque l'image mobile */</span>
  <span class="hljs-class">.img-mobile</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
  <span class="hljs-rule">}</span></span>
}
</code></pre>
<p>Évidemment, le gros inconvénient de ce type de solution est que qui dit
duplication de contenu dit augmentation du poids total. Dans le cas d&#39;un contenu
purement textuel, selon sa taille, cela peut être négligeable. J&#39;ai ici
volontairement pris l&#39;exemple le moins adapté : une image, qu&#39;il ne faut
absolument pas faire charger deux fois à nos visiteurs. On va tricher un peu
avec JavaScript :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- Ces images ne seront pas chargées car elles n'ont pas d'attribut src --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-desktop"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Lâche tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">noscript</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Cette image ne sera chargée que si le visiteur n'a pas activé le JS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-mobile img-noscript"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">noscript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-css"><span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-class">.img-desktop</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.img-mobile</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
  <span class="hljs-rule">}</span></span>
}

<span class="hljs-class">.img-noscript</span> <span class="hljs-rules">{
  <span class="hljs-comment">/* On surcharge le style desktop pour s'assurer
     que cette image s'affiche quelle que soit la taille de l'écran */</span>

  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> handleImages = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// On charge les images ayant l'attribut data-src,</span>
  <span class="hljs-comment">// non encore chargées (attribut src indéfini)</span>
  <span class="hljs-comment">// et non masquées par CSS</span>

  [].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(<span class="hljs-string">'img[data-src]:not([src])'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
    <span class="hljs-keyword">if</span> (window.getComputedStyle(el).display != <span class="hljs-string">'none'</span>) {
      el.src = el.getAttribute(<span class="hljs-string">'data-src'</span>);
    }
  });
};

window.addEventListener(<span class="hljs-string">'load'</span>, handleImages);
window.addEventListener(<span class="hljs-string">'resize'</span>, handleImages);
</code></pre>
<p>Ainsi, seules les images nécessaires seront chargées avec la page. J&#39;applique
également le même traitement au <code>resize</code> ; c&#39;est un peu bourrin, je te
l&#39;accorde, on pourrait probablement faire plus fin avec <code>matchMedia</code>.</p>
<p>Dans le cas d&#39;un visiteur naviguant sans JavaScript, seule l&#39;image mobile est
chargée : je pars du principe qu&#39;étant donné qu&#39;on ne peut pas définir laquelle
des deux versions de l&#39;image est la mieux adaptée pour lui, autant lui envoyer
la plus légère.</p>
<h2 id="js-powa-enquire-js">JS powa : enquire.js</h2>
<p>La seconde solution peut tout à fait être réalisée &quot;à la main&quot;, mais je vais te
parler d&#39;une petite librairie que j&#39;aime beaucoup et que j&#39;ai déjà utilisée dans
ce genre de cas. Elle se nomme <a href="http://wicky.nillia.ms/enquire.js/">enquire.js</a>
et permet tout simplement d&#39;affecter des callbacks à des media queries :</p>
<pre><code class="lang-javascript">enquire.register(<span class="hljs-string">'screen and (min-width: 768px)'</span>, {
  match: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// L'écran fait 768px de large ou plus...</span>
  },

  unmatch: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// ...et ici, 767px de large ou moins.</span>
    <span class="hljs-comment">// La librairie repose sur matchMedia et matchMedia.addListener</span>
  }
});
</code></pre>
<p>Plutôt sympa, non ? Pour reprendre notre exemple de tout à l&#39;heure (le CSS n&#39;est
plus nécessaire) :</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">article</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>Mon super article<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">data-src</span>=<span class="hljs-value">"/mon/image/desktop.jpg"</span> <span class="hljs-attribute">data-mobile-src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>Lâche tes comm' !<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mon/image/mobile.jpg"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">noscript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> content = document.querySelector(<span class="hljs-string">'p'</span>),

  switchImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(isMobile)</span> {</span>
    <span class="hljs-keyword">var</span> attr = isMobile ? <span class="hljs-string">'data-mobile-src'</span> : <span class="hljs-string">'data-src'</span>;

    [].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(<span class="hljs-string">'img['</span> + attr + <span class="hljs-string">']'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
      <span class="hljs-comment">// On affecte l'une ou l'autre source à notre image,</span>
      <span class="hljs-comment">// entraînant son chargement si nécessaire.</span>
      el.src = el.getAttribute(attr);

      <span class="hljs-comment">// On en profite pour la bouger avant ou après le contenu</span>
      content.parentNode.insertBefore(el, isMobile ? content.nextSibling : content);
    });
  };

enquire.register(<span class="hljs-string">'screen and (min-width: 768px)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  switchImage(<span class="hljs-keyword">false</span>);
});

enquire.register(<span class="hljs-string">'screen and (max-width: 767px)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  switchImage(<span class="hljs-keyword">true</span>);
});
</code></pre>
<p>On peut ainsi gérer facilement le chargement de l&#39;image, ainsi que son
emplacement. J&#39;utilise ici deux handlers distincts pour m&#39;assurer qu&#39;enquire
fait bien son boulot au chargement aussi, dans tous les cas (les callbacks
<code>unmatch</code> ne sont appelés qu&#39;au redimensionnement, semble-t-il : avec un seul
handler, l&#39;image n&#39;arrive donc jamais si on charge la page avec un écran d&#39;une
largeur inférieure à 768px).</p>
<h2 id="that-s-all-you-ve-got-bitch-">That&#39;s all you&#39;ve got, bitch?</h2>
<p>On peut également, puisque tu y tiens tant, évoquer d&#39;autres solutions plus
marginales mais qui méritent d&#39;être citées.</p>
<h3 id="foundation">Foundation</h3>
<p><a href="http://foundation.zurb.com/">Foundation</a> propose, dans sa version 5 (et
peut-être même avant, j&#39;ai pas vérifié) un peu de sucre syntaxique HTML
permettant de switcher (via JS, œuf corse) simplement entre différents contenus
pour l&#39;élément sur lequel on l&#39;utilise.</p>
<p>C&#39;est pas mal. Ça donne ça (tiré de <a href="http://foundation.zurb.com/docs/components/interchange.html">la doc</a>) :</p>
<blockquote>
<p>We use the data-interchange attribute on a markup container (probably a div)
to do this. Here&#39;s an example which loads up a small, static map on mobile, a
larger static map for medium-sized devices, and a full interactive Google map
on large display devices.</p>
</blockquote>
<pre><code class="lang-html">&lt;<span class="hljs-keyword">div</span> data-interchange=<span class="hljs-string">"[../examples/interchange/default.html, (small)],
                       [../examples/interchange/medium.html, (medium)],
                       [../examples/interchange/large.html, (large)]"</span>&gt;
  &lt;<span class="hljs-keyword">div</span> data-alert <span class="hljs-type">class</span>=<span class="hljs-string">"alert-box secondary radius"</span>&gt;
    This <span class="hljs-keyword">is</span> <span class="hljs-keyword">the</span> default content.
    &lt;a href=<span class="hljs-string">"#"</span> <span class="hljs-type">class</span>=<span class="hljs-string">"close"</span>&gt;&amp;<span class="hljs-keyword">times</span>;&lt;/a&gt;
  &lt;/<span class="hljs-keyword">div</span>&gt;
&lt;/<span class="hljs-keyword">div</span>&gt;
</code></pre>
<p><code>small</code>, <code>medium</code> et <code>large</code> étant des raccourcis pour des media queries données
(c&#39;est dans <a href="http://foundation.zurb.com/docs/components/interchange.html">la doc</a>,
toujours. J&#39;insiste.)</p>
<h3 id="flexbox-pas-toi-david-">Flexbox (pas toi, David)</h3>
<p>On peut également, comme l&#39;a très justement souligné <a href="/#crew">lionelB</a>, se
pencher (mais pas trop) sur le cas de Flexbox, qui est un nouveau type de
positionnement introduit en CSS3. La <a href="http://caniuse.com/#search=flexbox">compatibilité</a>
n&#39;est pas encore au top (surtout grâce à IE, qui l&#39;eût cru) mais autant se tenir
prêts ! Pour ceux qui ont dormi, en gros, tu définis un conteneur :</p>
<pre><code class="lang-css"><span class="hljs-class">.flex-container</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> flex</span></span>;

  <span class="hljs-comment">/* ou bien */</span>

  <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> inline-flex</span></span>;
<span class="hljs-rule">}</span></span>
</code></pre>
<p>...et tu donnes des numéros à ses enfants, comme à Bangkok :</p>
<pre><code class="lang-css"><span class="hljs-class">.title</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.content</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">2</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-class">.image</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">3</span></span></span>;
<span class="hljs-rule">}</span></span>

<span class="hljs-comment">/*
Bien sûr, tu as été assez malin pour mettre ton image en dernier dans le DOM...
...n'est-ce pas ?
*/</span>

<span class="hljs-at_rule">@<span class="hljs-keyword">media</span> screen and (min-width: <span class="hljs-number">768</span>px) </span>{
  <span class="hljs-class">.content</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">3</span></span></span>;
  <span class="hljs-rule">}</span></span>

  <span class="hljs-class">.image</span> <span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">order</span>:<span class="hljs-value"> <span class="hljs-number">2</span></span></span>;
  <span class="hljs-rule">}</span></span>
}
</code></pre>
<p>Et voilà, pas besoin d&#39;avoir fait Pollypocket pour percevoir à quel point la
flexibilité et la propreté du code que cette technique nous permet d&#39;écrire
résolvent notre problème en deux secondes douze. Ce n&#39;est évidemment ici que la
partie émergée du flexberg ; il y a des tas de bonnes ressources qui vous
expliqueront ça en long, en large et en travers bien mieux que moi, notamment
<a href="http://www.adobe.com/devnet/html5/articles/working-with-flexbox-the-new-spec.html">cet article</a>
sur lequel j&#39;ai honteusement pompé les snippets de cette partie.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Comme tu l&#39;as vu, rien de ce que je t&#39;ai montré n&#39;est réellement satisfaisant :
pour pouvoir contrôler le positionnement d&#39;un élément dans le DOM dans le cadre
d&#39;un webdesign responsive, tu dois soit le dupliquer et jouer à cache-cache,
soit le déplacer avec JavaScript. Aussi, je serais ravi que tu partages ton
opinion, tes idées ou tes retours d&#39;XP à ce sujet. Ça me fera de la lecture pour
passer le temps, et toi tu feras quelque chose de constructif !</p>
<p>Il est temps pour moi de te laisser reprendre le cours de ta vie. Peut-être nos
routes se croiseront-elles de nouveau. Dans l&#39;intervalle, va, vis, et code !</p>

]]></description><pubDate>Thu, 26 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/html/responsive-dom/</link><guid isPermaLink="true">http://putaindecode.fr/posts/html/responsive-dom/</guid></item><item><title>Comment se passer de libraries/frameworks JavaScript</title><description><![CDATA[[
<p><strong> Petite note préalable </strong> : Évidemment que ça ne marche pas sous les vieux navigateurs, cet article s&#39;adresse principalement à toi pour te faire comprendre comment les choses marchent.</p>
<p>De plus en plus, le besoin de légèreté se fait sentir sur les pages. En dépit d&#39;un web plus rapide sur desktop, on a maintenant beaucoup de devices connectés via 3G ou Edge (un petit coucou au métro parisien). Du coup, tu te rendras vite compte qu&#39;embarquer jQuery + jQuery Mobile + jQuery UI et un tas d&#39;autres plug-ins grapillés sur le web, ça commence à peser.</p>
<h2 id="pour-la-s-lection-d-lements">Pour la sélection d&#39;élements</h2>
<p>Pour remplacer ton bon vieux <code>$</code> magique, <code>document.querySelectorAll</code> semble faire l&#39;affaire. En revanche, il retourne une instance de <code>NodeList</code>, pas d&#39;<code>Array</code>, ce qui ne nous arrange pas des masses.</p>
<p>Du coup, on peut écrire une petite function toute con, qui nous retourne un <code>Array</code> et ses méthodes bien utiles.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> nativeSlice = [].slice <span class="hljs-comment">// la méthode de conversion</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$</span><span class="hljs-params">(selector)</span>{</span>
  <span class="hljs-keyword">var</span> list = document.querySelectorAll(selector)
  <span class="hljs-keyword">return</span> nativeSlice.call(list)
}
</code></pre>
<p>Alternativement, tu peux utiliser <code>Array.apply(null, list)</code> plutôt que <code>nativeSlice.call(list)</code>, si vraiment ça te fait plaisir.</p>
<p>Une troisième solution, un peu plus chiante au quotidien (et terriblement laide), c&#39;est d&#39;utiliser directement les méthodes qui t&#39;intéressent (ex. <code>[].forEach</code>) de cette façon :</p>
<pre><code class="lang-javascript">;[].<span class="hljs-keyword">forEach</span>.call(document.querySelectorAll(selector), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span>{</span>
  <span class="hljs-comment">// do something w/ element</span>
})
</code></pre>
<p>Pour en revenir à notre petite méthode <code>$</code>, on peut du coup faire :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// prends bien l'habitude de garder</span>
<span class="hljs-comment">// tes nodeLists si tu les réutilises</span>

<span class="hljs-keyword">var</span> elements = $(<span class="hljs-string">".my-elements-className"</span>)

elements.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span>{</span>
  <span class="hljs-comment">// do something w/ element</span>
})
</code></pre>
<h3 id="pour-l-event-delegation">Pour l&#39;event delegation</h3>
<p>L&#39;event delegation, c&#39;est bien, mangez-en. Ça permet entre autres de ne pas attacher 150 listeners uniques à 150 elements différents, mais à attacher un seul listener sur un parent commun, et analyser les sources des évenements à l&#39;intérieur en se basant sur le bubbling (remontée d&#39;évenement de la source au plus haut parent) ou capturing (descente d&#39;évenement du plus haut parent à la source, avant même que la source ne le reçoive).</p>
<p>Pour faire de la délégation, on va procéder en trois temps :</p>
<ul>
<li>Choper <code>event.target</code></li>
<li>Vérifier que le sélecteur qui nous intéresse correspond bien à <code>event.target</code> ou un de ses parents (dans le cas où l&#39;on clique sur le <code>.icon-Arrow</code> dans <code>.js-Button-action</code>)</li>
<li>Si ça match, on garde l&#39;élement correspondant au sélecteur, sinon, exit</li>
</ul>
<p>Les browsers relativement récents possèdent une méthode : <code>matchesSelector</code> (et tous ses alias préfixés). Ce qu&#39;on peut donc faire, c&#39;est ceci :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> docEl = document.documentElement
    <span class="hljs-comment">// si c'est dans docEl, c'est que c'est dispo</span>
  , nativeMatchesSelector =
      docEl.matchesSelector ||
      docEl.webkitMatchesSelector ||
      docEl.mozMatchesSelector ||
      docEl.oMatchesSelector ||
      docEl.msMatchesSelector
  , matchesSelector = nativeMatchesSelector || matchesPolyfill

<span class="hljs-comment">// le polyfill utilise querySelectorAll</span>
<span class="hljs-comment">// et cherche dans le parent de l'élement</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matchesPolyfill</span><span class="hljs-params">(selector)</span>{</span>
  <span class="hljs-keyword">var</span> node = this
    , <span class="hljs-keyword">parent</span> = node.parentNode
    , query, index, length
  <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">parent</span> || <span class="hljs-keyword">parent</span>.nodeType != <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
  }
  query = <span class="hljs-keyword">parent</span>.querySelectorAll(selector)
  index = -<span class="hljs-number">1</span>
  length = query.length
  <span class="hljs-keyword">while</span>(++index &lt; length) {
    <span class="hljs-keyword">if</span>(query[index] == node) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentTarget</span><span class="hljs-params">(node, selector)</span>{</span>
  <span class="hljs-keyword">if</span>(matchesSelector.call(node, selector)) <span class="hljs-keyword">return</span> node
  <span class="hljs-keyword">while</span>(node = node.parentNode) {
    <span class="hljs-keyword">if</span>(node.nodeType != <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
    <span class="hljs-keyword">if</span>(matchesSelector.call(node, selector)) <span class="hljs-keyword">return</span> node
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
}
</code></pre>
<p>Dès lors, dans nos listeners, on pourra directement procéder ainsi :</p>
<pre><code class="lang-javascript">element.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
  <span class="hljs-keyword">var</span> currentTarget = getCurrentTarget(evt.target, <span class="hljs-string">".Button-action"</span>)
  <span class="hljs-keyword">if</span>(!currentTarget) <span class="hljs-keyword">return</span>
  <span class="hljs-comment">// all good with currentTarget</span>
})
</code></pre>
<h3 id="pour-l-ajax">Pour l&#39;Ajax</h3>
<p>Pourquoi est-ce que l&#39;on appelle ça encore Ajax, d&#39;ailleurs ? Bref.</p>
<p>Simple comme bonjour :</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSuccessStatus</span><span class="hljs-params">(status)</span>{</span>
  <span class="hljs-keyword">return</span> status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span> || status == <span class="hljs-number">304</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ajax</span><span class="hljs-params">(options)</span>{</span>
  <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()
    , done = <span class="hljs-literal">false</span>
    , async = options.hasOwnProperty(<span class="hljs-string">"async"</span>) ? options.async : <span class="hljs-literal">true</span>

  xhr.open(options.method || <span class="hljs-string">"GET"</span>, options.url, async)

  xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-keyword">if</span>(done) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.readyState != <span class="hljs-number">4</span>) <span class="hljs-keyword">return</span>
    done = <span class="hljs-literal">true</span>

    <span class="hljs-keyword">if</span>(isSuccessStatus(<span class="hljs-keyword">this</span>.status)) {
      <span class="hljs-keyword">if</span>(options.success) {
        options.success.call(<span class="hljs-keyword">this</span>)
      }
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span>(options.error) {
      options.error.call(<span class="hljs-keyword">this</span>)
    }
  }
  <span class="hljs-built_in">Object</span>.keys(options.headers || {})
    .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
      xhr.setRequestHeader(key, options.headers[key])
    })
  xhr.send(options.data || <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">return</span> xhr
}
</code></pre>
<p>Cette fonction offre un support basique de XHR :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> myXHR = ajax({
    url : <span class="hljs-string">"api/users"</span>
  , success : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      doStuff(<span class="hljs-keyword">this</span>.responseText)
    }
  , error : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      showError(<span class="hljs-keyword">this</span>.status)
    }
})
</code></pre>
<h3 id="es5-magic">ES5 magic</h3>
<p>EcmaScript 5 délivre des petites méthodes très intéressantes pour se simplifier la vie, fortement inspirées par ce qu&#39;on a l&#39;habitude de trouver dans les bibliothèques ayant connu l&#39;âge d&#39;or, comme <a href="http://prototypejs.org">PrototypeJS</a> ou <a href="http://mootools.net">MooTools</a>.</p>
<p>Dès lors, plutôt qu&#39;un ennuyeux :</p>
<pre><code class="lang-javascript">var key, <span class="hljs-keyword">item</span>
<span class="hljs-keyword">for</span>(key <span class="hljs-operator">in</span> myObject) {
  <span class="hljs-keyword">if</span>(myObject.hasOwnProperty(key)) {
    <span class="hljs-keyword">item</span> = myObject[key]
   <span class="hljs-comment"> // do something</span>
  }
}
</code></pre>
<p>on peut se contenter d&#39;un :</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">Object</span>.keys(myObject)
  .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
    <span class="hljs-keyword">var</span> item = myObject[i]
    <span class="hljs-comment">// do something</span>
  })
</code></pre>
<p>De même, on bénéficie de méthodes s&#39;avérant très utiles, comme
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/prototype"><code>Array.prototype.map</code>, <code>Array.prototype.reduce</code>, <code>Array.prototype.filter</code></a>,
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object"><code>Object.create</code>, <code>Object.getPrototypeOf</code>, <code>Object.getOwnPropertyNames</code>, <code>Object.defineProperty</code></a>
dont je t&#39;invite, si cela t&#39;intéresse, à te renseigner sur ces méthodes.
Et si tu veux avoir plus de détails, read the fucking manual :
<a href="http://es5.github.io">http://es5.github.io</a>.</p>
<h3 id="des-petits-d-tails-cools-du-c-t-des-events">Des petits détails cools du côté des events</h3>
<p>Avec <code>addEventListener</code>, on peut aussi passer un objet comme listener, avec <code>handleEvent</code> pour interface :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> myElementClickEvents = {
    element : myElement
  , callbacks : []
  , handleEvent : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
      <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = this
      this.callbacks.<span class="hljs-keyword">forEach</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(item)</span>{</span>
        item.call(<span class="hljs-keyword">self</span>.element, evt)
      })
    }
}
myElement.addEventListener(<span class="hljs-string">"click"</span>, myElementClickEvents)

myElementClickEvents.callbacks.push(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span>{</span>
  console.log(evt)
})
</code></pre>
<p>Avec ça, on peut facilement garder une trace de ce qu&#39;on passé comme listeners.</p>
<h3 id="du-type-checking-">Du type checking ?</h3>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> getClass = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span>{</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(o) }
  , someString = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">"foo"</span>)

<span class="hljs-keyword">typeof</span> someString <span class="hljs-comment">// "object"</span>
getClass(someString) <span class="hljs-comment">// "[object String]", sounds more reasonable</span>
</code></pre>
<h3 id="petit-bonus">Petit bonus</h3>
<p>Un petit bonus rien que pour toi : pour avoir une syntaxe plus sympathique et plus claire que les prototypes.</p>
<p>En principe, on fait comme ça :</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Animal</span><span class="hljs-params">(name)</span>{</span>
  <span class="hljs-keyword">this</span>.name = name
}

Animal.prototype.getName = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Cat</span><span class="hljs-params">(name)</span>{</span>
  Animal.call(<span class="hljs-keyword">this</span>, name)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">K</span><span class="hljs-params">()</span>{</span>}
K.prototype = Animal.prototype

Cat.prototype = <span class="hljs-keyword">new</span> K
Cat.prototype.constructor = Cat
Cat.prototype.type = <span class="hljs-string">"cat"</span>

<span class="hljs-keyword">var</span> myAnimal = <span class="hljs-keyword">new</span> Animal(<span class="hljs-string">"Foo"</span>)
  , myCat = <span class="hljs-keyword">new</span> Cat(<span class="hljs-string">"Bar"</span>)

myCat <span class="hljs-keyword">instanceof</span> Cat <span class="hljs-comment">// true</span>
myCat <span class="hljs-keyword">instanceof</span> Animal <span class="hljs-comment">// true</span>
</code></pre>
<p>Maintenant, à l&#39;aide de deux petites méthodes :</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// wow</span>
<span class="hljs-comment">//         many magic</span>
<span class="hljs-comment">//   very es5</span>
<span class="hljs-comment">//            wow</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extend</span><span class="hljs-params">(object)</span>{</span>
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Object.create(this)
  <span class="hljs-keyword">if</span>(!object) <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
  Object.keys(object)
    .<span class="hljs-keyword">forEach</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
      <span class="hljs-keyword">self</span>[key] = object[key]
    })
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Object.create(this)
  <span class="hljs-keyword">if</span>(typeof <span class="hljs-keyword">self</span>.constructor == <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">self</span>.constructor.apply(<span class="hljs-keyword">self</span>, arguments)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
}

<span class="hljs-keyword">var</span> klass = {
    create : create
  , extend : extend
}
</code></pre>
<p>Tu peux faire ça :</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> animal = klass.extend({
    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span>{</span>
      <span class="hljs-keyword">this</span>.name = name
    }
  , getName : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name
    }
})

<span class="hljs-keyword">var</span> cat = animal.extend({
    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span>{</span>
      animal.constructor.call(<span class="hljs-keyword">this</span>, name)
    }
  , type : <span class="hljs-string">"cat"</span>
})

<span class="hljs-keyword">var</span> myAnimal = animal.create(<span class="hljs-string">"Foo"</span>)
  , myCat = cat.create(<span class="hljs-string">"Bar"</span>)

cat.isPrototypeOf(myCat) <span class="hljs-comment">// true</span>
animal.isPrototypeOf(myCat) <span class="hljs-comment">// true</span>
</code></pre>
<p>Voilà, j&#39;espère que cela a pu attiser ta curiosité d&#39;en apprendre plus sur le langage lui-même et le DOM.</p>

]]></description><pubDate>Fri, 06 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/comment-se-passer-de-libraries-frameworks-javascript/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/comment-se-passer-de-libraries-frameworks-javascript/</guid></item><item><title>ExternalInterface.call() de Flash (et Backbone), toute une histoire</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/occupyflash.png" alt=""></figure>

<p>Je voulais vous parler d&#39;un bug qui m&#39;a bien emmerdé récemment et comme j&#39;aimerais que vous ne perdiez pas de temps avec cela, un article s&#39;imposait.</p>
<p><em>Note de la direction : j&#39;y connais rien en Flash (et je ne crois pas avoir trop envie de connaître en fait).</em></p>
<p>Dans la boite où je travaille, nous utilisons Flash en tant que lecteur vidéo étant donné qu&#39;il est pour le moment très difficile de faire lire sur toutes les plateformes des vidéos au format <em>H.264</em> et/ou passant par du <em>HLS</em>. Longue histoire qui fera office d&#39;un autre article. (Je dis ça à chaque fois, haha).</p>
<h2 id="le-pitch">Le pitch</h2>
<p>Avec notre <em>flasheur</em> attitré, nous nous sommes mis en tête de créer un objet <em>event</em> qui permettrait au Flash de déclencher des évènements lorsqu&#39;il le souhaite afin de communiquer avec l&#39;application JavaScript et que celui-ci fasse en conséquence. Cet objet, nous l&#39;avons appelé <code>App.FlashManager</code> et plus précisemment <code>App.FlashManager.Events</code> dans le cas des évènements. Nous utilisons <strong>Backbone.js</strong> pour gérer ce principe d&#39;évènement mais vous en avez d&#39;<a href="http://microjs.com/#event">autres</a> de disponible. En pratique, voilà ce que ça donne :</p>
<pre><code class="lang-javascript"> // on crée un objet vide
App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

// on lui ajoute les fonctionnalités des events Backbone
_<span class="hljs-preprocessor">.extend</span>(App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span>, Backbone<span class="hljs-preprocessor">.Events</span>)
</code></pre>
<p>En soi, pas de souci, tout se passe bien à ce moment, nous avons un <a href="http://backbonejs.org/#Events">objet d&#39;évènement façon Backbone</a>. Il pourra alors s&#39;écouter lui-même, écouter un autre objet, mais aussi déclencher des évènements.</p>
<h2 id="c-t-flash">Côté Flash</h2>
<p>La base est en place, maintenant on souhaite que le Flash déclenche un évènement. On passe par l&#39;objet <code>ExternalInterface</code> :</p>
<pre><code class="lang-javascript">ExternalInterface<span class="hljs-preprocessor">.call</span>(<span class="hljs-string">"window.App.FlashManager.Events.trigger"</span>, <span class="hljs-string">"my-event"</span>)
// http://help<span class="hljs-preprocessor">.adobe</span><span class="hljs-preprocessor">.com</span>/en_US/FlashPlatform/reference/actionscript/<span class="hljs-number">3</span>/flash/external/ExternalInterface<span class="hljs-preprocessor">.html</span><span class="hljs-preprocessor">#call</span>
</code></pre>
<p>Et là, bug.</p>
<h2 id="pourquoi-bug-">Pourquoi bug ?</h2>
<p>Pour le moment, je ne sais pas vraiment. Je me pencherai plus sur le sujet dès que j&#39;ai un peu de temps, mais ce que je sais, c&#39;est que <code>ExtercalInterface.call()</code> ne s&#39;attend pas à recevoir ce que <strong>Backbone.js</strong> lui propose. Lorsque vous faites <code>.trigger()</code>, <strong>Backbone.js</strong> renvoie l&#39;<a href="https://github.com/jashkenas/backbone/blob/master/backbone.js#L144-L153">objet en cours</a>, ce qui provoque un énooooorme bug dans le plugin Flash de votre navigateur.</p>
<h2 id="la-solution-c-t-javascript">La solution côté JavaScript</h2>
<p>Pour contrer cela, je vous propose la solution suivante qui est de ne pas utiliser directement l&#39;objet <code>Backbone.Events|View</code> mais plutôt de passer par une interface, un objet proxy.</p>
<p>Voici le schéma :</p>
<ul>
<li>Créer un objet simple qui contient les mêmes noms de méthodes que les objets évènements <strong>Backbone.js</strong> (en gros, se mapper sur l&#39;API Backbone)</li>
<li>Utiliser <strong>Backbone.js</strong> dans les méthodes de cet objet <em>Proxy</em></li>
</ul>
<p>Exemple :</p>
<pre><code class="lang-javascript">// Bridge between flash <span class="hljs-keyword">and</span> js
App<span class="hljs-preprocessor">.FlashManager</span> = {}
App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

// Backbone events used for Flash
App<span class="hljs-preprocessor">.InternalFlashManager</span> = {}
App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span> = {}

_<span class="hljs-preprocessor">.extend</span>(App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span>, Backbone<span class="hljs-preprocessor">.Events</span>)

App<span class="hljs-preprocessor">.FlashManager</span><span class="hljs-preprocessor">.Events</span><span class="hljs-preprocessor">.trigger</span> = function(name, opts) {
    App<span class="hljs-preprocessor">.InternalFlashManager</span><span class="hljs-preprocessor">.Events</span><span class="hljs-preprocessor">.trigger</span>(name, opts)

    // Must return nothing not to loop JavaScript engine, important!
    return
}
</code></pre>
<h2 id="oh-et-">Oh et...</h2>
<p>...il existe une version ayant plus ou moins le même souci que moi disponible là : <a href="https://coderwall.com/p/e-8niw">ExternalInterface#call in a deadly loop (<strong>flash</strong>toXML)</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>De manière générale (hors <strong>Backbone.js</strong>), lorsque vous utilisez <code>ExtercalInterface.call()</code>, faites en sorte que votre JavaScript retourne quelque chose de simple (un objet ayant que des atributs, pas de fonctions, ou encore un bouléen ou un <em>integer</em>).</p>

]]></description><pubDate>Thu, 05 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/externalinterface-call-flash-backbone-toute-une-histoire/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/externalinterface-call-flash-backbone-toute-une-histoire/</guid></item><item><title>De jQuery à Vanilla JS</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/jquery-die.jpg" alt=""></figure>

<p>Oui alors jQuery, c&#39;est sûrement très bien, ça simplifie pas mal de choses et le <em>chaining</em> est intéressant mais eeeest-ce que vous connaissez l&#39;équivalent en <em>pur</em> JavaScript ? Pas sûr hein.</p>
<p>Ce petit article vous propose de quoi peut-être vous faire changer d&#39;avis sur la bibliothèque qui pèse tout de même environ ~80ko.</p>
<p><em>Note : <a href="http://vanilla-js.com/">Vanilla JS</a> n&#39;est pas un framework mais veut simplement dire &quot;à nu&quot;, c&#39;est du JavaScript sans bibliothèque.</em></p>
<p>C&#39;est parti !</p>
<h2 id="table-des-mati-res">Table des matières</h2>
<ol>
<li><a href="/posts/js/de-jquery-a-vanillajs/#-v-nements">Évènements</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#s-lecteurs">Sélecteurs</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#attributs">Attributs</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#classes">Classes</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#manipulation">Manipulation</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#navigation">Navigation</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#ajax">AJAX</a></li>
<li><a href="/posts/js/de-jquery-a-vanillajs/#jsonp">JSONP</a></li>
</ol>
<h2 id="-v-nements">Évènements</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(document).ready(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
document.addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// code</span>
})
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(<span class="hljs-string">'a'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-comment">// code…</span>
})

<span class="hljs-comment">// Vanilla</span>
[].forEach.call(document.querySelectorAll(<span class="hljs-string">'a'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
  el.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">// code…</span>
  })
})
</code></pre>
<h2 id="s-lecteurs">Sélecteurs</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> divs = $(<span class="hljs-string">'div'</span>)

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> divs = document.querySelectorAll(<span class="hljs-string">'div'</span>)
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> newDiv = $(<span class="hljs-string">'&lt;div/&gt;'</span>)

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> newDiv = document.createElement(<span class="hljs-string">'div'</span>)
</code></pre>
<h2 id="attributs">Attributs</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-variable">$(</span><span class="hljs-string">'img'</span>).<span class="hljs-keyword">filter</span>(<span class="hljs-string">':first'</span>).attr(<span class="hljs-string">'alt'</span>, <span class="hljs-string">'My image'</span>)

<span class="hljs-comment">// Vanilla</span>
document.querySelector(<span class="hljs-string">'img'</span>).setAttribute(<span class="hljs-string">'alt'</span>, <span class="hljs-string">'My image'</span>)
</code></pre>
<h2 id="classes">Classes</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
newDiv.addClass(<span class="hljs-string">'foo'</span>)

<span class="hljs-comment">// Vanilla</span>
newDiv.classList.<span class="hljs-keyword">add</span>(<span class="hljs-string">'foo'</span>)
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
newDiv.toggleClass(<span class="hljs-string">'foo'</span>)

<span class="hljs-comment">// Vanilla</span>
newDiv.classList.<span class="hljs-keyword">toggle</span>(<span class="hljs-string">'foo'</span>)
</code></pre>
<h2 id="manipulation">Manipulation</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$(<span class="hljs-string">'body'</span>).append($(<span class="hljs-string">'&lt;p/&gt;'</span>))

<span class="hljs-comment">// Vanilla</span>
document.body.appendChild(document.createElement(<span class="hljs-string">'p'</span>))
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> clonedElement = $(<span class="hljs-string">'#about'</span>).clone()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> clonedElement = document.getElementById(<span class="hljs-string">'about'</span>).cloneNode(<span class="hljs-literal">true</span>)
</code></pre>
<pre><code class="lang-javascript">// jQuery
$(<span class="hljs-string">'#wrap'</span>).<span class="hljs-constant">empty</span>()
<span class="hljs-comment">
// Vanilla</span>
var <span class="hljs-operator">wrap</span> = document.getElementById(<span class="hljs-string">'wrap'</span>)
<span class="hljs-keyword">while</span>(<span class="hljs-operator">wrap</span>.firstChild) <span class="hljs-operator">wrap</span>.removeChild(<span class="hljs-operator">wrap</span>.firstChild)
</code></pre>
<h2 id="navigation">Navigation</h2>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">parent</span> = $(<span class="hljs-string">'#about'</span>).<span class="hljs-keyword">parent</span>()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">parent</span> = document.getElementById(<span class="hljs-string">'about'</span>).parentNode
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">if</span>($(<span class="hljs-string">'#wrap'</span>).<span class="hljs-keyword">is</span>(<span class="hljs-string">':empty'</span>))

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">if</span>(!document.getElementById(<span class="hljs-string">'wrap'</span>).hasChildNodes())
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
<span class="hljs-keyword">var</span> nextElement = $(<span class="hljs-string">'#wrap'</span>).next()

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> nextElement = document.getElementById(<span class="hljs-string">'wrap'</span>).nextSibling
</code></pre>
<h2 id="ajax">AJAX</h2>
<h3 id="get">GET</h3>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.get(<span class="hljs-string">'//example.com'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> httpRequest = <span class="hljs-keyword">new</span> XMLHttpRequest()
httpRequest.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
httpRequest.open(<span class="hljs-string">'GET'</span>, url)
httpRequest.send()
</code></pre>
<h3 id="post">POST</h3>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.post(<span class="hljs-string">'//example.com'</span>, { username: username }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-keyword">var</span> httpRequest = <span class="hljs-keyword">new</span> XMLHttpRequest()
httpRequest.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
httpRequest.setRequestHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/x-www-form-urlencoded'</span>)
httpRequest.open(<span class="hljs-string">'POST'</span>, url)
httpRequest.send(<span class="hljs-string">'username='</span> + <span class="hljs-built_in">encodeURIComponent</span>(username))
</code></pre>
<h3 id="jsonp">JSONP</h3>
<pre><code class="lang-javascript"><span class="hljs-comment">// jQuery</span>
$.getJSON(<span class="hljs-string">'//openexchangerates.org/latest.json?callback=?'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
})

<span class="hljs-comment">// Vanilla</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">(data)</span> {</span>
  <span class="hljs-comment">// code</span>
}
<span class="hljs-keyword">var</span> scr = document.createElement(<span class="hljs-string">'script'</span>)
scr.src = <span class="hljs-string">'//openexchangerates.org/latest.json?callback=formatCurrency'</span>
document.body.appendChild(scr)
</code></pre>
<p>Cela vous parait-il encore difficile de vous passer de jQuery ? :)</p>
<p>Un grand merci à <a href="http://playground.deaxon.com/js/vanilla-js/">@deaxon</a> qui est à l&#39;origine de cet éclaircissement.</p>
<h2 id="a-creuser">A creuser</h2>
<p>Il existe une version minimaliste de jQuery basée sur la même API mais beaucoup plus légère s&#39;appelant <a href="http://zeptojs.com/">Zepto</a>. Il est actuellement utilisé en production sur le site mobile de ma boite.</p>

]]></description><pubDate>Thu, 05 Dec 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/de-jquery-a-vanillajs/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/de-jquery-a-vanillajs/</guid></item><item><title>Premiers pas avec Grunt</title><description><![CDATA[[
<figure class="putainde-Media putainde-Media--left"><img src="../../../images/posts/gruntjs.png" alt=""></figure>

<p>Vous avez sûrement déjà entendu parler de <strong>Grunt</strong> à droite à gauche, en conférence, voire votre boite l&#39;utilise déjà mais vous ne savez toujours pas trop ce qui se cache derrière ce terme saugrenu digne d&#39;un personnage de Warcraft. Soit, ce n&#39;est pas bien grave. <strong>Grunt</strong> est simplement un <em>JavaScript Task Runner</em>, un outil vous permettant de créer des tâches automatisées en JavaScript. Forcément ce n&#39;est pas très parlant mais c&#39;est tout l&#39;intérêt de cet article, vous expliquer ce qu&#39;est <strong>Grunt</strong> et pourquoi il peut vous être utile dans un <em>workflow</em> de front-end dev.</p>
<h1 id="commen-ons">Commençons</h1>
<p>Vous est-il déjà arrivé(e) de devoir régulièrement lancer, lancer et relancer des processus tels que <em>Sass</em>, <em>LESS</em>, <em>uglify</em> - en somme des préprocesseurs ou des minifiers - régulièrement à la main ? N&#39;est-ce pas pénible ? N&#39;est-ce pas aussi pénible de devoir indiquer à tous ses collègues comment ils doivent bosser pour que vous soyez tous cohérents ? Oui ? <strong>Grunt</strong> permet de résoudre ce genre de choses : respecter un putain de <em>workflow</em> en s&#39;assurant que le parcours soit le même pour tout le monde et d&#39;exécuter tout ça en lançant une seule commande. N&#39;est-ce pas fucking aweeeeesome dude ? Bref.</p>
<p>Voici un <em>workflow</em> assez classique :</p>
<ul>
<li>Compiler mes <code>.scss</code> en <code>.css</code>;</li>
<li>Concaténer mes <code>*.js</code> en un seul fichier;</li>
<li>Minifier (avec <em>uglify</em> par exemple) la résultante de l&#39;action précédente.</li>
</ul>
<p>Voyons maintenant comment l&#39;on peut mettre en place ceci via <strong>Grunt</strong>.</p>
<h2 id="installation">Installation</h2>
<p>Tout d&#39;abord, installons <strong>Grunt</strong>. Notez que <strong>Grunt</strong> est en <em>nodejs</em> et que je considère que vous avez déjà <em>nodejs</em> d&#39;installé. D&#39;autre part, nous allons créer un nouveau projet <strong>npm</strong> afin d&#39;enregistrer tous les packages que vous allez installer. Je vous explique par la suite pourquoi nous faisons ça.</p>
<pre><code class="lang-bash">$ npm init <span class="hljs-comment">// puis plusieurs fois entrée</span>
</code></pre>
<p>En premier lieu, il faut installer le <em>package</em> qui permet de gérer <strong>Grunt</strong> en ligne de commande. C&#39;est le <em>commander</em> de <strong>Grunt</strong> en gros.</p>
<pre><code class="lang-bash">$ npm install <span class="hljs-attribute">-g</span> grunt<span class="hljs-attribute">-cli</span>
</code></pre>
<p>Une fois cela fait, installez <strong>Grunt</strong> en local dans votre projet.</p>
<pre><code class="lang-bash"><span class="hljs-comment">$</span> <span class="hljs-comment">npm</span> <span class="hljs-comment">install</span> <span class="hljs-comment">grunt</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">save</span><span class="hljs-literal">-</span><span class="hljs-comment">dev</span>
</code></pre>
<p>Ni plus ni moins, <strong>Grunt</strong> est enfin installé dans votre projet.</p>
<h2 id="initialisation">Initialisation</h2>
<p>Maintenant, il est nécessaire de créer un fichier de configuration <strong>Grunt</strong>. Pour cela, nous allons créer un fichier nommé <code>Gruntfile.js</code> à la racine de votre projet.</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>touch <span class="hljs-constant">Gruntfile</span>.js
</code></pre>
<p>Fait ? Voici maintenant à quoi doit ressembler la base d&#39;une configuration <strong>Grunt</strong>.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  <span class="hljs-comment">// Configuration de Grunt</span>
  grunt.initConfig({})

  <span class="hljs-comment">// Définition des tâches Grunt</span>
  grunt.registerTask(<span class="hljs-string">'default'</span>, <span class="hljs-string">''</span>)

}
</code></pre>
<p>Nous avons maintenant tout le nécessaire pour débuter notre projet. Nous allons enfin pouvoir attaquer les choses sérieuses. Revenons un peu en arrière où nous expliquions que nous voulons en tout premier lieu compiler nos <code>.scss</code> en <code>.css</code>.</p>
<h2 id="cr-er-sa-premi-re-t-che">Créer sa première tâche</h2>
<p>Une petite recherche sur votre moteur de recherche préféré en tapant <code>grunt sass</code> et vous trouverez le projet <a href="https://github.com/gruntjs/grunt-contrib-sass"><code>grunt-contrib-sass</code></a>.</p>
<p>Toute documentation pour installer une tâche <strong>Grunt</strong> est indiquée sur chaque <code>README.md</code> du projet mais pour un souci de clarté et de compréhension, je vais tout de même vous expliquer ici comment faire.</p>
<p>D&#39;abord, installons le package pour <em>Sass</em>.</p>
<pre><code class="lang-bash">$ npm install grunt<span class="hljs-attribute">-contrib</span><span class="hljs-attribute">-sass</span> <span class="hljs-subst">--</span>save<span class="hljs-attribute">-dev</span>
</code></pre>
<p>Ceci va installer le <em>package</em> <code>grunt-contrib-sass</code> dans votre dossier <code>node_modules</code> où vous pourrez l&#39;utiliser en l&#39;important dans votre <code>Gruntfile.js</code>.</p>
<p>Un exemple d&#39;utilisation :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {                              <span class="hljs-comment">// Nom de la tâche</span>
      dist: {                            <span class="hljs-comment">// Nom de la sous-tâche</span>
        options: {                       <span class="hljs-comment">// Options</span>
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {                         <span class="hljs-comment">// Liste des fichiers</span>
          <span class="hljs-string">'main.css'</span>: <span class="hljs-string">'main.scss'</span>,       <span class="hljs-comment">// 'destination': 'source'</span>
          <span class="hljs-string">'widgets.css'</span>: <span class="hljs-string">'widgets.scss'</span>
        }
      }
    }
  })

  <span class="hljs-comment">// Import du package</span>
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)

  <span class="hljs-comment">// Redéfinition de la tâche `default` qui est la tâche lancée dès que vous lancez Grunt sans rien spécifier.</span>
  <span class="hljs-comment">// Note : ici, nous définissons sass comme une tâche à lancer si on lance la tâche `default`.</span>
  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Nous avons maintenant tout le nécessaire pour pouvoir compiler nos <code>.scss</code> en  <code>.css</code>.</p>
<p>Vous vous demandez peut-être comment vous pouvez généraliser vos sources plutôt que les définir une par une. Pas de souci.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: { <span class="hljs-comment">// C'est ici que l'on définit le dossier que l'on souhaite importer</span>
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<h2 id="deuxi-me-t-che-concat-ner-ses-fichiers-javascript">Deuxième tâche : concaténer ses fichiers JavaScript</h2>
<p>Passons maintenant à la concaténation des fichiers JavaScripts.</p>
<p>Comme pour la majorité des tâches que vous aurez besoin avec <strong>Grunt</strong>, un <em>package</em> <strong>Grunt</strong> existe déjà pour ce travail demandé.</p>
<p>-&gt; <a href="https://github.com/gruntjs/grunt-contrib-concat"><code>grunt-contrib-concat</code></a></p>
<p>Installation : <code>npm install grunt-contrib-concat --save-dev</code> (<code>--save-dev</code> permet de sauvegarder le package dans <code>package.json</code> pour pouvoir à tout moment le réinstaller en faisant <code>npm install</code>)</p>
<p>On ajoute alors à notre configuration <strong>Grunt</strong> l&#39;importation de <code>grunt-contrib-concat</code> :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>); <span class="hljs-comment">// Voilà l'ajout.</span>

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Puis on ajoute notre tâche :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>, <span class="hljs-comment">// permet d'ajouter un point-virgule entre chaque fichier concaténé.</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>], <span class="hljs-comment">// la source</span>
        dest: <span class="hljs-string">'dist/built.js'</span> <span class="hljs-comment">// la destination finale</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>);

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Ne pas oublier d&#39;ajouter la tâche de concaténation à notre tâche par défaut :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>, <span class="hljs-comment">// permet d'ajouter un point-virgule entre chaque fichier concaténé.</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>], <span class="hljs-comment">// la source</span>
        dest: <span class="hljs-string">'dist/built.js'</span> <span class="hljs-comment">// la destination finale</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>);
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>);

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>]) <span class="hljs-comment">// ici même.</span>
}
</code></pre>
<h2 id="compressons-le-tout-">Compressons le tout !</h2>
<p>Pour finir, compressons nos fichiers JavaScript ! Pour cela : <a href="https://github.com/gruntjs/grunt-contrib-uglify"><code>grunt-contrib-uglify</code></a> fera l&#39;affaire.</p>
<p>Je vous passe les détails pour l&#39;installer, si vous avez bien suivi cet article, vous ne devriez avoir aucun problème pour l&#39;installer.</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span></span> {

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-keyword">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
}
</code></pre>
<p>Ne constatez vous pas un souci ici ? Oui, nous ne voulons sûrement pas à la fois concaténer nos fichiers et les compresser. Alors comment faire ? Pas d&#39;inquiètude, il suffit de créer des tâches d&#39;environnement ou de contexte. On pourrait par exemple créer une tâche développement et une tâche de production, qu&#39;en pensez-vous ? Pas mal non ? :)</p>
<h2 id="optimisons-">Optimisons !</h2>
<p>Supprimons alors dans un premier temps notre tâche par défaut et créons deux tâches : <code>dev</code> et <code>dist</code>.</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span></span> {

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-keyword">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [])
}
</code></pre>
<p>Sauf que comme ça, vous le voyez, cela ne va pas faire grand chose, voire rien du tout. Agrémentons alors nos deux tâches par ce qu&#39;on souhaite faire.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(grunt)</span> {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        files: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>]) <span class="hljs-comment">// C'est pas chouette ça ?</span>
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>]) <span class="hljs-comment">// Et hop, je compresse si je lance $ grunt dist</span>
}
</code></pre>
<p>Ha ! Nous y voilà ! Nous avons alors deux tâches <code>grunt dev</code> et <code>grunt dist</code> qui nous permettent dans tous les cas de générer nos css et dans un cas concaténer nos js, dans l&#39;autre les compresser (la compression fait aussi la concaténation implicitement).</p>
<p>Sauf que comme tout bon(ne) développeur/euse, vous êtes une grosse feignasse et compiler à chaque fois que vous faites des modifications sur vos fichiers va vite être saoulant.</p>
<p>Pour cela, une tâche existe, elle s&#39;appelle <code>watch</code> (via le package <a href="https://github.com/gruntjs/grunt-contrib-watch/"><code>grunt-contrib-watch</code></a>).</p>
<h2 id="regarde-ce-fichier-que-je-ne-euh-bref-">Regarde ce fichier que je ne... euh bref.</h2>
<p>Très simple, <code>watch</code> va vous permettre de &quot;regarder&quot; vos fichiers, savoir lesquels ont changé et donc lancer une action en fonction du type de fichiers.</p>
<p>Imaginons que l&#39;on veut par exemple compiler nos css à chaque fois que l&#39;on change un fichier <em>Sass</em>. Ou encore que l&#39;on concatène nos fichiers JavaScript dès que l&#39;on touche à l&#39;un d&#39;entre eux.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,<span class="hljs-comment"> // tous les fichiers JavaScript de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'concat:dist'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,<span class="hljs-comment"> // tous les fichiers Sass de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'sass:dist'</span>]
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>])
}
</code></pre>
<p>Maintenant, vous êtes capable à tout moment de compiler automatiquement vos fichiers en lançant simplement <code>$ grunt watch</code>.</p>
<p>Oui, comprenez bien que lorsque vous ajoutez une tâche dans la définition de la configuration de <strong>Grunt</strong>, elle est appelable directement. Typiquement, vous pouvez faire <code>$ grunt premier-niveau:deuxieme-niveau</code> soit par exemple <code>$ grunt sass:dist</code>. Vous n&#39;êtes pas obligé(e) de (re)définir chaque tâche via <code>grunt.registerTask()</code>.</p>
<p>Je ne sais pas si vous vous rappelez mais nous avions crée une tâche de base s&#39;appelant <code>default</code>. Cette tâche se lance dès que vous ne passez aucun paramètre à <strong>Grunt</strong> soit <code>$ grunt</code>. Vous pouvez aussi l&#39;appeler via <code>$ grunt default</code> mais aucun intérêt.</p>
<p>Tout ça pour dire qu&#39;il est serait sûrement intéressant de lancer la tâche <code>watch</code> dès qu&#39;on souhaite lancer <strong>Grunt</strong> étant donné que c&#39;est sûrement la tâche la plus récurrente que vous utiliserez.</p>
<p>C&#39;est parti !</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      }
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>],
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      dist: {
        src: [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
        dest: <span class="hljs-string">'dist/built.js'</span>
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,<span class="hljs-comment"> // tous les fichiers JavaScript de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'concat:dist'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,<span class="hljs-comment"> // tous les fichiers Sass de n'importe quel dossier</span>
        tasks: [<span class="hljs-string">'sass:dist'</span>]
      }
    }
  })

  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'dev'</span>, <span class="hljs-string">'watch'</span>])<span class="hljs-comment"> // Oui, je conseille de toujours compiler une fois avant de lancer watch.</span>
  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'concat:dist'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'sass:dist'</span>, <span class="hljs-string">'uglify:dist'</span>])
}
</code></pre>
<p>That&#39;s it. Nous avons maintenant tout le nécessaire pour compiler des css, du js, l&#39;optimiser, ainsi qu&#39;avoir une commande de développement avec compilation automatique.</p>
<p>Et puisque je suis maniaque, nous allons ranger un peu :</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">grunt</span>) {</span>

 <span class="hljs-comment"> // Je préfère définir mes imports tout en haut</span>
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-sass'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-concat'</span>)
  grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-watch'</span>)

  var jsSrc = [<span class="hljs-string">'src/intro.js'</span>, <span class="hljs-string">'src/project.js'</span>, <span class="hljs-string">'src/outro.js'</span>]
    , jsDist = <span class="hljs-string">'dist/built.js'</span>

 <span class="hljs-comment"> // Configuration de Grunt</span>
  grunt.initConfig({
    sass: {
      dist: {
        options: {
          style: <span class="hljs-string">'expanded'</span>
        },
        <span class="hljs-built_in">files</span>: {
          <span class="hljs-string">"expand"</span>: <span class="hljs-constant">true</span>,
          <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"src/styles/"</span>,
          <span class="hljs-string">"src"</span>: [<span class="hljs-string">"*.scss"</span>],
          <span class="hljs-string">"dest"</span>: <span class="hljs-string">"dist/styles/"</span>,
          <span class="hljs-string">"ext"</span>: <span class="hljs-string">".css"</span>
        }
      },
      dev: {}<span class="hljs-comment"> // A vous de le faire ! vous verrez que certaines options Sass sont plus intéressantes en mode dev que d'autres.</span>
    },
    concat: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      compile: {<span class="hljs-comment"> // On renomme vu qu'on a pas de mode dev/dist. Dist étant une autre tâche : uglify</span>
        src: jsSrc,<span class="hljs-comment"> // Vu qu'on doit l'utiliser deux fois, autant en faire une variable.</span>
        dest: jsDist<span class="hljs-comment"> // Il existe des hacks plus intéressants mais ce n'est pas le sujet du post.</span>
      }
    },
    uglify: {
      options: {
        separator: <span class="hljs-string">';'</span>
      },
      compile: {
        src: jsSrc,
        dest: jsDist
      }
    },
    watch: {
      scripts: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.js'</span>,
        tasks: [<span class="hljs-string">'scripts:dev'</span>]
      },
      styles: {
        <span class="hljs-built_in">files</span>: <span class="hljs-string">'**/*.scss'</span>,
        tasks: [<span class="hljs-string">'styles:dev'</span>]
      }
    }
  })

  grunt.registerTask(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'dev'</span>, <span class="hljs-string">'watch'</span>])
  grunt.registerTask(<span class="hljs-string">'dev'</span>, [<span class="hljs-string">'styles:dev'</span>, <span class="hljs-string">'scripts:dev'</span>])
  grunt.registerTask(<span class="hljs-string">'dist'</span>, [<span class="hljs-string">'styles:dist'</span>, <span class="hljs-string">'scripts:dist'</span>])

 <span class="hljs-comment"> // J'aime bien avoir des noms génériques</span>
  grunt.registerTask(<span class="hljs-string">'scripts:dev'</span>, [<span class="hljs-string">'concat:compile'</span>])
  grunt.registerTask(<span class="hljs-string">'scripts:dist'</span>, [<span class="hljs-string">'uglify:compile'</span>])

  grunt.registerTask(<span class="hljs-string">'styles:dev'</span>, [<span class="hljs-string">'sass:dev'</span>])
  grunt.registerTask(<span class="hljs-string">'styles:dist'</span>, [<span class="hljs-string">'sass:dist'</span>])
}
</code></pre>
<p>Avec ça, je pense qu&#39;on est pas trop mal. Il reste des optimisations éventuelles à faire et nombreuses autres tâches intéressantes peuvent être ajoutées comme <a href="https://github.com/gruntjs/grunt-contrib-jshint/">jshint</a>. Cela fera probablement office d&#39;un autre article.</p>
<p>J&#39;espère que vous y voyez maintenant un peu plus clair dans <strong>Grunt</strong> ainsi que dans la compilation côté front-end. <strong>Grunt</strong> est un excellent produit, avec une communauté réactive et il est rare qu&#39;une tâche que vous souhaitiez mettre en place n&#39;existe pas.</p>
<p>Bon workflow !</p>

]]></description><pubDate>Sat, 16 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/js/premiers-pas-avec-grunt/</link><guid isPermaLink="true">http://putaindecode.fr/posts/js/premiers-pas-avec-grunt/</guid></item><item><title>Structurer son projet avec Revel et Mgo</title><description><![CDATA[[
<p>Tu te sens l’âme d’un rebelle ? Tu veux tester de la techno atypique ? Ça tombe
bien, aujourd’hui on est là pour ça. On va toucher à un sujet pas forcément
majoritaire : le langage Go. Si tu ne connais pas les bases, je t’invite à aller
sur la <a href="http://golang.org/">homepage du projet</a> et à parcourir le
<a href="http://tour.golang.org/">go-tour anglais</a> ou
<a href="http://go-tour-fr.appspot.com/">celui en français</a>, c&#39;est un showcase complet du langage
(et très bien fichu).
Mais si t&#39;es juste curieux et que comprendre chaque pixel de l&#39;article n&#39;est pas
une obsession pour toi, tu devrais pouvoir voir de quoi on parle. Même
<a href="/#crew">Nyalab</a> y est arrivé.</p>
<p>Dans cet article on va voir <strong>comment brancher un projet go+revel à une base de
données mongodb</strong> et obtenir ainsi une base de travail sympa pour explorer le
développement web avec Go.</p>
<h2 id="les-technos-utilis-es">Les technos utilisées</h2>
<h3 id="-golang-http-golang-org-"><a href="http://golang.org">Golang</a></h3>
<p>Langage compilé, publié en 2009, communément considéré comme “désorienté objet”,
c’est une alternative solide au C/C++ qui prône un découpage modulaire (par
“package”) des applications. Il est prédisposé à une utilisation en
développement web grâce à un package natif de gestion des réseaux et du
protocole http.</p>
<h3 id="-revel-http-robfig-github-io-revel-"><a href="http://robfig.github.io/revel/">Revel</a></h3>
<p>Framework développé en Go et pour Go. Il intègre tout ce qu’il faut pour
développer une application web : rechargement du code à chaud, gestion des urls
par routing, parsing des paramètres GET et POST, mécanisme de validation des
données, gestion de sessions, gestion du cache, framework de tests et même
moteur de tâches planifiées cron-likes. Il a pour particularité d’être
complètement découplé sur la partie modèle et ne fourni aucun ORM ou ODM,
juste un petit module pour gérer des transactions sur des bases sql-like.</p>
<h3 id="-mgo-http-labix-org-mgo-"><a href="http://labix.org/mgo">Mgo</a></h3>
<p>Driver Go complet pour MongoDB, permettant d’établir la connexion et d’envoyer
des requêtes. Il dispose d’un mécanisme de mapping des documents mongodb sur les
type struct de Go.</p>
<h3 id="-mongodb-http-www-mongodb-org-"><a href="http://www.mongodb.org/">MongoDB</a></h3>
<p>Base de données NoSql agile et scalable, les documents sont stockés au format
json dans des collections. Le requêtage se fait en manipulant des objets et des
fonctions javascript.</p>
<h2 id="attends-attends-pourquoi-go-">Attends, attends ... Pourquoi Go ?</h2>
<p>Le premier vrai argument, c&#39;est la <strong>performance</strong>. Sans rentrer dans
l&#39;explication hyper poussée d&#39;un <a href="http://jaxbot.me/articles/benchmarks_nodejs_vs_go_vs_php_3_14_2013">benchmark</a>, on peut
affirmer sans trop de risque que Go se hisse au moins au niveau de node.js. On
va pas risquer de vexer les autres membres du crew avec des affirmations
trollesques dès le premier post.</p>
<p>On peut aussi ajouter que Go est un <strong>langage moderne</strong>, qui inclut toutes les
<strong>petites friandises pour attirer le développeur</strong> curieux et assoiffé de
qualité. Framework de tests et outil de mise en forme du code sont natifs et
permettent à la techno d&#39;échapper aux interminables guerres de conventions :</p>
<blockquote>
<p>De toutes façons le no-newline avant &quot;{&quot; c&#39;est vraiment pour les pourritures
responsables de 99% des maux de la Terre.</p>
<ul>
<li><cite>Un évangeliste du PSR</cite></li>
</ul>
</blockquote>
<p>Troisième argument de choix en Go : la <strong>simplicité de parallélisation</strong>.
Personne ne viendra te dire <em>&quot;ça c&#39;est synchrone, sry bro.&quot;</em> ou <em>&quot;ça c&#39;est
asynchrone, callback it bitch.&quot;</em>. Tout repose sur le mot clef qui a donné son
nom au langage (ou l&#39;inverse) <code>go</code>. Tu peux te faire un <code>go myFunc()</code> et paf !
Tout ce qui est appelé dans myFunc() saute sur un thread séparé. Et pour gérer
la synchronicité entre plusieurs thread il y a un mécanisme de canaux. Ce sont
des files FIFO (the First In is the First Out) dont la lecture est bloquante
(il existe des techniques évoluées pour faire du polling, cf
<a href="http://tour.golang.org/#68">gotour#68</a>).</p>
<p>Pour finir, cerise sur le gateau, <strong>Go compile vite</strong>, extrêment vite, et ça va
sauver ton intégrité mentale sur les gros projets. Par contre c&#39;est foutu pour
tes pauses cafés aux prétextes douteux.</p>
<h2 id="let-s-go-nojoke-siriouz-bizness-">Let’s Go (#nojoke, siriouz bizness)</h2>
<p>On va partir du principe que tu as Go et Revel prêts pour la baston. On attaque
direct à sec par le classique “revel new” puisqu&#39;on va partir de la structure de
base.</p>
<pre><code class="lang-shell">$ revel <span class="hljs-keyword">new</span> github.com/OwlyCode/PutainDeProjet
</code></pre>
<p>Là théoriquement, tu te retrouves avec la structure par défaut du boilerplate
revel, quelque chose comme ça:</p>
<ul>
<li>app<ul>
<li>controllers</li>
<li>views</li>
</ul>
</li>
<li>conf</li>
<li>messages</li>
<li>public</li>
<li>tests</li>
</ul>
<p>C’est là qu’on se met au boulot. On a de quoi faire un site complet avec ça mais
 aucune trace de gestion de base de données là dedans. On commence donc par
 créer un dossier <code>app/modules</code> et un sous dossier <code>app/modules/mongo</code>. C’est
 dans ce dossier que va se trouver notre gestionnaire de connexion à mongoDB.
 En fait ce n’est rien de plus qu’un binding entre Revel et Mgo. La technique
 utilisée pour brancher ce binding côté Revel est celle des
 <a href="http://robfig.github.io/revel/manual/interceptors.html">interceptors</a>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> mongo

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/robfig/revel"</span>
    <span class="hljs-string">"labix.org/v2/mgo"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-comment">// Extension du controlleur.</span>
<span class="hljs-keyword">type</span> Mongo <span class="hljs-keyword">struct</span> {
    *revel.Controller
    MongoSession  *mgo.Session
    MongoDatabase *mgo.Database
}

<span class="hljs-comment">// Stockage global de la session dont la visibilité est restreinte au package.</span>
<span class="hljs-keyword">var</span> session *mgo.Session

<span class="hljs-comment">// Singleton</span>
<span class="hljs-keyword">var</span> dial sync.Once

<span class="hljs-comment">// Renvoie la session mgo en cours, si aucune n'existe, elle est créée.</span>
<span class="hljs-keyword">func</span> GetSession() *mgo.Session {

    host, _ := revel.Config.String(<span class="hljs-string">"mongo.host"</span>)

    <span class="hljs-comment">// Grâce au package sync cette fonction n'est appelée</span>
    <span class="hljs-comment">// qu'une seule fois et de manière synchrone.</span>
    dial.Do(<span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">var</span> err error
        session, err = mgo.Dial(host)
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
    })

    <span class="hljs-keyword">return</span> session
}

<span class="hljs-comment">// Alimente les propriétés affectées au controlleur en clonant la session mongo.</span>
<span class="hljs-keyword">func</span> (c *Mongo) Bind() revel.Result {
    <span class="hljs-comment">// Oublie pas de mettre mongo.database dans le app.conf, genre "localhost"</span>
    databaseName, _ := revel.Config.String(<span class="hljs-string">"mongo.database"</span>)

    c.MongoSession = GetSession().Clone()
    c.MongoDatabase = c.MongoSession.DB(databaseName)

    <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>
}

<span class="hljs-comment">// Ferme un clone</span>
<span class="hljs-keyword">func</span> (c *Mongo) Close() revel.Result {

    <span class="hljs-keyword">if</span> c.MongoSession != <span class="hljs-constant">nil</span> {
        c.MongoSession.Close()
    }

    <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>
}

<span class="hljs-comment">// Fonction appelée au chargement de l'application.</span>
<span class="hljs-comment">// Elle effectue un appel a notre fonction Bind avant</span>
<span class="hljs-comment">// chaque execution du controlleur.</span>
<span class="hljs-keyword">func</span> init() {
    revel.InterceptMethod((*Mongo).Bind, revel.BEFORE)
    revel.InterceptMethod((*Mongo).Close, revel.AFTER)
    <span class="hljs-comment">// On veut aussi fermer le clone si le controlleur plante.</span>
    revel.InterceptMethod((*Mongo).Close, revel.PANIC)
}
</code></pre>
<p>On a créé notre connexion à mongo, mais maintenant on va aussi l’utiliser. Dans
le contrôleur, rien de plus simple :</p>
<pre><code class="lang-go">import (
    <span class="hljs-string">"github.com/robfig/revel"</span>
    <span class="hljs-string">"github.com/OwlyCode/PutainDeProjet/app/modules/mongo"</span>
)

type AppController struct {
    *revel.Controller
    mongo.Mongo // Le controlleur doit étendre notre type Mongo.
}

func (c *AppController) Index() revel.Result {
    usersCollection := c.MongoDatabase.C(<span class="hljs-string">"users"</span>)
    // tu peux maintenant manipuler ta mgo.Collection.
    // [ <span class="hljs-keyword">...</span> ]
}
</code></pre>
<p>Mais tu peux aussi l’appeler ailleurs dans le projet, par exemple dans un autre
module :</p>
<pre><code class="lang-go">import (
    <span class="hljs-string">"github.com/OwlyCode/PutainDeProjet/app/modules/mongo"</span>
)

func DoStuff(user *models.User) {
    session := mongo.GetSession()
    defer session.Close() // Oublie pas de fermer le robinet à la fin!

    // tu peux maintenant manipuler ta mgo.Session.
    // [ <span class="hljs-keyword">...</span> ]
}
</code></pre>
<p><strong>C&#39;est bien beau de copier coller mais ...</strong></p>
<p>... tu te demandes certainement pourquoi on a créé un dossier <code>app/modules</code>, si
c’est pour n’y mettre qu’un sous dossier mongo dedans. Et c’est une très bonne
question. En fait, notre dossier mongo représente un module du projet bien
délimité. A l’avenir, si tu veux aussi brancher du mysql, et bien y a juste à
créer <code>app/modules/mysql</code>. Rien ne change pour l’existant et tu ne pollues pas
la racine de ton projet. L’autre avantage c’est qu’en un coup d’oeil dans ce
dossier tu as un aperçu direct des features de l’application.</p>
<p>Enfin, l&#39;approche module, c&#39;est aussi un gage de MVC. Admettons qu&#39;on veuille
coder une application de facturation, il nous suffit de créer un dossier
<code>app/modules/invoicing</code> et de travailler dans ce dossier sur toute la partie
métier. Comme par exemple le calcul des totaux, le calcul de la TVA etc... Grâce
 à cette approche, on garde des contrôleurs très fins et restreints à ce que
 doit être leur rôle premier : faire communiquer le modèle et la vue.</p>
<h2 id="mod-les-globaux-mod-les-locaux">Modèles globaux, modèles locaux</h2>
<p>J’ai évoqué plus haut dans la liste des technos une feature hyper sexy de mgo :
le mapping des documents mongodb en json sur les types struct. Ce qui veut dire
qu’avec mgo, on peut définir des modèles bien structurés. Certains seront
communs à toute l’application, par exemple un utilisateur, mais d’autres seront
spécifiques à un module, comme par exemple une facture.</p>
<p>Une bonne pratique est d’approcher le rangement des modèles selon cette
structure:</p>
<ul>
<li>app<ul>
<li>controllers</li>
<li><strong>models</strong></li>
<li>modules<ul>
<li>invoicing<ul>
<li>engine</li>
<li><strong>models</strong></li>
</ul>
</li>
<li>mongo</li>
</ul>
</li>
<li>views</li>
</ul>
</li>
<li>conf</li>
<li>messages</li>
<li>public</li>
<li>tests</li>
</ul>
<p>Le but du jeu évidemment c&#39;est d&#39;avoir le moins de modèles globaux possibles.
Idéalement, si le dossier <code>app/models</code> n&#39;existe pas ce n&#39;est pas plus mal. Mais
attention à ne pas chercher à l&#39;éliminer au prix de la modularité du code. Il
vaut mieux avoir un modèle explicitement déclaré comme global plutot que de
l&#39;isoler dans un module et de rendre tous les autres modules du projet
dépendants de ce dernier.</p>
<p>Pourquoi c&#39;est important ? C&#39;est surtout parce que ça pose les bonnes questions
et amène les bonnes remarques. &quot;Vais-je avoir besoin de ce modèle réellement
PARTOUT ?&quot;, &quot;C&#39;est étrange j&#39;ai créé deux modules mais au final je passe mon
temps à faire des va-et-vient de l&#39;un à l&#39;autre... Peut être que je devrais les
fusionner.&quot; ou encore &quot;90% de mon projet se trouve dans un seul module, il y a
peut être un problème.&quot;. Mais au delà de ça, ça te permets d&#39;isoler des modules
quasi autonomes (deux ou trois coups d&#39;abstraction avec des interfaces et ça
roule). Tu pourras plus tard les sortir de ton projet si par exemple tu veux les
réutiliser sur un autre (svn include pour les ancêtres, git submodules pour les
autres).</p>
<h2 id="pour-aller-plus-loin">Pour aller plus loin</h2>
<p>Isoler distinctement le gestionnaire de connexion, la logique métier et les
modèles dans des modules est une première étape vers une architecture propre et
évolutive. Tu peux même pousser ça plus loin en utilisant des interfaces comme
je l&#39;ai brièvement mentionné un peu plus tôt, c&#39;est même d&#39;ailleurs ce que je te
conseille. Si tu veux creuser ce sujet là tu trouveras pas mal de monde qui s&#39;y
intéresse en fouinant sur le
<a href="https://groups.google.com/forum/#!forum/Golang-Nuts">groupe de discussion des utilisateurs golang</a>.
Tu as par exemple ce gars là qui a
<a href="https://groups.google.com/forum/#!searchin/Golang-Nuts/interface/golang-nuts/Q0WhF7vhw5Q/T1tSJHT4aCoJ">remplacé sa dépendance à la librairie mgo par des interfaces</a>
pour éviter d&#39;inclure le package a chaque fois et faciliter ses tests. Tu peux
envisager de faire la même chose pour découpler tes modèles et la logique métier
.</p>
<p>En attendant il ne me reste qu&#39;à te souhaiter une bonne coding night, tu as
toutes les armes nécessaires pour gérer mongo dans ton projet revel. ;-)</p>

]]></description><pubDate>Mon, 11 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/backend/golang-structurer-revel-et-mgo/</link><guid isPermaLink="true">http://putaindecode.fr/posts/backend/golang-structurer-revel-et-mgo/</guid></item><item><title>Vagrant, enlarge your VM</title><description><![CDATA[[
<p>Vagrant, au cas où tu ne connaîtrais pas encore, permet de fournir des
environnements de développements reproductibles, facilement configurables et
qui se partagent entre les membres de l’équipe. En gros, tu vas pouvoir décrire
et configurer des machines virtuelles (VM) depuis un seul fichier texte,
le <code>Vagrantfile</code>.  Plutôt pratique pour avoir un environnement de dev
équivalent à celui de la prod. Et tout cela avec un processus simplifié
à l&#39;extrême.</p>
<h1 id="et-c-est-pour-qui-le-beau-joujou-">Et c’est pour qui le beau joujou ?</h1>
<p>Vagrant s’adresse principalement à toi, mais aussi à un public
de <strong>développeurs</strong> qui souhaitent pouvoir mettre en place rapidement
un environnement de dev avec une machine virtuelle (genre apache-php-<em>sql)
sans y passer trop de temps.
Vagrant, c’est aussi pour des <em>*devops</em></em> qui voudraient tester la mise en
place et le provisioning de leur infra.
Dans la doc, ils disent même que ça s’adresse aux designers
(pour dire si c’est simple) mais faut pas déconner non plus,
on a jamais vu un designer dégainer une console :)</p>
<p>Globalement le workflow vagrant se résume à 2-3 commandes,</p>
<ol>
<li><code>vagrant init</code> au début du projet
Puis</li>
<li><code>vagrant up</code> pour lancer la VM.</li>
<li><code>vagrant halt</code>pour l’arrêter.</li>
</ol>
<h1 id="etape-1-vagrant-init">Etape 1 - vagrant init</h1>
<p>Vagrant fournit un support pour les principales plateformes de virtualisation,
appelées Provider dans la langue de Justin Bieber et avec par défaut celui
pour virtualbox.  Et  cerise sur le clafoutis, tu as aussi la possibilité
de configurer / provisionner tes box avec des scripts Chef ou Puppet
(ou juste un script shell si t’es old-school \o/ ).</p>
<p>Bon, je suppose que c’est encore un peu flou, alors voilà comme ça se présente.
Une fois installé ( <a href="http://downloads.vagrantup.com/">http://downloads.vagrantup.com/</a> ), tu devrais avoir
une nouvelle commande de dispo.
Alors dégaine ton terminal et envoie un <code>vagrant init</code>. Ça devrait créer
un fichier <code>Vagrantfile</code>  qui va décrire ta machine virtuelle
(ne t’inquiète pas, c’est juste écrit en Ruby).
En gros de quelle box de base tu pars, comment tu la configures (réseaux,
dossier partagé entre la VM et le Host, ta machine réelle) et comment tu
la provisionnes (via un shell, avec un script Puppet...)</p>
<h2 id="la-config-de-la-box">La config de la box</h2>
<p>Ensuite voilà les quelques points à paramétrer.</p>
<ul>
<li><code>config.vm.box = &quot;base&quot;</code>pour spécifier le nom d’une box préalablement
téléchargée.</li>
<li><code>config.vm.box_url = &quot;http://domain.com/path/to/above.box&quot;</code> Tu remplaces
par l’url de la box de tes rêves. Tu peux trouver une liste assez complètes
de box plus ou moins configurées sur le site <a href="http://www.vagrantbox.es/">http://www.vagrantbox.es/</a>
( ProTip™: Choisis bien le provider correspondant à ton gestionnaire de VM)</li>
<li><code>config.vm.network :forwarded_port, guest: 80, host: 8080</code> Pratique
pour accéder au serveur qui tourne sur la VM. Après tu retrouves un peu
les mêmes options de config réseaux qu’avec virtualbox
(réseaux privés, connexion par pont...)</li>
<li><code># config.vm.synced_folder &quot;../data&quot;, &quot;/vagrant_data&quot;</code> Avec ça,
tu vas pouvoir ajouter un répertoire qui sera partagé
avec ta machine virtuelle.
Par défaut, Vagrant te permet d’accéder au répertoire courant
depuis <code>/home/vagrant</code> dans la VM.</li>
</ul>
<h2 id="le-provisioning-de-box">le provisioning de box</h2>
<p>Alors attention, c&#39;est un des trucs cools avec vagrant. Avant, quand tu
voulais te monter une VM pour travailler, il fallait aussi la configurer,
installer les bonnes versions de chaque brique que le projet utilisé. Ça‎
pouvait être long, pénible, et surtout prendre du temps.
Avec Vagrant, tu peux automatiser cette partie, soit en utilisant simplement
un script, soit avec un moyen moderne comme Chef ou Puppet. Et si jamais t&#39;as
besoin d&#39;un truc particulier, une config que tu utilises souvent, tu peux
toujours packager la box que t&#39;as configuré avec amour pour pouvoir la
réutiliser dès que l&#39;occasion se présente. Sinon tu peux déjà trouver pas mal
de box déjà prêtes à l&#39;emploi, avec ou sans support pour puppet, chef...</p>
<p>La suite du fichier contient des exemples de type de provisioning
(Puppet, Chef solo ou Chef server)
Et si jamais tu souhaites lancer un script de provisioning :</p>
<pre><code class="lang-ruby">Vagrant.configure(<span class="hljs-string">"2"</span>) <span class="hljs-built_in">do</span> |config|
  config.vm.provision <span class="hljs-string">"shell"</span>, path: <span class="hljs-string">"provision.sh"</span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
</code></pre>
<blockquote>
<p>Vagrant te permet aussi de créer tes propres box déjà provisionnées via
la commande vagrant package. C’est assez pratique quand tu dois
télécharger-compiler-installer tout l’internet</p>
</blockquote>
<h1 id="etape-2-vagrant-up">Etape 2 - vagrant up</h1>
<p>Bon, la première fois risque de prendre du temps, parce que vagrant
va télécharger ta box, puis lancer le provisioning. Profites-en pour faire
un tour sur <a href="http://vim-adventures.com/">http://vim-adventures.com/</a> et jouer un peu en attendant.</p>
<p>Une fois terminé, tu as maintenant une box dispo avec laquelle travailler.</p>
<h1 id="etape-3-joie-o-">Etape 3 - Joie \o/.</h1>
<p>Je pensais faire une troisième partie sur comment arrêter la VM mais
ça présente pas vraiment d’intérêt car ça tient en une ligne de commande.</p>
<p>Bref, le point important de tout ça, c’est que les autres relous de ton équipe
ne pourront plus dire que pourtant ça marche bien chez eux, et qu’ils
comprennent pas, c’est vraiment étrange... enfin sauf s&#39;ils sont
de mauvaise foi :)</p>
<ul>
<li>L’intégrateur n’aura plus à se taper 14 installations de trucs en
ligne de commande qu’il ne retient jamais, pour rajouter un bout de css
ou de js.
(ProTip™: là, ça rentre sur un post-it !)</li>
<li>Le dev backend n’aura plus à pleurer quand on lui demande de remettre le nez
dans une projet vieux de 2 ans avec que des versions de php / ruby ou mysql
dépassées qui vont casser la superbe config qu’il a mis 1 semaine à fignoler
avec les dernières techno à la mode.</li>
<li>l’admin sys pourra packager les box de chaque projets, provisionnées
et configurées et pour éviter d’avoir à configurer les postes des autres
dev à chaque changement de projet.</li>
</ul>
<h1 id="quelques-commande-pratiques">Quelques commande pratiques</h1>
<blockquote>
<p><code>vagrant ssh</code> te permet de te connecter en mode terminal
<code>vagrant status</code> pour les têtes <del>à claques</del> en l’air</p>
</blockquote>
<h1 id="quelques-liens">Quelques liens</h1>
<ul>
<li><a href="http://docs.vagrantup.com/v2/">la documentation officielle de <del>viagra</del> vagrant</a></li>
<li><a href="https://github.com/putaindecode/propositions-de-posts/issues/4">Virtualisation sur OSx et accès à localhost</a></li>
<li><a href="http://jolicode.com/blog/cuisinez-vos-serveurs-comme-un-chef-premiere-partie">Cuisinez vos serveurs comme un Chef – Première partie</a></li>
</ul>

]]></description><pubDate>Fri, 08 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/env/vagrant-enlarge-your-vm/</link><guid isPermaLink="true">http://putaindecode.fr/posts/env/vagrant-enlarge-your-vm/</guid></item><item><title>HTML ? Hâche-Thé-Aime-Elle vous dites ?</title><description><![CDATA[[
<p>Ahh, le HTML. LE <a href="http://fr.wikipedia.org/wiki/HTML">H.T.M.L</a>. Sacré langage hein ?</p>
<p>On le connait tous ce fameux truc qu&#39;on retrouve dans pas mal d&#39;URLs : <code>.html</code>.
Oui d&#39;accord par le passé on avait l&#39;extension de radin <code>.htm</code>, mais elle n&#39;a
clairement pas duré.</p>
<p>Vous vous demandez déjà ce qu&#39;il-y-a à raconter sur l&#39;HTML peut être ? Et bien,
je ne suis pas là pour vous apprendre toutes les balises, leurs enfants, parents,
les cousins cousines, patati patata… Ah ça non, j&#39;ai autre chose à faire,
et vous aussi. Et si c&#39;est ce que vous cherchez, vous trouverez ce qu&#39;il vous
faut sur <a href="http://docs.webplatform.org/wiki/html/elements">tout</a>
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element">un</a>
<a href="http://www.w3.org/html/wg/drafts/html/CR/dom.html#elements">tas</a>
<a href="http://en.wikipedia.org/wiki/HTML_element">d&#39;autres</a>
<a href="http://www.vectorskin.com/referentiels-standards-w3c/balises-html5/">sites</a>.</p>
<p>Ce que je vais faire par contre, c&#39;est tenter de partager un document sérieux
(dans le fond hein) avec tout pleins de conseils super pertinents pour que vous
écriviez de l&#39;HTML comme personne.
Non je déconne. En fait, ça va être la grosse marrade avec les trucs
les plus nazes que je peux vous raconter. C&#39;est parti mon jQuéri.</p>
<h2 id="l-ancien-testament">L&#39;ancien testament</h2>
<p>Si vous avez ouvert ne serait-ce que quelques documents HTML dans votre vie,
vous avez du croiser ce qu&#39;on appelle un <a href="http://fr.wikipedia.org/wiki/Doctype">doctype</a>
qui ressemble à ça:</p>
<pre><code class="lang-html"><span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
</code></pre>
<p>Vous pourrez remarquer dans ce <del>petit</del> gros bout de code bien relou qu&#39;il y&#39;a
une <a href="http://fr.wikipedia.org/wiki/Uniform_Resource_Locator">URL</a>:
c&#39;est tout simplement la DTD (doctype) du langage en question.
Avec les spécifications pour la validation, toussa toussa…
Si vous avez 2 minutes, allez jeter un coup d&#39;oeil.</p>
<p>Je ne vais pas vous le cacher, et même si en théorie, par héritage de SGML/XML
ça part d&#39;une bonne intention, dans la pratique ça sert juste à se toucher la
nouille sur la validation.
Car aujourd&#39;hui HTML (5) n&#39;est clairement plus du XML.</p>
<p>Oui bon ok, moi même à une époque j&#39;ai eu ma passe où je collais ce petit badge
partout dans mes footers:</p>
<figure>
  <a href="http://validator.w3.org/check?uri=referer">
    <img src="http://www.w3.org/Icons/valid-xhtml10"
        alt="Valid XHTML 1.0 Transitional" height="31" width="88" />
  </a>
  <figcaption>Ça pète la classe hein ?</figcaption>
</figure>

<p>Mais bon les conneries, ça va un moment.
Pour info, j&#39;ai du valider le code suivant pour obtenir ce logo:</p>
<pre><code class="lang-html"><span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>Ben dites donc, c&#39;est propre tout ça. Un petit document tout vide mais déjà
bien rempli.
Mais attendez en 2013, on peut pas faire mieux ? Oh si !</p>
<h2 id="le-nouveau-testament">Le nouveau testament</h2>
<pre><code class="lang-html"><span class="hljs-doctype">&lt;!doctype html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
</code></pre>
<p>Il faut savoir qu&#39;un simple document <em>valide</em>, peut se résumer à ça.
Oui oui mes cocos, ce document est parfaitement valide. Voilà j&#39;voulais vous le
dire. Arrêtez d&#39;utiliser des doctypes dans tous les sens, ça ne sert à rien.
Sachant la qualité du code qu&#39;on trouve sur les internets, les navigateurs
s&#39;arrêtent au parsing lorsqu&#39;ils voient ça <code>&lt;!doctype html</code>
(C&#39;est <a href="http://paulrouget.com/">Paul Rouget</a> qui me l&#39;a dit, je le crois donc
sur parole).
Et après ma petite parenthèse ci dessous, je vais vous expliquer pourquoi.</p>
<p>Car je sais ce que certains vont me rétorquer.</p>
<blockquote>
<p>Oui mais moi monsieur, je valide en <strong>XHTML 1.1 Strict Turbo X Prime Ultra</strong><br />
Puis ton document valide là, il sera valide quand HTML5 sera finalisé…</p>
</blockquote>
<p>Dans un sens ils n&#39;auraient pas tort. Mais dans la pratique, les navigateurs
s&#39;en contre branlent de savoir quel type d&#39;HTML vous utilisez
<small>(à moins que vous aimiez jouer avec la mort et que vous utilisez le
prologue XML lorsque vous servez de l&#39;XHTML…)</small>.
Car quand bien même vous utilisez un doctype à rallonge, il est tout à fait
possible que vous vous chiiez, et que vous laissiez des erreurs.
Oui, l&#39;erreur est humaine…
Puis HTML 5 est déjà bien implémenté dans les grandes lignes. Et ça car il est
presque rétrocompatible.
Vous devriez le comprendre d&#39;ici la fin de cet écrit. Ou pas. Mais je vous le
dit, il a été pensé dans ce sens.</p>
<p>Revenons à la validation. Du coup à quoi ça sert de valider ?
On va voir ça par un exemple digne des plus grands diplômes.</p>
<h2 id="ce-p-fout-la-merde-">Ce <code>&lt;p&gt;</code> fout la merde.</h2>
<p>Prenons le code suivant:</p>
<pre><code class="lang-html"><span class="xml"><span class="vbscript"></span></span><span class="hljs-expression">{{<span class="hljs-variable">include</span> <span class="hljs-string">"src/posts/html/hache-the-aime-elle-vous-dites/notvalid.html.hbs"</span>}}</span><span class="xml"><span class="vbscript"></span></span>
</code></pre>
<p>Certains d&#39;entre vous ont du remarquer la coquille.
Celle-là, mes élèves qui découvrent le HTML me la font à chaque fois lorsqu&#39;ils
codent leur super CV
(super exercice tavu, ils apprécient particulièrement le titre).</p>
<p>Toi là au fond, t&#39;as pas repéré le souci encore ?</p>
<p>Regarde plutôt le rendu:</p>
<iframe
  class="putainde-Post-iframe"
  height="350"
  src="/posts/html/hache-the-aime-elle-vous-dites/notvalid.html">
</iframe>

<blockquote>
<p>WAT ?
ET MON MARGIN BOTTOM KESSIFÉLÀ EN DEUBEULE ?</p>
</blockquote>
<p>Le rapport avec la validation me direz-vous ? Et bien plutôt que de perdre du
temps à comprendre le pourquoi du comment, en validant le code ci dessus,
l&#39;erreur vous est implicitement expliquée
(oui ce code n&#39;a qu&#39;une seule erreur à la validation).</p>
<blockquote>
<p>Line 17, Column 4: <strong>No p element in scope but a p end tag seen.</strong></p>
</blockquote>
<p>Typiquement, il faut savoir comprendre un message d&#39;erreur et savoir lire entre
les lignes. Pas faire &quot;mais monsieur, j&#39;comprends pas là&quot; (d&#39;ailleurs mes élèves
valident tous leur code, pour apprendre sur le tas, c&#39;est une bonne façon).</p>
<p>Celui là nous dit en gros : <em>je ne vois pas d&#39;element <strong>p</strong> à fermer dans le coin</em>.
Ca veut dire que… Ça veut dire que mon <strong>p</strong> ouvert n&#39;est pas reconnu ?
Mais attend qu&#39;est-ce que c&#39;est que cette histoire ?!</p>
<p>Si vous prenez 10 secondes pour inspecter ce code, vous allez vite vous
aperçevoir qu&#39;il est parsé ainsi:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>…<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">ul</span>&gt;</span>…<span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
</code></pre>
<p><em>Mais qu&#39;est-ce que… ? Hein ? Mais ? Quoi ? Comment ?</em></p>
<p>Oui vous avez bien vu. L&#39;HTML est parsé n&#39;importe comment. Enfin non il est parsé
comme il peut, au mieux.
Je pense que là vous commencez à comprendre ?</p>
<p>Ce que j&#39;essaye de vous montrer par là, ce qu&#39;il faut toujours faire attention
entre ce qu&#39;on écrit et ce qu&#39;on pense avoir comme résultat, même avec du
<em>simple</em> HTML.</p>
<p><strong>Bon après j&#39;espère qu&#39;en 2013, vous avez tous le réflexe d&#39;inspecter
l&#39;HTML dès que vous avez un truc bizarre en CSS ou en JavaScript… Si
c&#39;est pas encore le cas, prenez l&#39;habitude.</strong></p>
<h2 id="mais-du-coup-le-navigateur-il-fait-n-importe-quoi-">Mais du coup le navigateur il fait n&#39;importe quoi ?</h2>
<p>Le navigateur essaye clairement de faire au mieux.
Si vous inspectez l&#39;exemple précédent, vous vous apercevrez aussi que je n&#39;ai
mis aucune balise <code>&lt;html&gt;</code>, <code>&lt;head&gt;</code> ou <code>&lt;body&gt;</code>.
Pourquoi ? Ben car le parseur le fait à ma place.
Mais pourquoi il fait ça ?
Tout simplement car on oublie (très - trop ?) souvent de bien écrire.
Comme quand j&#39;écris en.</p>
<p>La balise <a href="https://developer.mozilla.org/fr/docs/Web/HTML/Element/tbody"><code>&lt;tbody&gt;</code></a>
est un bon exemple.
Si vous inspectez vos tableaux HTML, vous verrez vite fait que cette balise, que
quasiment personne ne connait/utilise, est pourtant nécessaire/utile.
Mais du coup, si je me fais une petite requête JavaScript
<code>document.querySelectorAll(&#39;table &gt; tr&#39;)</code>,
il est fort possible que je n&#39;aie pas ce que je souhaite.
<a href="http://codepen.io/MoOx/pen/esFjx">La preuve</a>.</p>
<p>Voyons une autre exemple: mettons nous à la place d&#39;un navigateur si,
alors que je suis en XHTML 1.1 Strict, je lui glisse une balise <code>&lt;center&gt;</code>.</p>
<ul>
<li><p><strong>Cas 1.</strong> Je n&#39;ai pas fait attention au doctype et je veux vraiment une balise
<code>&lt;center&gt;</code> : bah là, rien à dire à part <em>Merci</em>. Le navigateur essaye clairement
de faire au mieux, et dans un cas comme celui là, on ne peut que le remercier.</p>
</li>
<li><p><strong>Cas 2.</strong> Je sais exactement dans quel doctype je suis, j&#39;ai conscience de ce
que je fais: je joue au con, tant pis pour ma gueule !</p>
</li>
</ul>
<p>Dans tous les cas, le navigateur va laisser passer cette balise au cas où que.
Puis bon faut avouer que c&#39;est super pratique cette balise hein ?
Comme <code>&lt;blink&gt;</code> et <code>&lt;marquee&gt;</code> quoi. ❤</p>
<figure>
  <img src="../../../images/posts/memes/canthandlemyswag.gif" alt="Can&#39;t handle my swag">
  <figcaption><marquee>Marquee for the win.</marquee></figcaption>
</figure>

<h2 id="note-de-service">Note de service</h2>
<p>S&#39;il vous plaît mesdames messieurs, lorsque vous faites du CSS inline, ou que
vous incorporez un JavaScript, arrêtez vous à des choses simples,
qui fonctionnent :</p>
<ul>
<li><p><code>&lt;style&gt;</code> suffit. Pas besoin de mettre un type, un langage etc. Et ça vous
évitera des <a href="http://codepen.io/MoOx/pen/sEzuJ">prises de têtes à la con</a>.
Puis vous avez déjà utilisé autre chose que du CSS vous ?!</p>
</li>
<li><p><code>&lt;script&gt;</code>, idem, même sur IE 6.
Pareil que précédement, pas besoin de mettre un hideux
<code>&lt;script type=&quot;text/javascript&quot; language=&quot;JavaScript 1.1&quot;&gt;</code>.
La moindre faute de frappe ne pardonne pas.
Aucun intêret de se fatiguer, sauf si votre <a href="https://code.google.com/p/ruby-in-browser/">script n&#39;est pas du JavaScript</a>.</p>
</li>
</ul>
<h2 id="le-mot-de-la-fin">Le mot de la fin</h2>
<p>Ne soyez jamais sûr de vous, que ce soit pour écrire de l&#39;HTML ou faire une mise
en prod&#39; un vendredi soir à <a href="http://www.miximum.fr/le-bug-de-17h30.html">17h30</a>.
Faites pas les malins. Ne sous-estimez pas HTML.
Si ça merde quelque part, vérifiez plus loin que le bout de votre nez, que votre
règle CSS qui marche pas, ou votre morceau de JavaScript buggé.</p>
<h2 id="-aller-plus-loiiin-allez-plus-haaauuut-https-www-youtube-com-watch-v-bcylqudsn5g-t-39s-"><a href="https://www.youtube.com/watch?v=BCYLQUdsN5g&amp;t=39s">Aller plus loiiin, allez plus haaauuut… !</a></h2>
<ul>
<li><a href="https://github.com/necolas/idiomatic-html" lang="en">idiomatic-html</a>
(<a href="http://fr.wikipedia.org/wiki/Idiomatique">ceci n&#39;est pas une contraction d&#39;<em>idiot</em> et d&#39;<em>automatique</em></a>).</li>
<li><a href="https://github.com/necolas/idiomatic-css" lang="en">idiomatic-css</a> (traduction incluse)</li>
<li>Validation automatique dans un workflow Grunt:<ul>
<li><a href="https://github.com/praveenvijayan/grunt-html-validation">praveenvijayan/grunt-html-validation</a></li>
<li><a href="https://github.com/jzaefferer/grunt-html">jzaefferer/grunt-html</a> (basé sur validator.nu)</li>
</ul>
</li>
</ul>

]]></description><pubDate>Thu, 07 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/html/hache-the-aime-elle-vous-dites/</link><guid isPermaLink="true">http://putaindecode.fr/posts/html/hache-the-aime-elle-vous-dites/</guid></item><item><title>Versionner avec Git</title><description><![CDATA[[
<p>Chez Putain de Code, on aime se servir de <a href="http://git-scm.com/">Git</a> (et de GitHub, mais
c&#39;est une autre histoire), même si certains d&#39;entre nous (comme Lionel) ne s&#39;en
servent pas forcément bien.</p>
<p>Pour éviter ce genre de mésaventures, on s&#39;est dit qu&#39;on allait consacrer une
série d&#39;articles à ce merveilleux gestionnaire de versions, et de vous en faire
profiter par la même occasion.</p>
<p>Et si Git permet de faire à peu près ce qu&#39;on veut sur un dépôt, vous verrez
qu&#39;on peut assez facilement réparer ses erreurs (et même celles des autres
parfois !).</p>
<h2 id="c-est-quoi-git-">C&#39;est quoi Git ?</h2>
<p>Si vous êtes un développeur un tant soit peu consciencieux, vous utilisez un
gestionnaire de versions pour suivre l&#39;évolution de votre code. Non,
<a href="http://roland.entierement.nu/blog/2008/01/22/cpold-la-poudre-verte-du-suivi-de-versions.html">CPOLD</a> n&#39;est pas un gestionnaire de versions.</p>
<p>Git, c&#39;est un gestionnaire de versions décentralisé, aussi connu sous le terme
de DVCS (pour Distributed Version Control System) pour les amateurs.</p>
<p>Le terme <em>distribué</em> est très important car c&#39;est ce qui le différencie d&#39;autres
gestionnaires historiquement plus connus comme Subversion (SVN) ou le vénérable
CVS.</p>
<p>Ça veut dire que chaque développeur possède sa propre copie du dépôt, chez lui,
localement, contraîrement à un gestionnaire centralisé ou tout est… centralisé
sur un même serveur (merci Captain Obvious).</p>
<p>Git est principalement utilisable en ligne de commande, mais il existe des
interfaces graphiques sous les principaux OS du marché (OS X, Linux, Windows).
Ici on va traiter de la ligne de commande, car c&#39;est l&#39;arme de base du bon
développeur.</p>
<p>Je vous passe l&#39;installation, référez-vous à la documentation officielle pour
cette partie. (Ça se résume souvent à un <code>nom-du-package-manager install git</code>)</p>
<h2 id="comment-a-marche-">Comment ça marche ?</h2>
<p>Avant d&#39;attaquer la partie pratique, on va s&#39;attarder un peu à comment Git
fonctionne, parce qu&#39;à mon sens c&#39;est essentiel pour comprendre rapidement ce
qu&#39;il est possible de faire et pour se construire un modèle mental des
opérations.</p>
<p>Dans Git les commits sont tous reliés avec leur(s) parent(s) comme les maillons
d&#39;une chaîne qui pourrait avoir des bifurcations. Chaque commit stocke des
informations sur l&#39;état du dépôt à un instant donné (l&#39;état complet, pas
uniquement un diff).</p>
<p>On construit cette chaîne et ses bifurcations en créant des commits, en
branchant et en fusionant une branche dans une autre.</p>
<p>Enfin, une dernière chose que vous devez garder en tête c&#39;est qu&#39;un commit est
définitif dans le sens ou on ne pourra jamais modifier son contenu (on pourra
par contre le remplacer par un autre). Comme il est unique, il a un numéro qui
est un haché <code>SHA1</code> de diverses informations.</p>
<p>Ces <code>SHA1</code> sont utilisé à foison, habituez-y vous !</p>
<p>Voilà, maintenant sortons nous les doigts et regardons comment ça marche
concrètement.</p>
<h2 id="cr-er-ou-r-cup-rer-un-repo">Créer ou récupérer un repo</h2>
<p>Il y a deux manières de créer un dépôt Git : soit on en veut un tout neuf et on
utilise <code>git init</code>, soit on veut cloner un dépôt déjà existant et on utilise le
bien nommé <code>git clone</code>.</p>
<p>Appellé sans argument, <code>git init</code> initialise un dépôt dans le dossier courant,
on peut lui passer un nom de dépôt en argument pour le créer dans un
sous-dossier spécifique du dossier courant.</p>
<p>Du côté de <code>git clone</code>, on va passer l&#39;adresse d&#39;un dépôt, et optionnellement un
nom local pour le dépôt. Il va récupérer le dépôt à l&#39;adresse spécifiée (c&#39;est
bien foutu hein ?) puis le mettre soit dans un dossier du même nom soit dans un
dossier du nom spécifié en dernier argument.</p>
<p>Par exemple, si je veux cloner le dépôt du site :</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git clone <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/putaindecode</span><span class="hljs-regexp">/website.git</span>
</code></pre>
<p>Ça va créer un dossier <code>website</code> avec le contenu du dépôt.</p>
<p><code>clone</code> accepte plusieurs types d&#39;adresse : HTTP(S), SSH, protocole Git dédié et
même des chemins locaux pour cloner un dépôt situé ailleurs sur le système de
fichiers.</p>
<p>Pour la suite, il va falloir se placer dans un dépôt avec le petit <code>cd</code> qui va
bien pour lancer les vraies commandes intéressantes de Git.</p>
<h2 id="premiers-commits">Premiers commits</h2>
<p>Pour commencer à s&#39;amuser, écrivez un bout de code dans un fichier et
sauvegardez le :</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>cat &gt; putain_de_hello_world.rb
puts <span class="hljs-string">"Hello, putain de codeur !"</span>
^<span class="hljs-constant">D</span>
</code></pre>
<p>On va tout se suite introduire l&#39;un des concepts déroutants de Git, <em>l&#39;Index</em>.
Git utilise trois zones distinctes pour les fichiers : le dossier de travail
(<em>Working Dir</em>) qui contient les fichiers dans leur version actuelle, <em>l&#39;Index</em>
qui permet de stocker les modifications et <code>HEAD</code> qui pointe vers le dernier
commit.</p>
<p>L&#39;idée, c&#39;est qu&#39;on peut modifier les fichiers comme on le souhaite, et
constuire le commit avec seulement les modifications que l&#39;on souhaite voir
apparaître.</p>
<p>Cette possibilité permet d&#39;avoir des commits atomiques, c&#39;est à dire qui
introduisent une modification simple. Ça évite de se retrouver avec un commit
mammouth qui change tout le programme d&#39;un coup et qui est un enfer pour le
futur développeur qui revient sur le code et qui cherche à comprendre la logique
de sa construction. Ce développeur, c&#39;est vous dans 1 ou 2 semaines.</p>
<p>Pour info, vous verrez parfois <em>l&#39;Index</em> appellé <em>Staging Area</em>, ou encore
<em>Cache</em>.</p>
<p>Git fournit des commandes pour passer les fichiers d&#39;un état à l&#39;autre. Elles
sont certes parfois un peu obscures, mais dans l&#39;ensemble c&#39;est pas si
difficile.</p>
<p>Dans notre cas, notre fichier n&#39;est même pas encore suivi par Git ! Vous pouvez
vérifier ça en utilisant <code>git status</code>, dont vous ne pourrez bientôt plus vous
passer :</p>
<pre><code class="lang-bash">$ git status
<span class="hljs-preprocessor"># Sur la branche master</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Validation initiale.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Fichiers non suivis:</span>
<span class="hljs-preprocessor">#   (utilisez "git add &lt;fichier&gt;..." pour inclure dans ce qui sera validé)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor">#    putain_de_hello_world.rb</span>
Aucune modification indexée mais des fichiers non suivis sont présents (utilisez <span class="hljs-string">"git add"</span> pour les suivre)
</code></pre>
<p>Pour pallier celà, on utilise <code>git add</code> pour l&#39;ajouter direct à l&#39;index.</p>
<p>Dans notre cas, ça donne <code>git add putain_de_hello_world.rb</code></p>
<p>On peut utilise <code>git add</code> pour ajouter des dossiers entiers, des motifs, … Mais
soyez vigilants, c&#39;est une bonne source d&#39;erreurs souvent chiantes.</p>
<p>Vous pouvez vérifier que <code>git add</code> a bien marché avec la commande <code>git status</code>,</p>
<pre><code class="lang-bash">$ git status
<span class="hljs-preprocessor"># Sur la branche master</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Validation initiale.</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># Modifications qui seront validées :</span>
<span class="hljs-preprocessor">#   (utilisez "git rm --cached &lt;fichier&gt;..." pour désindexer)</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor">#    nouveau : putain_de_hello_world.rb</span>
<span class="hljs-preprocessor">#</span>
</code></pre>
<p>Ok c&#39;est prêt ! On lance maintenant <code>git commit</code> pour créer notre premier commit
(pas con le <em>naming</em> de la commande hein ?). Si tout se passe bien vous devriez
avoir un éditeur qui s&#39;ouvre pour écrire un message de commit. Prenez l&#39;habitude
de décrire votre changement sur la première ligne succintement et, si vous avez
besoin de détails, sautez une ligne et détaillez les modifications.</p>
<p>Un petit <code>git status</code> nous confirme qu&#39;on s&#39;est pas foiré (la preuve, tout est
propre) :</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git status
<span class="hljs-comment"># Sur la branche master</span>
rien à valider, la copie de travail est propre
</code></pre>
<h2 id="inspecter">Inspecter</h2>
<p>Bon, c&#39;est bien beau de commiter, mais à un moment on arrive sur un projet en
cours et on aimerait bien savoir où on en est. Pour ça vous pouvez utiliser un
outil graphique (il y en a pour <a href="https://wiki.gnome.org/Apps/Gitg">Linux</a>, <a href="http://gitx.frim.nl/">OS X</a> et même sûrement
Windows) ou retrousser vos poils de barbe et sortir le bon vieux <code>git log</code>.</p>
<p>C&#39;est un vrai couteau-suisse qui va vous permettre d&#39;inspecter tout l&#39;historique
de votre dépôt, avec des options en veux-tu en voilà pour personnaliser
l&#39;affichage.</p>
<p>Un <code>git log</code> basique ça ressemble à ça :</p>
<pre><code class="lang-bash">$ git log
<span class="hljs-operator"><span class="hljs-keyword">commit</span> <span class="hljs-number">8120</span>de7b7139e46b9cbc1c3ee89a02962dbc198e
Author: madx &lt;madx+github@yapok.org&gt;
<span class="hljs-keyword">Date</span>:   Mon Nov <span class="hljs-number">4</span> <span class="hljs-number">23</span>:<span class="hljs-number">28</span>:<span class="hljs-number">11</span> <span class="hljs-number">2013</span> +<span class="hljs-number">0100</span>

    Premier <span class="hljs-keyword">commit</span></span>
</code></pre>
<p>Oui, c&#39;est le commit que je viens de faire dans la partie précédente. Comment
j&#39;en suis sûr ? Car je peux utiliser <code>git show</code> pour afficher les détails d&#39;un
objet Git (il n&#39;y a pas que des commits, mais on verra ça une prochaine fois).</p>
<p><code>git show</code> prend en argument le fameux <code>SHA1</code> du commit :</p>
<pre><code class="lang-bash">$ git show <span class="hljs-number">8120</span>de7b7139e46b9cbc1c3ee89a02962dbc198e
commit <span class="hljs-number">8120</span>de7b7139e46b9cbc1c3ee89a02962dbc198e
<span class="hljs-label">Author:</span> madx &lt;madx+github@yapok<span class="hljs-preprocessor">.org</span>&gt;
<span class="hljs-label">Date:</span>   Mon Nov <span class="hljs-number">4</span> <span class="hljs-number">23</span>:<span class="hljs-number">28</span>:<span class="hljs-number">11</span> <span class="hljs-number">2013</span> +<span class="hljs-number">0100</span>

    Premier commit

diff --git a/putain_de_hello_world<span class="hljs-preprocessor">.rb</span> b/putain_de_hello_world<span class="hljs-preprocessor">.rb</span>
new file mode <span class="hljs-number">100644</span>
index <span class="hljs-number">0000000.</span><span class="hljs-preprocessor">.ded</span>37dc
--- /dev/null
+++ b/putain_de_hello_world<span class="hljs-preprocessor">.rb</span>
@@ -<span class="hljs-number">0</span>,<span class="hljs-number">0</span> +<span class="hljs-number">1</span> @@
+puts <span class="hljs-string">"Hello, putain de codeur !!!"</span>
</code></pre>
<p>Dit comme ça, ça a pas l&#39;air de casser trois pattes à un canard, mais c&#39;est la
base de la base de la praticité. Je vous fait pas l&#39;insulte de vous expliquer le
détails, vous êtes sans doute assez malins pour comprendre ce que git raconte
sur la sortie de ces deux commandes.</p>
<p>Remarquez que <code>git show</code> affiche en bonus les différences introduites par un
fichier. Ces différences on peut aussi les voir avant de commiter avec <code>git
diff</code>, ce qui est bien pratique.</p>
<p>Entraînez vous maintenant à faire des commits, à inspecter et à farfouiller les
pages de <code>man</code>, c&#39;est la meilleure façon d&#39;apprendre. Après on va attaquer le
gros morceau, celui qui fait la force de Git.</p>
<figure>
  <img src="../../../images/posts/memes/mind_blown.gif" alt="Mind blown">
</figure>

<h2 id="branchement-et-fusions">Branchement et fusions</h2>
<p>Créer une branche, ça permet de travailler sur une fonctionnalité ou un bug
précis, sans encombrer la ligne de conduite principale, qui peut évoluer sous
d&#39;autres contraintes.</p>
<p>Dans Git, les branches sont une partie essentielle de quasiment tout <em>workflow</em>,
et leur manipulation est très rapide et très légère.</p>
<p>Pour en revenir à mon histoire de maillon, créer une branche revient à créer un
point à partir duquel deux chaînes vont être possibles.</p>
<p>C&#39;est aussi simple qu&#39;un <code>git branch le-nom-de-ma-branche</code>. Cette commande se
contente de créer la branche, pour se positionner dessus on utilise <code>git
checkout</code> qui permet de naviguer de branche en branche tel Tarzan sur ses
lianes.</p>
<p>Comme c&#39;est super chiant à écrire, il existe un raccourci bien pratique : <code>git
checkout -b</code>, auquel on passe un nom de branche comme pour <code>git branch</code>.</p>
<p>Une fois qu&#39;on est bien sur la branche, tous les commits suivants seront liés à
cette branche.</p>
<p>On peut utiliser <code>git branch</code> sans argument pour lister les branches, celle avec
un petit asterisque devant c&#39;est la branche courante.</p>
<p>Essayons ça avec notre petit dépôt :</p>
<pre><code class="lang-bash"><span class="hljs-variable">$ </span>git branch
* master
<span class="hljs-variable">$ </span>git checkout -b add-shebang
<span class="hljs-constant">Basculement</span> sur la nouvelle branche <span class="hljs-string">'add-shebang'</span>
<span class="hljs-variable">$ </span>vim putain_de_hello_world.rb
<span class="hljs-variable">$ </span>git status
<span class="hljs-comment"># Sur la branche add-shebang</span>
<span class="hljs-comment"># Modifications qui ne seront pas validées :</span>
<span class="hljs-comment">#   (utilisez "git add &lt;fichier&gt;..." pour mettre à jour ce qui sera validé)</span>
<span class="hljs-comment">#   (utilisez "git checkout -- &lt;fichier&gt;..." pour annuler les modifications dans la copie de travail)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    modifié : putain_de_hello_world.rb</span>
<span class="hljs-comment">#</span>
aucune modification n<span class="hljs-string">'a été ajoutée au commit (utilisez "git add" ou "git commit -a")
$ git add putain_de_hello_world.rb
$ git commit
[add-shebang 5d48735] Add shebang
 1 file changed, 1 insertion(+)
$ git log --pretty=oneline --decorate
5d48735fcc805d51e2e294df5d9d22d481250789 (HEAD, add-shebang) Add shebang
8120de7b7139e46b9cbc1c3ee89a02962dbc198e (master) Premier commit</span>
</code></pre>
<p>Comme vous le voyez grâce à l&#39;option <code>--decorate--</code> de <code>git log</code>, on a bien
notre branche qui pointe sur le dernier commit fait, alors que la branche de
base fournie par Git, <code>master</code>, reste au commit précédent.</p>
<p>Dernière étape avant la fin de cette article : le redouté et redoutable
<code>merge</code> !</p>
<p>Pour fusionner nos deux branches on va utiliser cette commande en se plaçant sur
la branche dans laquelle on va fusionner et en passant en argument la branche à
fusionner.</p>
<p>Si vous avez bien suivi, on va donc faire les choses suivantes :</p>
<pre><code class="lang-bash">$ git checkout master
Basculement sur la branche <span class="hljs-string">'master'</span>
$ git <span class="hljs-built_in">merge</span> <span class="hljs-built_in">add</span>-shebang
Updating <span class="hljs-number">8120</span>de7.<span class="hljs-number">.5</span>d48735
Fast-forward
 putain_de_hello_world.rb | <span class="hljs-number">1</span> +
 <span class="hljs-number">1</span> <span class="hljs-built_in">file</span> changed, <span class="hljs-number">1</span> insertion(+)
</code></pre>
<p>Vous remarquez que Git signale <em>Fast-forward</em>. Comme le commit pointé par
<code>add-shebang</code> est un fils direct de celui de <code>master</code>, Git se contente de faire
pointer <code>master</code> sur celui-ci, ce qui est beaucoup plus rapide.</p>
<p>Dans le cas où on a eu des modifications sur <code>master</code> entre temps, on aurait eu
une vraie fusion des contenus des commits, avec éventuellement une résolution de
conflits, mais on verra ça dans un prochain article !</p>
<h2 id="la-suite">La suite</h2>
<p>On a vu les bases, et très bientôt on va approfondir le sujet, en voyant
notamment comment collaborer, comment résoudre des conflits ou des problèmes
d&#39;utilisation de Git, tout ça dans la joie et la bonne humeur.</p>
<h2 id="r-f-rences">Références</h2>
<p>Si vous voulez en savoir plus sur Git, la <a href="http://git-scm.com/documentation">documentation officielle</a> est plutôt
bien foutue.</p>
<p>Si vous aimez les petites références rapides et illustrées, le <a href="http://rogerdudler.github.io/git-guide/">Git
Guide</a> de Roger Dudler est une bonne manière d&#39;apprendre.</p>
<h2 id="hey-tu-veux-appliquer-a-pour-contribuer-putain-de-code-">Hey ! Tu veux appliquer ça pour contribuer à Putain de Code ?</h2>
<p>Pas de problème, on a écrit un post exprès :
<a href="/posts/comment-contribuer/">Comment contribuer</a> !</p>

]]></description><pubDate>Wed, 06 Nov 2013 00:00:00 GMT</pubDate><link>http://putaindecode.fr/posts/git/versionner-avec-git/</link><guid isPermaLink="true">http://putaindecode.fr/posts/git/versionner-avec-git/</guid></item></channel></rss>